<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë‚˜ì˜ ì‘ì€ í…Œë¼ë¦¬ì›€ - Spirit Garden</title>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&family=Gowun+Batang:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #fafaf8;
            --text: #2a2a2a;
            --border: #e0e0dc;
            --card: #ffffff;
            --shadow: rgba(0, 0, 0, 0.06);
            
            --fire: #ff6b4a;
            --water: #4a9eff;
            --wind: #7bdb8f;
            --earth: #d4a574;
            --light: #ffd94a;
            --dark: #8e7cc3;
        }

        body {
            font-family: 'Gowun Batang', serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            font-family: 'Nanum Myeongjo', serif;
            font-size: 2.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        .subtitle {
            text-align: center;
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 40px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-family: 'Gowun Batang', serif;
            font-size: 1rem;
            cursor: pointer;
            color: #888;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .tab.active {
            color: var(--text);
            border-bottom-color: var(--text);
        }

        .tab:hover {
            color: var(--text);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .inventory-panel {
            background: var(--card);
            border: 1px solid var(--border);
            padding: 24px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .inventory-title {
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .inventory-section {
            margin-bottom: 20px;
        }

        .inventory-label {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 8px;
        }

        .inventory-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .inventory-item {
            padding: 6px 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .spirits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .spirit-card {
            background: var(--card);
            border: 1px solid var(--border);
            padding: 24px;
            transition: all 0.3s;
        }

        .spirit-card:hover {
            box-shadow: 0 4px 20px var(--shadow);
            transform: translateY(-2px);
        }

        .spirit-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .spirit-icon {
            font-size: 3rem;
            line-height: 1;
        }

        .spirit-info {
            flex: 1;
            margin-left: 16px;
        }

        .spirit-name {
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 4px;
            cursor: pointer;
        }

        .spirit-name:hover {
            color: var(--fire);
        }

        .spirit-stage {
            font-size: 0.85rem;
            color: #888;
        }

        .progress-bar {
            height: 6px;
            background: var(--border);
            margin-bottom: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--light), var(--fire));
            transition: width 0.5s;
        }

        .progress-text {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 16px;
        }

        .parameters {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 16px;
            padding: 12px;
            background: var(--bg);
            border: 1px solid var(--border);
        }

        .param {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
        }

        .param-icon {
            font-size: 1.1rem;
        }

        .environment {
            margin-bottom: 16px;
            padding: 12px;
            background: var(--bg);
            border: 1px solid var(--border);
        }

        .env-title {
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .env-bars {
            display: grid;
            gap: 6px;
        }

        .env-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
        }

        .env-bar-bg {
            flex: 1;
            height: 8px;
            background: var(--border);
            position: relative;
            overflow: hidden;
        }

        .env-bar-fill {
            height: 100%;
            transition: width 0.5s;
        }

        .spirit-status {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 16px;
            min-height: 40px;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        button {
            padding: 10px 16px;
            border: 1px solid var(--border);
            background: var(--card);
            font-family: 'Gowun Batang', serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        button:hover {
            background: var(--bg);
            border-color: var(--text);
        }

        button:active {
            transform: scale(0.98);
        }

        button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text);
            font-family: 'Gowun Batang', serif;
            font-size: 0.9rem;
            border-radius: 4px;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            -webkit-appearance: none;
            appearance: none;
        }
        
        select:focus {
            outline: 2px solid var(--fire);
            outline-offset: 2px;
        }


        .new-spirit-btn {
            width: 100%;
            padding: 16px;
            font-size: 1rem;
            font-weight: 700;
            margin-top: 20px;
        }

        .walk-btn {
            width: 100%;
            padding: 16px;
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 20px;
            background: var(--light);
            border-color: var(--light);
            color: #000 !important;
        }

        .walk-btn:hover {
            background: var(--fire);
            border-color: var(--fire);
            color: #000 !important;
        }

        .walk-btn:disabled {
            color: #666 !important;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
            padding-top: 100px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card);
            padding: 32px;
            max-width: 500px;
            width: 100%;
            border: 1px solid var(--border);
            margin-bottom: 40px;
        }

        .modal-title {
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .food-grid, .music-grid, .decor-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-btn {
            padding: 16px;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option-icon {
            font-size: 1.5rem;
        }

        .option-info {
            flex: 1;
        }

        .option-name {
            font-weight: 700;
            margin-bottom: 2px;
        }

        .option-effect {
            font-size: 0.8rem;
            color: #888;
        }

        .close-btn {
            width: 100%;
            margin-top: 16px;
        }

        .collection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .encyclopedia-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .encyclopedia-card {
            background: var(--card);
            border: 2px solid var(--border);
            padding: 20px;
            text-align: center;
            position: relative;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .encyclopedia-card.unlocked {
            border-color: #4CAF50;
        }
        
        .encyclopedia-card.locked {
            background: repeating-linear-gradient(
                45deg,
                var(--card),
                var(--card) 10px,
                var(--border) 10px,
                var(--border) 11px
            );
            opacity: 0.6;
        }
        
        .encyclopedia-icon {
            font-size: 3rem;
            margin-bottom: 8px;
        }
        
        .encyclopedia-name {
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--text);
        }
        
        .encyclopedia-count {
            font-size: 0.85rem;
            color: #888;
            margin-top: 4px;
        }

        .collection-card {
            background: var(--card);
            border: 1px solid var(--border);
            padding: 24px;
            text-align: center;
        }

        .collection-icon {
            font-size: 4rem;
            margin-bottom: 12px;
        }

        .collection-name {
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .time-display {
            text-align: center;
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 20px;
        }

        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--card);
            border: 1px solid var(--border);
            padding: 16px 24px;
            box-shadow: 0 4px 20px var(--shadow);
            z-index: 999;
            animation: slideIn 0.3s ease-out;
            max-width: 300px;
            word-wrap: break-word;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .name-input {
            width: 100%;
            padding: 12px;
            font-family: 'Gowun Batang', serif;
            font-size: 1rem;
            border: 1px solid var(--border);
            margin-bottom: 16px;
        }

        .decor-btn:disabled::after {
            content: 'ì¬ë£Œ ë¶€ì¡±';
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 0.7rem;
            padding: 2px 6px;
            background: #f44;
            color: white;
            border-radius: 2px;
        }

        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .inventory-panel {
                position: static;
            }
        }

        .light-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 32px;
            background: #4CAF50;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            padding: 0;
        }
        
        /* í•˜ë‹¨ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
        .bottom-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
        
        .bottom-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .bottom-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .bottom-btn:active {
            transform: translateY(0);
        }
        
        .pause-btn {
            background: #ff9800;
            color: white;
        }
        
        .pause-btn.paused {
            background: #4CAF50;
        }
        
        .reset-btn {
            background: #f44336;
            color: white;
        }
        
        .light-btn {
            background: #2196F3;
            color: white;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ ì¡°ëª… ë²„íŠ¼ í¬ê¸° ì¡°ì • */
        @media (max-width: 768px) {
            .bottom-buttons {
                bottom: 15px;
                right: 15px;
                gap: 8px;
            }
            
            .bottom-btn {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
            .light-toggle {
                bottom: 15px;
                right: 15px;
                width: 50px;
                height: 28px;
            }
            
            .light-toggle::before {
                width: 22px !important;
                height: 22px !important;
            }
            
            body.dark-mode .light-toggle::before {
                transform: translateX(22px) !important;
            }
            
            /* ìƒì  ë ˆì´ì•„ì›ƒ 1ì—´ë¡œ ë³€ê²½ */
            .shop-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            
            /* í…Œë¼ë¦¬ì›€ ì¥ì‹ë¬¼ ëª©ë¡ 1ì—´ë¡œ ë³€ê²½ */
            #installedDecorList > div,
            #terrariumDecorList > div {
                grid-template-columns: 1fr !important;
            }
            
            /* ìƒì  ì„¹ì…˜ íŒ¨ë”© ì¡°ì • */
            .shop-section {
                padding: 20px !important;
            }
            
            /* ì œëª© í¬ê¸° ì¡°ì • */
            h1 {
                font-size: 1.8rem !important;
            }
            
            h2 {
                font-size: 1.5rem !important;
            }
            
            /* íƒ­ ë²„íŠ¼ í¬ê¸° ì¡°ì • */
            .tab {
                padding: 10px 15px !important;
                font-size: 0.9rem !important;
            }
            
            /* ìƒì  ì œëª© í¬ê¸° ì¡°ì • */
            .shop-section h3 {
                font-size: 1.1rem !important;
            }
            
            /* ì „ì²´ ì—¬ë°± ì¡°ì • */
            body {
                padding: 10px !important;
            }
        }

        .light-toggle::before {
            content: '';
            position: absolute;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: white;
            top: 3px;
            left: 3px;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        body.dark-mode .light-toggle {
            background: #666;
        }

        body.dark-mode .light-toggle::before {
            transform: translateX(28px);
        }

        .light-toggle #lightIcon {
            display: none;
        }

        body.dark-mode {
            --bg: #1a1a1a;
            --card: #2d2d2d;
            --text: #e0e0e0;
            --border: #404040;
        }

        body.dark-mode .spirit-name,
        body.dark-mode .spirit-stage,
        body.dark-mode .progress-text,
        body.dark-mode .param,
        body.dark-mode .spirit-status,
        body.dark-mode .env-title,
        body.dark-mode .modal-title,
        body.dark-mode .option-name,
        body.dark-mode .option-effect,
        body.dark-mode .inventory-label,
        body.dark-mode .collection-name,
        body.dark-mode h1,
        body.dark-mode h2,
        body.dark-mode .subtitle,
        body.dark-mode .time-display {
            color: #e0e0e0;
        }

        body.dark-mode button {
            color: #e0e0e0;
        }

        body.dark-mode button:disabled {
            color: #888;
        }
        
        /* ë¯¸ë‹ˆê²Œì„ ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-width: 768px) {
            #minigameArea {
                height: 200px !important;
            }
            
            #minigameSpirit {
                font-size: 2rem !important;
                bottom: 5px !important;
            }
            
            #shieldEffect {
                width: 60px !important;
                height: 60px !important;
            }
            
            .minigame-word {
                font-size: 0.8rem !important;
                padding: 5px 8px !important;
            }
            
            #minigameInput {
                font-size: 1rem !important;
                padding: 12px !important;
            }
            
            /* ë¯¸ë‹ˆê²Œì„ í”Œë ˆì´ ì¤‘ í™”ë©´ ê³ ì • */
            body.minigame-active {
                overflow: hidden;
                position: fixed;
                width: 100%;
                height: 100%;
            }
            
            body.minigame-active #minigamePlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 9999;
                background: var(--bg);
                padding: 10px;
                display: flex !important;
                flex-direction: column;
                overflow: hidden;
            }
            
            body.minigame-active #minigameArea {
                flex: 1;
                height: auto !important;
                min-height: 150px;
                max-height: 250px;
            }
            
            body.minigame-active #minigameInput {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                border-radius: 0;
                border-left: none;
                border-right: none;
                border-bottom: none;
                z-index: 10000;
            }
        }
    </style>
</head>
<body>
    <div class="bottom-buttons">
        <button class="bottom-btn pause-btn" id="pauseBtn" onclick="togglePause()" title="ì¼ì‹œì •ì§€">â¸ï¸</button>
        <button class="bottom-btn light-btn" onclick="toggleLight()" title="ì¡°ëª… ì¼œê¸°/ë„ê¸°">
            <span id="lightIcon">â˜€ï¸</span>
        </button>
    </div>

    <h1>ë‚˜ì˜ ì‘ì€ í…Œë¼ë¦¬ì›€</h1>
    <div class="subtitle">Spirit Garden</div>

    <div class="time-display" id="timeDisplay"></div>

    <div class="tabs">
        <button class="tab active" onclick="switchTab('garden')">ìœ¡ì„±</button>
        <button class="tab" onclick="switchTab('terrarium')">í…Œë¼ë¦¬ì›€</button>
        <button class="tab" onclick="switchTab('shop')">ìƒì  ğŸ’°<span id="coinDisplay">0</span></button>
        <button class="tab" onclick="switchTab('minigame')">ë¯¸ë‹ˆê²Œì„</button>
        <button class="tab" onclick="switchTab('encyclopedia')">ë„ê°</button>
        <button class="tab" onclick="switchTab('album')">ì•¨ë²”</button>
        <button class="tab" onclick="switchTab('settings')">âš™ï¸</button>
    </div>

    <div id="gardenSection" class="section active">
        <div class="main-layout">
            <div class="inventory-panel">
                <div style="margin-bottom: 16px;">
                    <label for="titleSelect" style="display: block; font-size: 0.9rem; margin-bottom: 6px; color: var(--text); font-weight: 600;">ì¹­í˜¸ ì„ íƒ</label>
                    <select id="titleSelect" onchange="changeTitle()" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 8px; background: var(--card); color: var(--text); font-size: 0.9rem; cursor: pointer;">
                        <option value="none">ì—†ìŒ (ê¸°ë³¸)</option>
                        <option value="hawk_eye">ë§¤ì˜ ëˆˆ (ëª¨ë“  ì±„ì§‘ë¬¼ í™•ë¥  1.5ë°°)</option>
                        <option value="gatherer">ì±„ì§‘ê¾¼ (ë¨¹ì´ í™•ë¥  2ë°°)</option>
                        <option value="musician">ìŒì•…ê°€ (ë ˆì½”ë“œ í™•ë¥  2ë°°)</option>
                        <option value="collector">ìˆ˜ì§‘ê°€ (í…Œë¼ë¦¬ì›€ ë¬¼í’ˆ í™•ë¥  2ë°°)</option>
                    </select>
                </div>

                <div style="margin-bottom: 16px;">
                    <label for="gatherLocationSelect" style="display: block; font-size: 0.9rem; margin-bottom: 6px; color: var(--text); font-weight: 600;">ì±„ì§‘ ì¥ì†Œ</label>
                    <select id="gatherLocationSelect" onchange="changeGatherLocation()" style="width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 8px; background: var(--card); color: var(--text); font-size: 0.9rem; cursor: pointer;">
                        <option value="garden">ğŸŒ¸ ì •ì› (ëª¨ë“  ì†ì„±)</option>
                        <option value="lake">ğŸŒŠ í˜¸ìˆ˜ (ë¬¼Â·ë°”ëŒ)</option>
                        <option value="forest">ğŸŒ² ìˆ² (ë•…Â·ë¶ˆ)</option>
                    </select>
                </div>

                <button class="walk-btn" onclick="goGather()" style="margin-bottom: 20px;">ì±„ì§‘í•˜ê¸°</button>

                <div class="inventory-title">ë‚´ ì†Œì§€í’ˆ</div>
                
                <div class="inventory-section">
                    <div class="inventory-label">ğŸ ë¨¹ì´</div>
                    <div class="inventory-items" id="foodInventory">
                        <div class="inventory-item">ì—†ìŒ</div>
                    </div>
                </div>

                <div class="inventory-section">
                    <div class="inventory-label">ìŒì•…</div>
                    <div class="inventory-items" id="musicInventory">
                        <div class="inventory-item">ì—†ìŒ</div>
                    </div>
                </div>

                <div class="inventory-section">
                    <div class="inventory-label">ğŸŒ³ ë‚˜ë¬´ & ì¥ì‹ë¬¼</div>
                    <div class="inventory-items" id="decorInventory">
                        <div class="inventory-item">ì—†ìŒ</div>
                    </div>
                </div>
            </div>

            <div>
                <div class="spirits-grid" id="spiritsGrid"></div>
                <button class="new-spirit-btn" onclick="createNewSpirit()">+ ìƒˆë¡œìš´ ì•Œ ë°›ê¸°</button>
            </div>
        </div>
    </div>

    <div id="encyclopediaSection" class="section">
        <h2 style="text-align: center; font-family: 'Nanum Myeongjo', serif; font-size: 2rem; margin-bottom: 30px;">ì •ë ¹ ë„ê°</h2>
        <div class="encyclopedia-grid" id="encyclopediaGrid"></div>
    </div>

    <div id="albumSection" class="section">
        <h2 style="text-align: center; font-family: 'Nanum Myeongjo', serif; font-size: 2rem; margin-bottom: 30px;">ğŸ’ ì •ë ¹ ì•¨ë²”</h2>
        <div class="collection-grid" id="collectionGrid"></div>
    </div>


    <!-- ì„¤ì • ì„¹ì…˜ -->
    <div id="settingsSection" class="section">
        <h2 style="text-align: center; font-family: 'Nanum Myeongjo', serif; font-size: 2rem; margin-bottom: 30px;">ì„¤ì •</h2>
        
        <div style="max-width: 600px; margin: 0 auto;">
            <!-- ë°ì´í„° ê´€ë¦¬ -->
            <div style="background: var(--card); padding: 24px; border: 1px solid var(--border); border-radius: 12px; margin-bottom: 20px;">
                <h3 style="font-family: 'Nanum Myeongjo', serif; font-size: 1.3rem; margin-bottom: 20px; color: var(--text);">ë°ì´í„° ê´€ë¦¬</h3>
                
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <button onclick="exportGameData()" style="padding: 14px; background: var(--water); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 700; cursor: pointer;">
                        ê²Œì„ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                    </button>
                    
                    <button onclick="importGameData()" style="padding: 14px; background: var(--wind); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 700; cursor: pointer;">
                        ê²Œì„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                    </button>
                    
                    <button onclick="manualRebuildEncyclopedia()" style="padding: 14px; background: var(--earth); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 700; cursor: pointer;">
                        ì•¨ë²”ì—ì„œ ë„ê° ë³µêµ¬
                    </button>
                </div>
                
                <div style="margin-top: 16px; padding: 12px; background: var(--bg); border-radius: 8px; font-size: 0.85rem; color: #888;">
                    ğŸ’¡ ë°ì´í„° ë‚´ë³´ë‚´ê¸°ë¥¼ í†µí•´ ê²Œì„ ì§„í–‰ìƒí™©ì„ ë°±ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                    ë‹¤ë¥¸ ê¸°ê¸°ë‚˜ ë¸Œë¼ìš°ì €ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°ë¥¼ í†µí•´ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
            </div>
            
            <!-- í™”ë©´ ì„¤ì • -->
            <div style="background: var(--card); padding: 24px; border: 1px solid var(--border); border-radius: 12px; margin-bottom: 20px;">
                <h3 style="font-family: 'Nanum Myeongjo', serif; font-size: 1.3rem; margin-bottom: 20px; color: var(--text);">í™”ë©´ ì„¤ì •</h3>
                
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--bg); border-radius: 8px;">
                    <div>
                        <div style="font-weight: 700; margin-bottom: 4px;">ë‹¤í¬ ëª¨ë“œ ê³ ì •</div>
                        <div style="font-size: 0.85rem; color: #888;">í™œì„±í™” ì‹œ ì¡°ëª… ìƒíƒœì™€ ë¬´ê´€í•˜ê²Œ ë‹¤í¬ ëª¨ë“œ ìœ ì§€</div>
                    </div>
                    <label style="position: relative; display: inline-block; width: 60px; height: 32px;">
                        <input type="checkbox" id="darkModeToggle" onchange="toggleDarkModeLock()" style="opacity: 0; width: 0; height: 0;">
                        <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 32px;">
                            <span id="darkModeSlider" style="position: absolute; content: ''; height: 24px; width: 24px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                        </span>
                    </label>
                </div>
            </div>
            
            <!-- ê²Œì„ ì´ˆê¸°í™” -->
            <div style="background: var(--card); padding: 24px; border: 1px solid var(--border); border-radius: 12px; margin-bottom: 20px;">
                <h3 style="font-family: 'Nanum Myeongjo', serif; font-size: 1.3rem; margin-bottom: 20px; color: var(--text);">ê²Œì„ ì´ˆê¸°í™”</h3>
                
                <button onclick="resetGame()" style="width: 100%; padding: 14px; background: #e74c3c; color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 700; cursor: pointer;">
                    ğŸ”„ ê²Œì„ ì´ˆê¸°í™”
                </button>
                
                <div style="margin-top: 16px; padding: 12px; background: var(--bg); border-radius: 8px; font-size: 0.85rem; color: #e74c3c;">
                    âš ï¸ ì£¼ì˜: ëª¨ë“  ì •ë ¹, ì•„ì´í…œ, ì§„í–‰ ìƒí™©ì´ ì‚­ì œë©ë‹ˆë‹¤.<br>
                    ì´ˆê¸°í™” ì „ ë°ì´í„° ë‚´ë³´ë‚´ê¸°ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.
                </div>
            </div>
            
            <!-- ê²Œì„ ì •ë³´ -->
            <div style="background: var(--card); padding: 24px; border: 1px solid var(--border); border-radius: 12px;">
                <h3 style="font-family: 'Nanum Myeongjo', serif; font-size: 1.3rem; margin-bottom: 20px; color: var(--text);">ê²Œì„ ì •ë³´</h3>
                
                <div style="display: flex; flex-direction: column; gap: 12px; font-size: 0.9rem; color: var(--text);">
                    <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                        <span>ë²„ì „</span>
                        <span style="font-weight: 700;">2.1.0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì•¨ë²” ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
    <div id="albumDetailModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: var(--card); border: 2px solid var(--border); border-radius: 12px; padding: 30px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 id="modalTitle" style="font-family: 'Nanum Myeongjo', serif; font-size: 1.5rem; color: var(--text); margin: 0;"></h2>
                <button onclick="closeAlbumDetail()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text);">âœ•</button>
            </div>
            <div id="modalContent"></div>
        </div>
    </div>

    <div id="shopSection" class="section">
        <div style="max-width: 1000px; margin: 0 auto;">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="font-family: 'Nanum Myeongjo', serif; font-size: 2rem; margin-bottom: 10px;">ğŸª ì •ë ¹ ìƒì </h2>
                <div style="font-size: 1.5rem; font-weight: 700; color: var(--fire); margin-bottom: 20px;">ë³´ìœ  ì½”ì¸: <span id="shopCoinDisplay">0</span> ğŸ’°</div>
                
                <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ ë“œë¡­ë‹¤ìš´ -->
                <select id="shopCategorySelect" onchange="changeShopCategory()" style="padding: 12px 20px; font-size: 1rem; border: 2px solid var(--border); border-radius: 8px; background: var(--card); color: var(--text); cursor: pointer; min-width: 200px;">
                    <option value="all">ğŸ“¦ ì „ì²´</option>
                    <option value="food">ğŸ ë¨¹ì´</option>
                    <option value="decoration">ğŸŒ³ ì¥ì‹ë¬¼</option>
                    <option value="music">ë ˆì½”ë“œ</option>
                </select>
            </div>

            <div class="shop-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                <!-- íŒë§¤ (ì†Œì§€í’ˆ â†’ ì½”ì¸) -->
                <div class="shop-section" style="background: var(--card); border: 1px solid var(--border); padding: 32px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="font-family: 'Nanum Myeongjo', serif; font-size: 1.3rem; margin: 0; color: var(--fire);">ğŸ’¸ íŒë§¤í•˜ê¸°</h3>
                        <select id="sellFilterSelect" onchange="changeSellFilter()" style="padding: 8px 12px; font-size: 0.9rem; border: 1px solid var(--border); border-radius: 6px; background: var(--card); color: var(--text); cursor: pointer;">
                            <option value="all">ì „ì²´</option>
                            <option value="fire">ğŸ”¥ ë¶ˆ</option>
                            <option value="water">ğŸ’§ ë¬¼</option>
                            <option value="wind">ğŸŒ¬ï¸ ë°”ëŒ</option>
                            <option value="earth">ğŸŒ± ë•…</option>
                            <option value="light">âœ¨ ë¹›</option>
                            <option value="dark">ğŸŒ™ ì–´ë‘ </option>
                            <option value="intelligence">ğŸ§  ì§€ë ¥</option>
                            <option value="strength">ğŸ’ª ì²´ë ¥</option>
                            <option value="charm">ğŸ’– ë§¤ë ¥</option>
                        </select>
                    </div>
                    <div id="sellList"></div>
                </div>

                <!-- êµ¬ë§¤ (ì½”ì¸ â†’ ì•„ì´í…œ) -->
                <div class="shop-section" style="background: var(--card); border: 1px solid var(--border); padding: 32px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="font-family: 'Nanum Myeongjo', serif; font-size: 1.3rem; margin: 0; color: var(--water);">ğŸ›’ êµ¬ë§¤í•˜ê¸°</h3>
                        <select id="buyFilterSelect" onchange="changeBuyFilter()" style="padding: 8px 12px; font-size: 0.9rem; border: 1px solid var(--border); border-radius: 6px; background: var(--card); color: var(--text); cursor: pointer;">
                            <option value="all">ì „ì²´</option>
                            <option value="fire">ğŸ”¥ ë¶ˆ</option>
                            <option value="water">ğŸ’§ ë¬¼</option>
                            <option value="wind">ğŸŒ¬ï¸ ë°”ëŒ</option>
                            <option value="earth">ğŸŒ± ë•…</option>
                            <option value="light">âœ¨ ë¹›</option>
                            <option value="dark">ğŸŒ™ ì–´ë‘ </option>
                            <option value="intelligence">ğŸ§  ì§€ë ¥</option>
                            <option value="strength">ğŸ’ª ì²´ë ¥</option>
                            <option value="charm">ğŸ’– ë§¤ë ¥</option>
                        </select>
                    </div>
                    <div id="buyList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¯¸ë‹ˆê²Œì„ ì„¹ì…˜ -->
    <div id="minigameSection" class="section">
        <div style="max-width: 800px; margin: 0 auto;">
            <h2 style="text-align: center; font-family: 'Nanum Myeongjo', serif; font-size: 2rem; margin-bottom: 10px;">ğŸ® ì •ë ¹ ì§€í‚¤ê¸°</h2>
            <p style="text-align: center; color: #888; margin-bottom: 30px;">ë–¨ì–´ì§€ëŠ” í•´ì¶©ê³¼ ë…ë²„ì„¯ìœ¼ë¡œë¶€í„° ì •ë ¹ì„ ì§€ì¼œì£¼ì„¸ìš”!</p>
            
            <!-- ê²Œì„ ì‹œì‘ ì „ í™”ë©´ -->
            <div id="minigameIntro" style="background: var(--card); border: 1px solid var(--border); padding: 40px; text-align: center;">
                <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ›¡ï¸</div>
                <h3 style="font-family: 'Nanum Myeongjo', serif; font-size: 1.5rem; margin-bottom: 20px;">ê²Œì„ ë°©ë²•</h3>
                <div style="text-align: left; max-width: 400px; margin: 0 auto 30px; line-height: 1.8; color: var(--text);">
                    <p>â€¢ ìœ„ì—ì„œ í•´ì¶©ê³¼ ë…ë²„ì„¯ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤</p>
                    <p>â€¢ ë‹¨ì–´ë¥¼ íƒ€ì´í•‘í•´ì„œ ì œê±°í•˜ì„¸ìš”</p>
                    <p>â€¢ ë°”ë‹¥ì— ë‹¿ìœ¼ë©´ ì •ë ¹ì´ ë‹¤ì¹©ë‹ˆë‹¤</p>
                    <p>â€¢ ëª©ìˆ¨ 3ê°œê°€ ëª¨ë‘ ì†Œì§„ë˜ë©´ ê²Œì„ ì˜¤ë²„!</p>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; margin-right: 10px;">ë‚œì´ë„:</label>
                    <select id="minigameDifficulty" style="padding: 10px 20px; font-size: 1rem; border: 2px solid var(--border); border-radius: 8px; background: var(--card); color: var(--text);">
                        <option value="easy" selected>ì‰¬ì›€</option>
                        <option value="hard">ì–´ë ¤ì›€ (ë³´ìƒ 2ë°°)</option>
                    </select>
                </div>
                <button onclick="startMinigame()" style="padding: 16px 48px; font-size: 1.2rem; font-weight: 700; background: var(--fire); color: white; border: none; border-radius: 12px; cursor: pointer;">
                    ê²Œì„ ì‹œì‘
                </button>
            </div>
            
            <!-- ê²Œì„ í”Œë ˆì´ í™”ë©´ -->
            <div id="minigamePlay" style="display: none;">
                <!-- ê²Œì„ ìƒíƒœ ë°” -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 15px 20px; background: var(--card); border: 1px solid var(--border); border-radius: 8px;">
                    <div style="font-size: 1.2rem;">
                        <span style="color: #e74c3c;">â¤ï¸</span> 
                        <span id="minigameLives">â¤ï¸â¤ï¸â¤ï¸</span>
                    </div>
                    <div style="font-size: 1.3rem; font-weight: 700; color: var(--text);">
                        ì ìˆ˜: <span id="minigameScore">0</span>
                    </div>
                    <button onclick="endMinigame()" style="padding: 8px 16px; background: #888; color: white; border: none; border-radius: 6px; cursor: pointer;">í¬ê¸°</button>
                </div>
                
                <!-- ê²Œì„ ì˜ì—­ -->
                <div id="minigameArea" style="position: relative; width: 100%; height: 500px; background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 50%, #90EE90 95%, #228B22 100%); border: 3px solid var(--border); border-radius: 12px; overflow: hidden; user-select: none;">
                    <!-- ë–¨ì–´ì§€ëŠ” ë‹¨ì–´ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë¨ -->
                    
                    <!-- ì •ë ¹ (í•˜ë‹¨) -->
                    <div id="minigameSpirit" style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 4rem; transition: all 0.3s; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));">
                        ğŸ›
                    </div>
                    
                    <!-- ë³´í˜¸ë§‰ ì´í™íŠ¸ -->
                    <div id="shieldEffect" style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); width: 120px; height: 120px; border-radius: 50%; background: radial-gradient(circle, rgba(100,200,255,0.3) 0%, transparent 70%); opacity: 0; transition: opacity 0.2s;"></div>
                </div>
                
                <!-- ì…ë ¥ ì˜ì—­ -->
                <div style="margin-top: 15px;">
                    <input type="text" id="minigameInput" placeholder="ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." autocomplete="off" autocapitalize="off" spellcheck="false"
                        style="width: 100%; padding: 18px 24px; font-size: 1.3rem; border: 3px solid var(--border); border-radius: 12px; text-align: center; font-family: 'Gowun Batang', serif; background: var(--card); color: var(--text); box-sizing: border-box;">
                </div>
            </div>
            
            <!-- ê²Œì„ ê²°ê³¼ í™”ë©´ -->
            <div id="minigameResult" style="display: none; background: var(--card); border: 1px solid var(--border); padding: 40px; text-align: center;">
                <div id="resultIcon" style="font-size: 5rem; margin-bottom: 20px;">ğŸ‰</div>
                <h3 id="resultTitle" style="font-family: 'Nanum Myeongjo', serif; font-size: 1.8rem; margin-bottom: 15px;">ê²Œì„ ì¢…ë£Œ!</h3>
                <div style="font-size: 1.5rem; margin-bottom: 10px; color: var(--text);">
                    ìµœì¢… ì ìˆ˜: <span id="finalScore" style="font-weight: 700; color: var(--fire);">0</span>
                </div>
                <div style="font-size: 1.1rem; margin-bottom: 30px; color: #888;">
                    ì²˜ì¹˜í•œ í•´ì¶©: <span id="defeatedCount">0</span>ë§ˆë¦¬
                </div>
                
                <!-- ë³´ìƒ ì„ íƒ -->
                <div id="rewardSection" style="margin-bottom: 30px;">
                    <h4 style="font-size: 1.2rem; margin-bottom: 20px; color: var(--text);">ë³´ìƒì„ ì„ íƒí•˜ì„¸ìš”</h4>
                    <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="claimReward('coin')" class="reward-btn" style="padding: 20px 30px; background: linear-gradient(135deg, #FFD700, #FFA500); color: #333; border: none; border-radius: 12px; cursor: pointer; min-width: 150px;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">ğŸ’°</div>
                            <div style="font-weight: 700;">ì½”ì¸ ë°›ê¸°</div>
                            <div id="coinRewardAmount" style="font-size: 0.9rem; margin-top: 4px;">+0</div>
                        </button>
                        <button onclick="claimReward('item')" class="reward-btn" style="padding: 20px 30px; background: linear-gradient(135deg, #9B59B6, #8E44AD); color: white; border: none; border-radius: 12px; cursor: pointer; min-width: 150px;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">ğŸ</div>
                            <div style="font-weight: 700;">ì•„ì´í…œ ë°›ê¸°</div>
                            <div style="font-size: 0.9rem; margin-top: 4px;">ëœë¤ ë³´ìƒ</div>
                        </button>
                    </div>
                </div>
                
                <button onclick="backToMinigameIntro()" style="padding: 14px 40px; font-size: 1rem; background: var(--border); color: var(--text); border: none; border-radius: 8px; cursor: pointer;">
                    ëŒì•„ê°€ê¸°
                </button>
            </div>
        </div>
    </div>

    <div id="terrariumSection" class="section">
        <div style="max-width: 800px; margin: 0 auto;">
            <!-- í…Œë¼ë¦¬ì›€ í™˜ê²½ -->
            <div style="background: var(--card); border: 1px solid var(--border); padding: 32px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="font-family: 'Nanum Myeongjo', serif; font-size: 1.5rem; margin: 0;">í…Œë¼ë¦¬ì›€ í™˜ê²½</h2>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: #f0f0f0; border-radius: 8px;">
                            <span style="font-weight: 600; color: #666;">ì „ì²´ í’ˆì§ˆ:</span>
                            <span id="terrariumQuality" style="font-size: 1.2rem; font-weight: 700; color: #ff9800;">0.0</span>
                        </div>
                        <button onclick="removeAllDecorations()" style="padding: 8px 16px; background: var(--fire); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            ì „ì²´ í•´ì œ
                        </button>
                    </div>
                </div>
                <div class="env-bars" style="display: grid; gap: 12px;">
                    <div class="env-bar" style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">ğŸ”¥</span>
                        <div class="env-bar-bg" style="flex: 1; height: 12px; background: var(--border);">
                            <div class="env-bar-fill" id="terrFireBar" style="height: 100%; background: var(--fire); width: 0%;"></div>
                        </div>
                        <span id="terrFireValue" style="min-width: 30px; text-align: right;">0</span>
                    </div>
                    <div class="env-bar" style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">ğŸ’§</span>
                        <div class="env-bar-bg" style="flex: 1; height: 12px; background: var(--border);">
                            <div class="env-bar-fill" id="terrWaterBar" style="height: 100%; background: var(--water); width: 0%;"></div>
                        </div>
                        <span id="terrWaterValue" style="min-width: 30px; text-align: right;">0</span>
                    </div>
                    <div class="env-bar" style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">ğŸŒ¬ï¸</span>
                        <div class="env-bar-bg" style="flex: 1; height: 12px; background: var(--border);">
                            <div class="env-bar-fill" id="terrWindBar" style="height: 100%; background: var(--wind); width: 0%;"></div>
                        </div>
                        <span id="terrWindValue" style="min-width: 30px; text-align: right;">0</span>
                    </div>
                    <div class="env-bar" style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">ğŸŒ±</span>
                        <div class="env-bar-bg" style="flex: 1; height: 12px; background: var(--border);">
                            <div class="env-bar-fill" id="terrEarthBar" style="height: 100%; background: var(--earth); width: 0%;"></div>
                        </div>
                        <span id="terrEarthValue" style="min-width: 30px; text-align: right;">0</span>
                    </div>
                    <div class="env-bar" style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">âœ¨</span>
                        <div class="env-bar-bg" style="flex: 1; height: 12px; background: var(--border);">
                            <div class="env-bar-fill" id="terrLightBar" style="height: 100%; background: var(--light); width: 0%;"></div>
                        </div>
                        <span id="terrLightValue" style="min-width: 30px; text-align: right;">0</span>
                    </div>
                    <div class="env-bar" style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 1.5rem;">ğŸŒ™</span>
                        <div class="env-bar-bg" style="flex: 1; height: 12px; background: var(--border);">
                            <div class="env-bar-fill" id="terrDarkBar" style="height: 100%; background: var(--dark); width: 0%;"></div>
                        </div>
                        <span id="terrDarkValue" style="min-width: 30px; text-align: right;">0</span>
                    </div>
                </div>
            </div>

            <!-- ì„¤ì¹˜ëœ ì¥ì‹ë¬¼ -->
            <div style="background: var(--card); border: 1px solid var(--border); padding: 32px; margin-bottom: 20px;">
                <h2 style="font-family: 'Nanum Myeongjo', serif; font-size: 1.5rem; margin-bottom: 10px;">ì„¤ì¹˜ëœ ì¥ì‹ë¬¼</h2>
                <div style="font-size: 0.9rem; color: #888; margin-bottom: 20px;" id="installedCount">0 / 20</div>
                <div id="installedDecorList"></div>
            </div>

            <!-- ì¸ë²¤í† ë¦¬ ì¥ì‹ë¬¼ -->
            <div style="background: var(--card); border: 1px solid var(--border); padding: 32px;">
                <h2 style="font-family: 'Nanum Myeongjo', serif; font-size: 1.5rem; margin-bottom: 20px;">ì¸ë²¤í† ë¦¬ ì¥ì‹ë¬¼</h2>
                <div id="terrariumDecorList"></div>
            </div>
        </div>
    </div>

    <!-- Name Modal -->
    <div class="modal" id="nameModal">
        <div class="modal-content">
            <div class="modal-title">ì •ë ¹ì˜ ì´ë¦„ì„ ì§€ì–´ì£¼ì„¸ìš”</div>
            <input type="text" class="name-input" id="nameInput" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="10">
            <button onclick="confirmName()" style="width: 100%;">í™•ì¸</button>
        </div>
    </div>

    <!-- Feed Modal -->
    <div class="modal" id="feedModal">
        <div class="modal-content">
            <div class="modal-title">ë¬´ì—‡ì„ ë¨¹ì¼ê¹Œìš”?</div>
            <div class="food-grid">
                <!-- ì´ˆê¸° ë”ë¯¸ ë²„íŠ¼ (renderFeedOptions()ë¡œ ë™ì  ìƒì„±ë¨) -->
            </div>
            <button class="close-btn" onclick="closeModal('feedModal')">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- Music Modal -->
    <div class="modal" id="musicModal">
        <div class="modal-content">
            <div class="modal-title">ì–´ë–¤ ìŒì•…ì„ ë“¤ë ¤ì¤„ê¹Œìš”?</div>
            <div id="musicOptions"></div>
            <button class="close-btn" onclick="closeModal('musicModal')">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- Decorate Modal -->
    <div class="modal" id="decorateModal">
        <div class="modal-content">
            <div class="modal-title">í…Œë¼ë¦¬ì›€ ê¾¸ë¯¸ê¸°</div>
            <div id="decorOptions"></div>
            <button class="close-btn" onclick="closeModal('decorateModal')">ë‹«ê¸°</button>
        </div>
    </div>



    <!-- ì»¤ìŠ¤í…€ í™•ì¸ ëª¨ë‹¬ -->
    <div id="confirmModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <h3 id="confirmTitle" style="font-family: 'Nanum Myeongjo', serif; font-size: 1.3rem; margin-bottom: 15px; color: var(--text);"></h3>
            <p id="confirmMessage" style="margin-bottom: 25px; line-height: 1.6; color: var(--text); white-space: pre-line;"></p>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button id="confirmCancelBtn" style="background: #888; color: white;">ì·¨ì†Œ</button>
                <button id="confirmOkBtn" style="background: var(--fire); color: white;">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script>      let spirits = [];
        let collection = [];
        let encyclopedia = {}; // ë„ê°: { evolutionKey: count }
        let darkModeLocked = false; // ë‹¤í¬ ëª¨ë“œ ê³ ì • ì—¬ë¶€
        let inventory = {
            music: [],
            decorations: [],
            food: ['fire', 'fire', 'fire', 'water', 'water', 'water', 'wind', 'wind', 'wind', 'earth', 'earth', 'earth'],
            medicine: [] // ì•½ì´ˆ
        };
        let terrarium = {
            fire: 0,
            water: 0,
            wind: 0,
            earth: 0,
            light: 0,
            dark: 0
        };
        let installedDecorations = []; // ì„¤ì¹˜ëœ ì¥ì‹ë¬¼ ëª©ë¡ (ê°ì²´ ë°°ì—´: { type, index })
        let lightMode = true; // ì¡°ëª… ëª¨ë“œ (true: ë¹›, false: ì–´ë‘ )
        let coins = 0; // í™”í
        let currentSpiritId = null;
        let pendingSpirit = null;
        let lastGatherTime = null;
        let currentTab = 'garden'; // í˜„ì¬ í™œì„± íƒ­
        let currentTitle = 'none'; // í˜„ì¬ ì¹­í˜¸ (none, hawk_eye, gatherer, musician, collector)
        let currentShopCategory = 'all'; // í˜„ì¬ ìƒì  ì¹´í…Œê³ ë¦¬ (all, food, decoration, music)
        let sellFilter = 'all'; // íŒë§¤ í•„í„° (all, fire, water, wind, earth, light, dark, intelligence, strength, charm)
        let buyFilter = 'all'; // êµ¬ë§¤ í•„í„° (all, fire, water, wind, earth, light, dark, intelligence, strength, charm)
        let currentGatherLocation = 'garden'; // í˜„ì¬ ì±„ì§‘ ì¥ì†Œ (garden, lake, forest)
        let lightToggleHistory = []; // ì¡°ëª… ë³€ê²½ ê¸°ë¡ (íƒ€ì„ìŠ¤íƒ¬í”„ ë°°ì—´)
        let isPaused = false; // ê²Œì„ ì¼ì‹œì •ì§€ ìƒíƒœ
        let pausedAt = null; // ì¼ì‹œì •ì§€ ì‹œì‘ ì‹œê°„
        let totalPausedTime = 0; // ì´ ì¼ì‹œì •ì§€ ì‹œê°„

        // ëœë¤ ë¬¸êµ¬ ì‹œìŠ¤í…œ
        const RANDOM_MESSAGES = {
            // ê¸°ë³¸ í–‰ë™ (ì¡°ê±´ ì—†ìŒ)
            basic: [
                '{name}ì´(ê°€) ê¿ˆí‹€ê±°ë¦½ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ëª¸ì„ ë¶€ë¥´ë¥´ ë–±ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ì£¼ë³€ì„ ë‘ë¦¬ë²ˆê±°ë¦½ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ì‘ê²Œ ìš¸ìŒì†Œë¦¬ë¥¼ ëƒ…ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ê°€ë§Œíˆ ì›…í¬ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) ì²œì²œíˆ ì›€ì§ì…ë‹ˆë‹¤.',
                '{name}ì´(ê°€) í…Œë¼ë¦¬ì›€ ìœ ë¦¬ì— ëª¸ì„ ë¬¸ì§€ë¦…ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‚ ê°œë¥¼ ì‚´ì§ ë–¨ê³  ìˆìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) ìì‹ ì˜ ëª¸ì„ ì •ë¦¬í•©ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë¬´ì–¸ê°€ë¥¼ ì°¾ëŠ” ë“¯í•©ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ì™¸ë¡œì›Œí•©ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ì‹¬ì‹¬í•´ ë³´ì…ë‹ˆë‹¤.',
                '{name}ì´(ê°€) í•œìˆ¨ì„ ì‰½ë‹ˆë‹¤.'
            ],
            // ë°°ê³ í””
            hungry: [
                '{name}ì´(ê°€) ë°°ê³ íŒŒ ë³´ì…ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë¨¹ì´ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) í—ˆê¸°ì§„ ëˆˆë¹›ìœ¼ë¡œ ë‹¹ì‹ ì„ ë´…ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ì…ë§›ì„ ë‹¤ì‹­ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë°°ë¥¼ ì›€ì¼œì¥ê³  ìˆìŠµë‹ˆë‹¤.'
            ],
            // ë‚®ì  (ì¡°ëª… ì¼œì§)
            napLight: [
                '{name}ì´(ê°€) ë‚®ì ì„ ìê³  ìˆìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) í–‡ì‚´ ì•„ë˜ì—ì„œ ì¡¸ê³  ìˆìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) í¸ì•ˆí•˜ê²Œ ëˆˆì„ ê°ê³  ìˆìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) ìŠ¤ë¥´ë¥µ ì ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‚˜ë­‡ì ìœ„ì—ì„œ ë‚®ì ì„ ì¦ê¹ë‹ˆë‹¤.'
            ],
            // ë°¤ì  (ì¡°ëª… êº¼ì§)
            sleepDark: [
                '{name}ì´(ê°€) ì ì„ ìê³  ìˆìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) ê¹Šì€ ì ì— ë¹ ì¡ŒìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) ê³ ìš”íˆ ì ë“¤ì–´ ìˆìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) ì–´ë‘  ì†ì—ì„œ í¸íˆ ì‰¬ê³  ìˆìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) ì¡°ìš©íˆ ê¿ˆë‚˜ë¼ë¡œ ë– ë‚¬ìŠµë‹ˆë‹¤.'
            ],
            // ì• ì •ë„ ë‚®ìŒ (0-10)
            affectionVeryLow: [
                '{name}ì´(ê°€) ë‹¹ì‹ ì„ í”¼í•´ í…Œë¼ë¦¬ì›€ êµ¬ì„ì— ìˆ¨ìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹ ì„ ê²½ê³„í•˜ë©° ë©€ë¦¬ ë–¨ì–´ì§‘ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ê³ ê°œë¥¼ ëŒë ¤ ë‹¹ì‹ ì„ ì™¸ë©´í•©ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë¶ˆì•ˆí•œ ë“¯ ëª¸ì„ ë–¨ê³  ìˆìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹  ì•ì—ì„œ ì›€ì¸ ëŸ¬ë“­ë‹ˆë‹¤.'
            ],
            // ì• ì •ë„ ë‚®ìŒ (10-30)
            affectionLow: [
                '{name}ì´(ê°€) ë‹¹ì‹ ì„ ë¹¤íˆ ë°”ë¼ë´…ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ë‹¹ì‹ ì„ ê´€ì°°í•©ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ì‚´ì§ ë‹¹ì‹ ì—ê²Œ ë‹¤ê°€ì˜µë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹ ì—ê²Œ ê´€ì‹¬ì„ ë³´ì´ê¸° ì‹œì‘í•©ë‹ˆë‹¤.',
                '{name}ì´(ê°€) í˜¸ê¸°ì‹¬ ì–´ë¦° ëˆˆìœ¼ë¡œ ë‹¹ì‹ ì„ ë´…ë‹ˆë‹¤.'
            ],
            // ì• ì •ë„ ì¤‘ê°„ (30-50)
            affectionMedium: [
                '{name}ì´(ê°€) ë‹¹ì‹ ì˜ ì†ì— ëº¨ì„ ë¶€ë¹•ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹  ì£¼ë³€ì„ ë¹™ê¸€ë¹™ê¸€ ë•ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹ ì˜ ì†ê°€ë½ì„ ì‚´ì§ ê±´ë“œë¦½ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹ ì—ê²Œ ì• êµë¥¼ ë¶€ë¦½ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹  ê³ì— ê°€ê¹Œì´ ë‹¤ê°€ì˜µë‹ˆë‹¤.'
            ],
            // ì• ì •ë„ ë†’ìŒ (50-100)
            affectionHigh: [
                '{name}ì´(ê°€) ë‹¹ì‹ ì„ ë³´ë©° í–‰ë³µí•´í•©ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹ ì˜ ì†ë°”ë‹¥ì—ì„œ ë’¹êµ½ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹ ì—ê²Œ ì• ì • ì–´ë¦° ëˆˆë¹›ì„ ë³´ëƒ…ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹ ì˜ ì†ì„ ê¼­ ë¶™ì¡ìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹ ê³¼ í•¨ê»˜ ìˆì–´ ì¦ê±°ì›Œ ë³´ì…ë‹ˆë‹¤.'
            ],
            // ì• ì •ë„ ë§¤ìš° ë†’ìŒ (100+)
            affectionVeryHigh: [
                '{name}ì´(ê°€) ë‹¹ì‹ ì„ ê¹Šì´ ì‹ ë¢°í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹ ì˜ í’ˆì— íŒŒê³ ë“­ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹ ì„ í–¥í•œ ì‚¬ë‘ì„ í‘œí˜„í•©ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹ ì˜ ì†ì— ì…ë§ì¶¤í•©ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ë‹¹ì‹  ì—†ì´ëŠ” ëª» ì‚°ë‹¤ëŠ” ë“¯ ì³ë‹¤ë´…ë‹ˆë‹¤.'
            ],
            // ìŒì•… ê´€ë ¨ (ìµœê·¼ì— ìŒì•… ë“¤ìŒ)
            music: [
                '{name}ì´(ê°€) {music}ì„(ë¥¼) í¥ì–¼ê±°ë¦½ë‹ˆë‹¤.',
                '{name}ì´(ê°€) {music}ì— ë§ì¶° ì¶¤ì„ ì¶¥ë‹ˆë‹¤.',
                '{name}ì´(ê°€) {music}ì˜ ì„ ìœ¨ì„ ë– ì˜¬ë¦½ë‹ˆë‹¤.',
                '{name}ì´(ê°€) ìŒì•…ì— ì·¨í•´ ìˆìŠµë‹ˆë‹¤.',
                '{name}ì´(ê°€) {music}ì˜ ì—¬ìš´ì— ì –ì–´ ìˆìŠµë‹ˆë‹¤.'
            ],
            // ì¥ì‹ë¬¼ ê´€ë ¨ (30ê°œ ì „ì²´)
            decorations: {
                // ë¶ˆ ì†ì„±
                fire_common1: [
                    '{name}ì´(ê°€) ìš©ì•”ì„ì—ì„œ íë¥´ëŠ” ì—´ê¸°ë¥¼ ë°”ë¼ë´…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ìš©ì•”ì„ì˜ ë¶ˆì„ ì‹ ê¸°í•˜ê²Œ ì³ë‹¤ë´…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ëœ¨ê±°ìš´ ìš©ì•”ì„ ê·¼ì²˜ì—ì„œ ë”°ëœ»í•¨ì„ ëŠë‚ë‹ˆë‹¤.'
                ],
                fire_common2: [
                    '{name}ì´(ê°€) í™”ì‚°ì¬ë¥¼ í†¡í†¡ ê±´ë“œë¦½ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) í™”ì‚°ì¬ì˜ í–¥ì„ ë§¡ê³  ìˆìŠµë‹ˆë‹¤.',
                    '{name}ì´(ê°€) í™”ì‚°ì¬ ë”ë¯¸ ì˜†ì—ì„œ ë†€ê³  ìˆìŠµë‹ˆë‹¤.'
                ],
                fire_rare1: [
                    '{name}ì´(ê°€) ë¶ˆê½ƒ ì¡°ê°ìƒì„ ê²½ì™¸í•˜ë©° ë°”ë¼ë´…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë¶ˆê½ƒ ì¡°ê°ìƒì˜ ì•„ë¦„ë‹¤ì›€ì— ë§¤ë£Œë˜ì–´ ìˆìŠµë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë¶ˆê½ƒ ì¡°ê°ìƒ ì£¼ë³€ì„ ë¹™ê¸€ë¹™ê¸€ ë•ë‹ˆë‹¤.'
                ],
                fire_rare2: [
                    '{name}ì´(ê°€) íƒ€ì˜¤ë¥´ëŠ” ë¨í”„ì˜ ë¶ˆë¹›ì„ êµ¬ê²½í•©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë¨í”„ ë¶ˆë¹›ì— ê·¸ë¦¼ìë¥¼ ë“œë¦¬ì›ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë¨í”„ì˜ ë”°ëœ»í•œ ë¹›ì„ ì¦ê¹ë‹ˆë‹¤.'
                ],
                fire_epic: [
                    '{name}ì´(ê°€) ë¶ˆì‚¬ì¡° ê¹ƒí„¸ì˜ ì‹ ë¹„ë¡œìš´ ê¸°ìš´ì„ ëŠë‚ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë¶ˆì‚¬ì¡° ê¹ƒí„¸ì´ ë‚´ë¿œëŠ” ë¶ˆê½ƒì— ê°íƒ„í•©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë¶ˆì‚¬ì¡° ê¹ƒí„¸ ì•ì—ì„œ ê²½ê±´í•´ì§‘ë‹ˆë‹¤.'
                ],
                
                // ë¬¼ ì†ì„±
                water_common1: [
                    '{name}ì´(ê°€) ë¶„ìˆ˜ì˜ ë¬¼ì¤„ê¸°ë¥¼ êµ¬ê²½í•©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë¶„ìˆ˜ ë¬¼ì†Œë¦¬ì— ê·€ë¥¼ ê¸°ìš¸ì…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë¶„ìˆ˜ì—ì„œ íŠ€ëŠ” ë¬¼ë°©ìš¸ê³¼ ë†€ê³  ìˆìŠµë‹ˆë‹¤.'
                ],
                water_common2: [
                    '{name}ì´(ê°€) ì¡°ì•½ëŒì„ í†¡í†¡ ë‘ë“œë¦½ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë§¤ëˆí•œ ì¡°ì•½ëŒì„ êµ´ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ì¡°ì•½ëŒ ìœ„ì—ì„œ ì‰¬ê³  ìˆìŠµë‹ˆë‹¤.'
                ],
                water_rare1: [
                    '{name}ì´(ê°€) ì‚°í˜¸ ì¥ì‹ì˜ ìƒ‰ê¹”ì— ê°íƒ„í•©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ì‚°í˜¸ ì‚¬ì´ë¥¼ í—¤ì—„ì¹˜ë“¯ ì›€ì§ì…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ì‚°í˜¸ì˜ ì‹ ë¹„ë¡œìš´ ëª¨ìŠµì„ ê´€ì°°í•©ë‹ˆë‹¤.'
                ],
                water_rare2: [
                    '{name}ì´(ê°€) ë¬¼ë°©ìš¸ êµ¬ìŠ¬ì— ìì‹ ì˜ ëª¨ìŠµì„ ë¹„ì¶°ë´…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) êµ¬ìŠ¬ ì† ë¬¼ë°©ìš¸ì„ ì‹ ê¸°í•˜ê²Œ ì³ë‹¤ë´…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë¬¼ë°©ìš¸ êµ¬ìŠ¬ì„ êµ´ë¦¬ë©° ë†€ê³  ìˆìŠµë‹ˆë‹¤.'
                ],
                water_epic: [
                    '{name}ì´(ê°€) ì¸ì–´ì˜ ëˆˆë¬¼ì´ ë¹›ë‚˜ëŠ” ëª¨ìŠµì— ë„‹ì„ ìƒìŠµë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ì¸ì–´ì˜ ëˆˆë¬¼ì—ì„œ ë‚˜ì˜¤ëŠ” ë¬¼ì˜ ê¸°ìš´ì„ ëŠë‚ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ì¸ì–´ì˜ ëˆˆë¬¼ ì•ì—ì„œ ê²½ê±´í•´ì§‘ë‹ˆë‹¤.'
                ],
                
                // ë°”ëŒ ì†ì„±
                wind_common1: [
                    '{name}ì´(ê°€) ë°”ëŒê°œë¹„ë¥¼ ì‹ ê¸°í•˜ê²Œ ë°”ë¼ë´…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë°”ëŒê°œë¹„ê°€ ë„ëŠ” ëª¨ìŠµì— ê°íƒ„í•©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë°”ëŒê°œë¹„ì™€ í•¨ê»˜ ë¹™ê¸€ë¹™ê¸€ ë•ë‹ˆë‹¤.'
                ],
                wind_common2: [
                    '{name}ì´(ê°€) ë¶€ë“œëŸ¬ìš´ ê¹ƒí„¸ì„ ì‚´ì§ ë§Œì§‘ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ê¹ƒí„¸ì´ í”ë“¤ë¦¬ëŠ” ëª¨ìŠµì„ êµ¬ê²½í•©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ê¹ƒí„¸ ìœ„ì—ì„œ ê°€ë³ê²Œ ë›°ì–´ë†‰ë‹ˆë‹¤.'
                ],
                wind_rare1: [
                    '{name}ì´(ê°€) í’ê²½ ì†Œë¦¬ì— ê·€ë¥¼ ê¸°ìš¸ì…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) í’ê²½ì´ ìš¸ë¦¬ëŠ” ì†Œë¦¬ë¥¼ ì¦ê¹ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) í’ê²½ê³¼ í•¨ê»˜ ë¦¬ë“¬ì„ íƒ€ê³  ìˆìŠµë‹ˆë‹¤.'
                ],
                wind_rare2: [
                    '{name}ì´(ê°€) ë‚˜ë¹„ í‘œë³¸ì„ ë¶€ëŸ¬ìš´ ë“¯ ë°”ë¼ë´…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë‚˜ë¹„ í‘œë³¸ì˜ ì•„ë¦„ë‹¤ìš´ ë‚ ê°œë¥¼ ê°ìƒí•©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë‚˜ë¹„ í‘œë³¸ ì•ì—ì„œ ë‚ ê°œë¥¼ í„ëŸ­ì…ë‹ˆë‹¤.'
                ],
                wind_epic: [
                    '{name}ì´(ê°€) í•˜ëŠ˜ì˜ ê¹ƒí„¸ì—ì„œ ë‚˜ì˜¤ëŠ” ë°”ëŒì„ ëŠë‚ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) í•˜ëŠ˜ì˜ ê¹ƒí„¸ì´ ë¹›ë‚˜ëŠ” ëª¨ìŠµì— ê°íƒ„í•©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) í•˜ëŠ˜ì˜ ê¹ƒí„¸ ì•ì—ì„œ ê²½ê±´í•´ì§‘ë‹ˆë‹¤.'
                ],
                
                // ë•… ì†ì„±
                earth_common1: [
                    '{name}ì´(ê°€) í™”ë¶„ì˜ í™ëƒ„ìƒˆë¥¼ ë§¡ê³  ìˆìŠµë‹ˆë‹¤.',
                    '{name}ì´(ê°€) í™”ë¶„ ì† ì‹ë¬¼ì„ ì‚´í´ë´…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) í™”ë¶„ ì£¼ë³€ì„ ê¸°ì–´ë‹¤ë‹™ë‹ˆë‹¤.'
                ],
                earth_common2: [
                    '{name}ì´(ê°€) ì´ë¼ëŒì˜ ì´‰ì´‰í•œ í‘œë©´ì„ ë§Œì§‘ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ì´ë¼ ì‚¬ì´ë¥¼ íƒí—˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ì´ë¼ëŒì—ì„œ ìì—°ì˜ ê¸°ìš´ì„ ëŠë‚ë‹ˆë‹¤.'
                ],
                earth_rare1: [
                    '{name}ì´(ê°€) ë‚˜ë¬´ ì¡°ê°ì˜ ë‚˜ì´í…Œë¥¼ ì„¸ì–´ë´…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë‚˜ë¬´ ì¡°ê°ì˜ ì§ˆê°ì„ ì¦ê¹ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë‚˜ë¬´ ì¡°ê° ìœ„ë¥¼ ì˜¤ë¥´ë‚´ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.'
                ],
                earth_rare2: [
                    '{name}ì´(ê°€) ë²„ì„¯ êµ°ë½ì„ ì‹ ê¸°í•˜ê²Œ ì³ë‹¤ë´…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë²„ì„¯ ì‚¬ì´ë¥¼ í—¤ì§‘ê³  ë‹¤ë‹™ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë²„ì„¯ì˜ í¬ì í–¥ì„ ë§¡ê³  ìˆìŠµë‹ˆë‹¤.'
                ],
                earth_epic: [
                    '{name}ì´(ê°€) ì„¸ê³„ìˆ˜ ê°€ì§€ì˜ ìƒëª…ë ¥ì„ ëŠë‚ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ì„¸ê³„ìˆ˜ ê°€ì§€ì—ì„œ ë‚˜ì˜¤ëŠ” ê³ ëŒ€ì˜ ê¸°ìš´ì— ì••ë„ë©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ì„¸ê³„ìˆ˜ ê°€ì§€ ì•ì—ì„œ ê²½ê±´í•´ì§‘ë‹ˆë‹¤.'
                ],
                
                // ë¹› ì†ì„±
                light_common1: [
                    '{name}ì´(ê°€) ìˆ˜ì •ì— ìì‹ ì˜ ì–¼êµ´ì„ ë¹„ì¶°ë´…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë¹›ë‚˜ëŠ” ìˆ˜ì •ì„ êµ¬ê²½í•©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ìˆ˜ì •ì´ ë°˜ì‚¬í•˜ëŠ” ë¬´ì§€ê°œë¥¼ ì«“ì•„ê°‘ë‹ˆë‹¤.'
                ],
                light_common2: [
                    '{name}ì´(ê°€) ë°˜ì§ì´ ê°€ë£¨ë¥¼ í†¡í†¡ ê±´ë“œë¦½ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë°˜ì§ì´ëŠ” ê°€ë£¨ì— ë’¹êµ½ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë°˜ì§ì´ ê°€ë£¨ê°€ ë¹›ë‚˜ëŠ” ëª¨ìŠµì„ ì¦ê¹ë‹ˆë‹¤.'
                ],
                light_rare1: [
                    '{name}ì´(ê°€) ë¹›ë‚˜ëŠ” ë³´ì„ì˜ ê´‘ì±„ì— ë„‹ì„ ìƒìŠµë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë³´ì„ì´ ë§Œë“¤ì–´ë‚´ëŠ” ë¹›ì˜ í–¥ì—°ì„ ê°ìƒí•©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë³´ì„ ì˜†ì—ì„œ í•¨ê»˜ ë¹›ë‚˜ê³  ìˆìŠµë‹ˆë‹¤.'
                ],
                light_rare2: [
                    '{name}ì´(ê°€) íƒœì–‘ì„ì˜ ë”°ëœ»í•œ ë¹›ì„ ì¬¡ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) íƒœì–‘ì„ ì•ì—ì„œ ë‚ ê°œë¥¼ í¼ì¹©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) íƒœì–‘ì„ì˜ ê´‘ì±„ë¥¼ ì˜¨ëª¸ìœ¼ë¡œ ë°›ê³  ìˆìŠµë‹ˆë‹¤.'
                ],
                light_epic: [
                    '{name}ì´(ê°€) ë³„ì˜ íŒŒí¸ì´ ë¹›ë‚˜ëŠ” ëª¨ìŠµì— ê²½ì™¸í•©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë³„ì˜ íŒŒí¸ì—ì„œ ë‚˜ì˜¤ëŠ” ìš°ì£¼ì˜ ê¸°ìš´ì„ ëŠë‚ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë³„ì˜ íŒŒí¸ ì•ì—ì„œ ê²½ê±´í•´ì§‘ë‹ˆë‹¤.'
                ],
                
                // ì–´ë‘  ì†ì„±
                dark_common1: [
                    '{name}ì´(ê°€) í‘ìš”ì„ì˜ ê¹Šì€ ì–´ë‘ ì— ë¹ ì ¸ë“­ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) í‘ìš”ì„ì˜ ë§¤ëˆí•œ í‘œë©´ì„ ì“°ë‹¤ë“¬ìŠµë‹ˆë‹¤.',
                    '{name}ì´(ê°€) í‘ìš”ì„ ì˜†ì—ì„œ ì¡°ìš©íˆ ëª…ìƒí•©ë‹ˆë‹¤.'
                ],
                dark_common2: [
                    '{name}ì´(ê°€) ê²€ì€ ëª¨ë˜ë¥¼ íŒŒí—¤ì¹˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ê²€ì€ ëª¨ë˜ ìœ„ì— ê·¸ë¦¼ì„ ê·¸ë¦½ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ê²€ì€ ëª¨ë˜ì˜ ê°ì´‰ì„ ì¦ê¹ë‹ˆë‹¤.'
                ],
                dark_rare1: [
                    '{name}ì´(ê°€) ë‹¬ë¹›ì„ì„ ì¡°ìš©íˆ ë°”ë¼ë´…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë‹¬ë¹›ì„ì˜ ì€ì€í•œ ë¹›ì— ì ê¹ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë‹¬ë¹›ì„ê³¼ í•¨ê»˜ ë°¤ì˜ ê¸°ìš´ì„ ëŠë‚ë‹ˆë‹¤.'
                ],
                dark_rare2: [
                    '{name}ì´(ê°€) ê·¸ë¦¼ì ìˆ˜ì • ì†ì„ ë“¤ì—¬ë‹¤ë´…ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ê·¸ë¦¼ì ìˆ˜ì •ì˜ ì‹ ë¹„ë¡œìš´ ëª¨ìŠµì— ë§¤ë£Œë©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ê·¸ë¦¼ì ìˆ˜ì •ì´ ë§Œë“¤ì–´ë‚´ëŠ” ì–´ë‘ ì„ ì¦ê¹ë‹ˆë‹¤.'
                ],
                dark_epic: [
                    '{name}ì´(ê°€) ë°¤ì˜ ì •ìˆ˜ì—ì„œ ë‚˜ì˜¤ëŠ” ì–´ë‘ ì˜ í˜ì„ ëŠë‚ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë°¤ì˜ ì •ìˆ˜ê°€ í’ˆì€ ì‹ ë¹„ì— ì••ë„ë©ë‹ˆë‹¤.',
                    '{name}ì´(ê°€) ë°¤ì˜ ì •ìˆ˜ ì•ì—ì„œ ê²½ê±´í•´ì§‘ë‹ˆë‹¤.'
                ]
            },
            // ì •ë ¹ ê°„ ìƒí˜¸ì‘ìš©
            interaction: {
                decoration: [
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) í•¨ê»˜ {deco}ì„(ë¥¼) êµ¬ê²½í•©ë‹ˆë‹¤.',
                    '{name1}ì´(ê°€) {name2}ì—ê²Œ {deco}ì„(ë¥¼) ë³´ì—¬ì¤ë‹ˆë‹¤.',
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) {deco} ì£¼ìœ„ë¥¼ ë¹™ê¸€ë¹™ê¸€ ë•ë‹ˆë‹¤.',
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) {deco} ì˜†ì—ì„œ í•¨ê»˜ ì‰¬ê³  ìˆìŠµë‹ˆë‹¤.',
                    '{name1}ì´(ê°€) {name2}ì™€(ê³¼) {deco}ì„(ë¥¼) í•¨ê»˜ ì¦ê¸°ê³  ìˆìŠµë‹ˆë‹¤.'
                ],
                sharing: [
                    '{name1}ì´(ê°€) {name2}ì—ê²Œ ë¨¹ì´ë¥¼ ë‚˜ëˆ ì¤ë‹ˆë‹¤.',
                    '{name1}ì´(ê°€) {name2}ì™€(ê³¼) ë¨¹ì´ë¥¼ í•¨ê»˜ ë¨¹ìŠµë‹ˆë‹¤.',
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) ì„œë¡œì˜ ë¨¹ì´ë¥¼ ë‚˜ëˆ„ê³  ìˆìŠµë‹ˆë‹¤.'
                ],
                fight: [
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) ì„œë¡œë¥¼ ê¹¨ë­…ë‹ˆë‹¤.',
                    '{name1}ì´(ê°€) {name2}ì™€(ê³¼) ì¥ë‚œìŠ¤ëŸ½ê²Œ ì‹¸ì›ë‹ˆë‹¤.',
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) ìœ¼ë¥´ë ê±°ë¦¬ë©° ëŒ€ì¹˜í•©ë‹ˆë‹¤.',
                    '{name1}ì´(ê°€) {name2}ë¥¼(ì„) ì«“ì•„ë‹¤ë‹™ë‹ˆë‹¤.'
                ],
                rest: [
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) ì„œë¡œì—ê²Œ ê¸°ëŒ€ì–´ ì ì´ ë“­ë‹ˆë‹¤.',
                    '{name1}ì´(ê°€) {name2} ì˜†ì—ì„œ í¸ì•ˆíˆ ì‰¬ê³  ìˆìŠµë‹ˆë‹¤.',
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) ë‚˜ë€íˆ ë‚®ì ì„ ìê³  ìˆìŠµë‹ˆë‹¤.',
                    '{name1}ì´(ê°€) {name2}ë¥¼(ì„) ë² ê°œ ì‚¼ì•„ ì ë“¤ì—ˆìŠµë‹ˆë‹¤.',
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) í•¨ê»˜ ê¿ˆë‚˜ë¼ë¡œ ë– ë‚¬ìŠµë‹ˆë‹¤.'
                ],
                song: [
                    '{name1}ì´(ê°€) {name2}ì—ê²Œ ìì‹ ì´ ì¢‹ì•„í•˜ëŠ” ë…¸ë˜ë¥¼ ë¶ˆëŸ¬ì¤ë‹ˆë‹¤.',
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) í•¨ê»˜ ë…¸ë˜ë¥¼ ë¶€ë¦…ë‹ˆë‹¤.',
                    '{name1}ì´(ê°€) {name2}ë¥¼(ì„) ìœ„í•´ ìŒì•…ì„ ì—°ì£¼í•©ë‹ˆë‹¤.',
                    '{name1}ì´(ê°€) {name2}ì™€(ê³¼) í•¨ê»˜ ì¶¤ì„ ì¶¥ë‹ˆë‹¤.'
                ],
                play: [
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) ìˆ¨ë°”ê¼­ì§ˆì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    '{name1}ì´(ê°€) {name2}ì™€(ê³¼) ìˆ ë˜ì¡ê¸°ë¥¼ ì¦ê¹ë‹ˆë‹¤.',
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) ì¬ë¯¸ìˆê²Œ ë†€ê³  ìˆìŠµë‹ˆë‹¤.',
                    '{name1}ì´(ê°€) {name2}ë¥¼(ì„) ê°„ì§€ëŸ½í™ë‹ˆë‹¤.',
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) í•¨ê»˜ ì›ƒê³  ë– ë“¤ê³  ìˆìŠµë‹ˆë‹¤.'
                ],
                talk: [
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) ìˆ˜ë‹¤ë¥¼ ë–¨ê³  ìˆìŠµë‹ˆë‹¤.',
                    '{name1}ì´(ê°€) {name2}ì—ê²Œ ë¬´ì–¸ê°€ ì´ì•¼ê¸°í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    '{name1}ê³¼(ì™€) {name2}ì´(ê°€) ì¦ê²ê²Œ ëŒ€í™”ë¥¼ ë‚˜ëˆ•ë‹ˆë‹¤.',
                    '{name1}ì´(ê°€) {name2}ì˜ ì´ì•¼ê¸°ë¥¼ ê²½ì²­í•˜ê³  ìˆìŠµë‹ˆë‹¤.'
                ]
            }
        };

        const STAGE_REQUIREMENTS = {
            egg: 0,
            larva1: 10,
            larva2: 25,
            larva3: 45,
            pupa: 70,
            adult: 100
        };

        const STAGE_ICONS = {
            egg: 'ğŸ¥š',
            larva1: 'ğŸ›',
            larva2: 'ğŸ›',
            larva3: 'ğŸ›',
            pupa: 'ğŸ¦‹',
            adult: 'ğŸ¦‹'
        };

        const STAGE_NAMES = {
            egg: 'ì•Œ',
            larva1: 'ì• ë²Œë ˆ I',
            larva2: 'ì• ë²Œë ˆ II',
            larva3: 'ì• ë²Œë ˆ III',
            pupa: 'ë²ˆë°ê¸°',
            adult: 'ì„±ì¶©'
        };
        
        // ì„±ì¥ ë‹¨ê³„ë³„ ì†ì„± ì™¸í˜• ë¬˜ì‚¬
        const APPEARANCE_DESCRIPTIONS = {
            egg: {
                fire: 'ê»ì§ˆì´ ë”°ëœ»í•˜ê³  ë¯¸ì„¸í•œ ì—´ê¸°ê°€ ëŠê»´ì§‘ë‹ˆë‹¤.',
                water: 'ì´‰ì´‰í•˜ê³  íˆ¬ëª…í•œ ê´‘íƒì´ íë¦…ë‹ˆë‹¤.',
                wind: 'ê»ì§ˆì´ ë¶€ë“œëŸ½ê³  ê°€ë³ìŠµë‹ˆë‹¤.',
                earth: 'ë‹¨ë‹¨í•˜ê³  ê±°ì¹œ ì§ˆê°ì´ ìˆìŠµë‹ˆë‹¤.',
                light: 'ì€ì€í•œ ë¹›ì´ ë‚´ë¶€ì—ì„œ ë¹„ì¹©ë‹ˆë‹¤.',
                dark: 'ì§™ì€ ìƒ‰ìœ¼ë¡œ ê¹Šì´ë¥¼ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                normal: 'í‰ë²”í•œ í°ìƒ‰ ì•Œì…ë‹ˆë‹¤.'
            },
            larva1: {
                fire: 'ëª¸ì´ ë¶‰ê²Œ ë¬¼ë“¤ê³  ë”°ëœ»í•œ ê¸°ìš´ì´ ëŠê»´ì§‘ë‹ˆë‹¤.',
                water: 'ì´‰ì´‰í•œ í”¼ë¶€ì—ì„œ ë¬¼ë°©ìš¸ì´ ë§ºí™ë‹ˆë‹¤.',
                wind: 'ëª¸ì´ ê°€ë³ê³  ë°”ëŒì— í”ë“¤ë¦½ë‹ˆë‹¤.',
                earth: 'ë‹¨ë‹¨í•œ ê°ˆìƒ‰ í”¼ë¶€ë¡œ ë®ì—¬ìˆìŠµë‹ˆë‹¤.',
                light: 'ì˜¨ëª¸ì—ì„œ ì€ì€í•œ ë¹›ì´ ë‚©ë‹ˆë‹¤.',
                dark: 'ì–´ë‘ìš´ ë³´ë¼ë¹› ëª¸ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                normal: 'íˆ¬ëª…í•œ ì´ˆë¡ë¹› ëª¸ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤.'
            },
            larva2: {
                fire: 'ì™¸ê²¬ì´ ë¶‰ê³ , ë§Œì¡Œì„ ë•Œ ë”°ëœ»í•˜ë©° ë¨¸ë¦¬ì¹´ë½ì´ ë¶ˆê½ƒì²˜ëŸ¼ ì¼ë ì…ë‹ˆë‹¤.',
                water: 'í‘¸ë¥¸ë¹›ì´ ë„ëŠ” ëª¸ì—ì„œ ì‹œì›í•œ ê¸°ìš´ì´ ë‚˜ë©°, ëª¸ í‘œë©´ì— ë¬¼ê²° ë¬´ëŠ¬ê°€ ìˆìŠµë‹ˆë‹¤.',
                wind: 'ì—°í•œ í•˜ëŠ˜ìƒ‰ ëª¸ì— ê¹ƒí„¸ ê°™ì€ ì†œí„¸ì´ ë‹ì•„ìˆê³ , ê³µì¤‘ì— ë‘¥ë‘¥ ë– ì˜¤ë¦…ë‹ˆë‹¤.',
                earth: 'ê°ˆìƒ‰ë¹› ëª¸ì— ì‘ì€ ì´ë¼ê°€ ìë¼ê³ , ë§Œì§€ë©´ í™ ëƒ„ìƒˆê°€ ë‚©ë‹ˆë‹¤.',
                light: 'ê¸ˆë¹›ìœ¼ë¡œ ë¹›ë‚˜ëŠ” ëª¸ì—ì„œ ë”°ëœ»í•œ ë¹›ì´ ë°œì‚°ë˜ë©°, ì£¼ë³€ì„ ë°í™ë‹ˆë‹¤.',
                dark: 'ê¹Šì€ ë‚¨ìƒ‰ ëª¸ì— ë³„ë¹› ê°™ì€ ë°˜ì ì´ ìˆê³ , ì£¼ë³€ì˜ ë¹›ì„ í¡ìˆ˜í•©ë‹ˆë‹¤.',
                normal: 'íˆ¬ëª…í•œ ëª¸ì— ë¬´ì§€ê°œë¹›ì´ ì€ì€í•˜ê²Œ ê°ë•ë‹ˆë‹¤.',
                // í˜¼í•© ì†ì„±
                'dark-earth': 'ì–´ë‘ìš´ ê°ˆìƒ‰ ëª¸ì— ë°¤ ì´ìŠ¬ì´ ë§ºíˆê³  í™ì˜ í–¥ê¸°ê°€ ë‚©ë‹ˆë‹¤.',
                'dark-fire': 'ê²€ë¶‰ì€ ëª¸ì—ì„œ ì–´ë‘ìš´ ì—´ê¸°ê°€ í”¼ì–´ì˜¤ë¥´ë©° ì‹ ë¹„ë¡œìš´ ë¹›ì´ ê¹œë¹¡ì…ë‹ˆë‹¤.',
                'dark-light': 'ë°˜ì€ ë¹›ë‚˜ê³  ë°˜ì€ ì–´ë‘ìš´ ëª¸ì´ í™©í˜¼ì˜ ì•„ë¦„ë‹¤ì›€ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.',
                'dark-water': 'ì§™ì€ ì²­ìƒ‰ ëª¸ì—ì„œ ì‹¬í•´ì˜ ë¬¼ê²° ë¬´ëŠ¬ê°€ íë¥´ê³  ì°¨ê°€ìš´ ê¸°ìš´ì´ ë‚©ë‹ˆë‹¤.',
                'dark-wind': 'ê²€ì€ ì†œí„¸ì´ ë‹ì€ ëª¸ì´ ë°¤ë°”ëŒì²˜ëŸ¼ ê°€ë³ê²Œ í”ë“¤ë¦½ë‹ˆë‹¤.',
                'earth-fire': 'ë¶‰ì€ í™ë¹› ëª¸ì— ì‘ì€ ë¶ˆê½ƒ ë¬´ëŠ¬ê°€ ìˆê³  ë”°ëœ»í•œ ì˜¨ê¸°ê°€ ëŠê»´ì§‘ë‹ˆë‹¤.',
                'earth-light': 'í™©ê¸ˆë¹› ëª¸ì— ì‘ì€ ìƒˆì‹¹ì´ ë‹ì•„ë‚˜ê³  ìƒëª…ì˜ ë¹›ì„ ë°œí•©ë‹ˆë‹¤.',
                'earth-water': 'ì²­ë¡ìƒ‰ ëª¸ì— ì´ë¼ì™€ ë¬¼ë°©ìš¸ì´ í•¨ê»˜ ë§ºí˜€ìˆê³  ì´‰ì´‰í•©ë‹ˆë‹¤.',
                'earth-wind': 'ì—°ë‘ìƒ‰ ëª¸ì—ì„œ í’€ì í–¥ê¸°ê°€ ë‚˜ê³  ì‚°ë“¤ë°”ëŒì— í”ë“¤ë¦½ë‹ˆë‹¤.',
                'fire-light': 'ëˆˆë¶€ì‹  í™©ê¸ˆë¹› ëª¸ì—ì„œ íƒœì–‘ ê°™ì€ ì—´ê¸°ì™€ ë¹›ì´ ë¿œì–´ì ¸ ë‚˜ì˜µë‹ˆë‹¤.',
                'fire-water': 'ë¶‰ì€ ë³´ë¼ë¹› ëª¸ì—ì„œ ì¦ê¸°ê°€ í”¼ì–´ì˜¤ë¥´ê³  ì—´ê¸°ì™€ ìŠµê¸°ê°€ ë’¤ì„ì…ë‹ˆë‹¤.',
                'fire-wind': 'ì£¼í™©ìƒ‰ ëª¸ ì£¼ë³€ìœ¼ë¡œ ëœ¨ê±°ìš´ ë°”ëŒì´ ì¼ë ì´ë©° íë¦…ë‹ˆë‹¤.',
                'light-water': 'ë§‘ì€ í•˜ëŠ˜ë¹› ëª¸ì—ì„œ ì€ì€í•œ ë¹›ê³¼ ì‹œì›í•œ ë¬¼ë°©ìš¸ì´ íë¦…ë‹ˆë‹¤.',
                'light-wind': 'ë¹›ë‚˜ëŠ” í° ì†œí„¸ì— ë‘˜ëŸ¬ì‹¸ì—¬ ë¹›ì˜ ë°”ëŒì„ íƒ€ê³  ë– ì˜¤ë¦…ë‹ˆë‹¤.',
                'water-wind': 'í•˜ëŠ˜ìƒ‰ ëª¸ ì£¼ë³€ì— ë¬¼ì•ˆê°œê°€ ê°ëŒê³  ì‚°ë“¤ë°”ëŒì´ ë¶ˆì–´ì˜µë‹ˆë‹¤.'
            },
            larva3: {
                fire: 'ì˜¨ëª¸ì´ ì£¼í™©ë¹› ë¶ˆê½ƒìœ¼ë¡œ ê°ì‹¸ì—¬ ìˆê³ , ìˆ¨ì„ ì‰´ ë•Œë§ˆë‹¤ ì‘ì€ ë¶ˆë˜¥ì´ íŠ‘ë‹ˆë‹¤.',
                water: 'ê¹Šì€ ì²­ë¡ìƒ‰ ëª¸ì—ì„œ ì‘ì€ ë¬¼ì¤„ê¸°ê°€ í˜ëŸ¬ë‚´ë¦¬ê³ , ì£¼ë³€ ê³µê¸°ê°€ ì¶•ì¶•í•©ë‹ˆë‹¤.',
                wind: 'ì€ë¹› ë‚ ê°œ ë¹„ëŠ˜ì´ ë‹ì•„ë‚˜ê³ , ì›€ì§ì¼ ë•Œë§ˆë‹¤ ë°”ëŒì´ ì¼ì–´ë‚©ë‹ˆë‹¤.',
                earth: 'ë‹¨ë‹¨í•œ ë‚˜ë¬´ê»ì§ˆ ê°™ì€ ì™¸í”¼ì— ì‘ì€ ê½ƒë´‰ì˜¤ë¦¬ê°€ í”¼ì–´ìˆìŠµë‹ˆë‹¤.',
                light: 'ëˆˆë¶€ì‹  í™©ê¸ˆë¹›ìœ¼ë¡œ ë¹›ë‚˜ë©°, ì£¼ë³€ì— ë¬´ì§€ê°œ í›„ê´‘ì´ ë³´ì…ë‹ˆë‹¤.',
                dark: 'ì¹ í‘ ê°™ì€ ëª¸ì— ì€í•˜ìˆ˜ ê°™ì€ ë¹›ì˜ ë ê°€ íë¥´ê³ , ê·¸ë¦¼ìê°€ ì¶¤ì¶¥ë‹ˆë‹¤.',
                normal: 'ë§‘ê³  íˆ¬ëª…í•œ ëª¸ì— ëª¨ë“  ìƒ‰ì´ ì€ì€í•˜ê²Œ ì–´ìš°ëŸ¬ì§‘ë‹ˆë‹¤.',
                // í˜¼í•© ì†ì„±
                'dark-earth': 'ê²€ì€ ë‚˜ë¬´ê»ì§ˆ ê°™ì€ ì™¸í”¼ì— ë°¤ê½ƒì´ í”¼ì–´ìˆê³  ì–´ë‘ ì˜ í–¥ê¸°ê°€ ë‚©ë‹ˆë‹¤.',
                'dark-fire': 'ê²€ë¶‰ì€ ë¶ˆê½ƒì´ ì–´ë‘  ì†ì—ì„œ íƒ€ì˜¤ë¥´ë©° ì‘ì€ ë¶ˆë˜¥ê³¼ ê·¸ë¦¼ìê°€ ì¶¤ì¶¥ë‹ˆë‹¤.',
                'dark-light': 'ë¹›ê³¼ ì–´ë‘ ì´ êµì°¨í•˜ëŠ” ëª¸ì—ì„œ ìƒˆë²½ê³¼ í™©í˜¼ì˜ ê¸°ìš´ì´ ë™ì‹œì— ëŠê»´ì§‘ë‹ˆë‹¤.',
                'dark-water': 'ê¹Šì€ ë‚¨ìƒ‰ ëª¸ì—ì„œ ë°¤ë°”ë‹¤ì˜ ë¬¼ê²°ì´ íë¥´ê³  ì‹ ë¹„ë¡œìš´ ë¬¼ë°©ìš¸ì´ ë§ºí™ë‹ˆë‹¤.',
                'dark-wind': 'ê²€ì€ ë‚ ê°œ ë¹„ëŠ˜ì´ ë‹ì•„ë‚˜ë©° ë°¤ë°”ëŒì´ ì†Œìš©ëŒì´ì¹˜ê³  ê·¸ë¦¼ìê°€ í©ë‚ ë¦½ë‹ˆë‹¤.',
                'earth-fire': 'ì ê°ˆìƒ‰ ëª¸ì—ì„œ ìš©ì•” ê°™ì€ ì—´ê¸°ê°€ ë¿œì–´ì ¸ ë‚˜ì˜¤ê³  ì‘ì€ ê½ƒë¶ˆì´ í•ë‹ˆë‹¤.',
                'earth-light': 'í™©ê¸ˆë¹› ë‚˜ë¬´ê»ì§ˆì— ë¹›ë‚˜ëŠ” ê½ƒë“¤ì´ ë§Œê°œí•˜ê³  ìƒëª…ì˜ í›„ê´‘ì´ ë¹›ë‚©ë‹ˆë‹¤.',
                'earth-water': 'ì²­ë¡ìƒ‰ ëª¸ì— ì´ë¼ì™€ ë¬¼ì´ë¼ê°€ ìë¼ê³  ê³„ê³¡ë¬¼ì´ í˜ëŸ¬ë‚´ë¦½ë‹ˆë‹¤.',
                'earth-wind': 'ì—°ë‘ë¹› ëª¸ì—ì„œ ìƒˆì‹¹ì´ ë‹ì•„ë‚˜ê³  ë´„ë°”ëŒì— ì‹¤ë ¤ í–¥ê¸°ê°€ í¼ì§‘ë‹ˆë‹¤.',
                'fire-light': 'ì°¬ë€í•œ íƒœì–‘ë¹› ë¶ˆê½ƒì´ ì˜¨ëª¸ì„ ê°ì‹¸ê³  ëˆˆë¶€ì‹  í™©ê¸ˆë¹›ì´ í­ë°œí•©ë‹ˆë‹¤.',
                'fire-water': 'ë¶‰ì€ ëª¸ì—ì„œ ëœ¨ê±°ìš´ ì¦ê¸°ê°€ ì†Ÿì•„ì˜¤ë¥´ê³  ë¬¼ê³¼ ë¶ˆì´ ì—­ë™ì ìœ¼ë¡œ ì¶©ëŒí•©ë‹ˆë‹¤.',
                'fire-wind': 'ì£¼í™©ë¹› ëª¸ ì£¼ë³€ìœ¼ë¡œ ì—´í’ì´ ì†Œìš©ëŒì´ì¹˜ê³  ë¶ˆê½ƒì´ ë°”ëŒì„ íƒ€ê³  ì¶¤ì¶¥ë‹ˆë‹¤.',
                'light-water': 'ì€ì€í•œ ì²­ë°±ìƒ‰ ëª¸ì—ì„œ ë§‘ì€ ë¹›ê³¼ ë¬¼ë°©ìš¸ì´ ì¡°í™”ë¡­ê²Œ íë¦…ë‹ˆë‹¤.',
                'light-wind': 'ë¹›ë‚˜ëŠ” ì€ë¹› ë‚ ê°œ ë¹„ëŠ˜ì´ ë¹›ì˜ ë°”ëŒì„ ì¼ìœ¼í‚¤ë©° ë¬´ì§€ê°œë¹›ìœ¼ë¡œ ë°˜ì§ì…ë‹ˆë‹¤.',
                'water-wind': 'í•˜ëŠ˜ë¹› ëª¸ ì£¼ë³€ì— ë¬¼ë³´ë¼ì™€ ë°”ëŒì´ ì†Œìš©ëŒì´ì¹˜ë©° ì•„ë¦„ë‹¤ìš´ ì•ˆê°œë¥¼ ë§Œë“­ë‹ˆë‹¤.'
            },
            pupa: {
                fire: 'ë¶‰ì€ ìˆ˜ì • ê°™ì€ ë²ˆë°ê¸°ì—ì„œ ì—´ê¸°ê°€ í”¼ì–´ì˜¤ë¥´ê³ , ë‚´ë¶€ì— ë¶ˆê½ƒì´ ì¶¤ì¶¥ë‹ˆë‹¤.',
                water: 'í‘¸ë¥¸ ì–¼ìŒ ê°™ì€ ë²ˆë°ê¸° ì†ì—ì„œ ë¬¼ê²°ì´ ì¼ë ì´ë©° ë³€í™”ê°€ ì¼ì–´ë‚©ë‹ˆë‹¤.',
                wind: 'í•˜ì–€ êµ¬ë¦„ ê°™ì€ ë²ˆë°ê¸°ê°€ ê³µì¤‘ì— ë– ìˆê³ , ë°”ëŒì— ë§ì¶° íšŒì „í•©ë‹ˆë‹¤.',
                earth: 'ë‚˜ë¬´ ì˜¹ì´ ê°™ì€ ë²ˆë°ê¸°ì—ì„œ ìƒˆìˆœì´ ë‹ì•„ë‚˜ê³  ìˆìŠµë‹ˆë‹¤.',
                light: 'ë¹›ë‚˜ëŠ” í¬ë¦¬ìŠ¤íƒˆ ë²ˆë°ê¸°ì—ì„œ ë¬´ì§€ê°œë¹›ì´ í¼ì ¸ë‚˜ì˜µë‹ˆë‹¤.',
                dark: 'ê²€ì€ ë³´ì„ ê°™ì€ ë²ˆë°ê¸°ì—ì„œ ì‹ ë¹„ë¡œìš´ ë³„ë¹›ì´ ê¹œë¹¡ì…ë‹ˆë‹¤.',
                normal: 'ìˆœë°±ì˜ ë²ˆë°ê¸°ê°€ ì¡°ìš©íˆ ë³€í™”ë¥¼ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                // í˜¼í•© ì†ì„± (15ê°œ ì¡°í•©)
                'dark-earth': 'ì§™ì€ ê°ˆìƒ‰ ë²ˆë°ê¸°ì—ì„œ ë°¤ì˜ ê¸°ìš´ê³¼ ëŒ€ì§€ì˜ í–¥ê¸°ê°€ ë’¤ì„ì…ë‹ˆë‹¤.',
                'dark-fire': 'ê²€ë¶‰ì€ ë²ˆë°ê¸°ì—ì„œ ì–´ë‘  ì† ë¶ˆê½ƒì´ íƒ€ì˜¤ë¥´ë©° ì‹ ë¹„ë¡œìš´ ì—´ê¸°ê°€ ë‚©ë‹ˆë‹¤.',
                'dark-light': 'í‘ë°±ì´ êµì°¨í•˜ëŠ” ë²ˆë°ê¸°ì—ì„œ ë¹›ê³¼ ì–´ë‘ ì´ ì¡°í™”ë¡­ê²Œ ì¶¤ì¶¥ë‹ˆë‹¤.',
                'dark-water': 'ì§™ì€ ë‚¨ìƒ‰ ë²ˆë°ê¸° ì†ì—ì„œ ì‹¬í•´ì˜ ë¬¼ê²°ì´ ì¼ë ì…ë‹ˆë‹¤.',
                'dark-wind': 'ê²€ì€ êµ¬ë¦„ ê°™ì€ ë²ˆë°ê¸°ê°€ ë°¤ë°”ëŒì„ íƒ€ê³  ì²œì²œíˆ íšŒì „í•©ë‹ˆë‹¤.',
                'earth-fire': 'ë¶‰ì€ í™ë¹› ë²ˆë°ê¸°ì—ì„œ ìš©ì•”ì˜ ì—´ê¸°ì™€ ëŒ€ì§€ì˜ ìƒëª…ë ¥ì´ ëŠê»´ì§‘ë‹ˆë‹¤.',
                'earth-light': 'í™©ê¸ˆë¹› ë‚˜ë¬´ ë²ˆë°ê¸°ì—ì„œ ë”°ëœ»í•œ ë¹›ê³¼ ìƒëª…ì˜ ê¸°ìš´ì´ ë„˜ì¹©ë‹ˆë‹¤.',
                'earth-water': 'ì²­ë¡ìƒ‰ ë²ˆë°ê¸°ì—ì„œ ìˆ²ì˜ ì´ìŠ¬ê³¼ ëŒ€ì§€ì˜ í–¥ê¸°ê°€ ì„ì—¬ ë‚˜ì˜µë‹ˆë‹¤.',
                'earth-wind': 'ì—°ë‘ë¹› ë²ˆë°ê¸°ê°€ ë¯¸í’ì— í”ë“¤ë¦¬ë©° ìƒˆì‹¹ì˜ í–¥ê¸°ë¥¼ í’ê¹ë‹ˆë‹¤.',
                'fire-light': 'ì°¬ë€í•œ í™©ê¸ˆë¹› ë²ˆë°ê¸°ì—ì„œ íƒœì–‘ ê°™ì€ ë¹›ê³¼ ì—´ê¸°ê°€ ë¿œì–´ì ¸ ë‚˜ì˜µë‹ˆë‹¤.',
                'fire-water': 'ë¶‰ì€ ìˆ˜ì¦ê¸°ë¡œ ë‘˜ëŸ¬ì‹¸ì¸ ë²ˆë°ê¸°ì—ì„œ ë¶ˆê³¼ ë¬¼ì´ ì—­ë™ì ìœ¼ë¡œ ì„ì…ë‹ˆë‹¤.',
                'fire-wind': 'ì£¼í™©ë¹› ë²ˆë°ê¸° ì£¼ë³€ìœ¼ë¡œ ëœ¨ê±°ìš´ ë°”ëŒì´ ì†Œìš©ëŒì´ì¹©ë‹ˆë‹¤.',
                'light-water': 'ì€ì€í•œ ì²­ë°±ìƒ‰ ë²ˆë°ê¸°ì—ì„œ ë§‘ì€ ë¹›ê³¼ ì‹œì›í•œ ê¸°ìš´ì´ í¼ì§‘ë‹ˆë‹¤.',
                'light-wind': 'ë¹›ë‚˜ëŠ” ë°±ìƒ‰ ë²ˆë°ê¸°ê°€ ë¹›ì˜ ë°”ëŒì„ íƒ€ê³  ë¶€ë“œëŸ½ê²Œ ë– ì˜¤ë¦…ë‹ˆë‹¤.',
                'water-wind': 'í•˜ëŠ˜ë¹› ë²ˆë°ê¸° ì£¼ë³€ì— ë¬¼ì•ˆê°œì™€ ì‚°ë“¤ë°”ëŒì´ ê°ë•ë‹ˆë‹¤.'
            }
        };

        const PARAM_ICONS = {
            intelligence: 'ğŸ§ ',
            strength: 'ğŸ’ª',
            charm: 'ğŸ’–',
            affection: 'â¤ï¸'
        };

        const ENV_ICONS = {
            fire: 'ğŸ”¥',
            water: 'ğŸ’§',
            wind: 'ğŸŒ¬ï¸',
            earth: 'ğŸŒ±',
            light: 'âœ¨',
            dark: 'ğŸŒ™'
        };

        const MUSIC_TYPES = {
            classic: { name: 'í´ë˜ì‹ ğŸ»', icon: 'ğŸ»', effect: 'ì§€ë ¥ +10' },
            jazz: { name: 'ì¬ì¦ˆ ğŸ·', icon: 'ğŸ·', effect: 'ë§¤ë ¥ +10' },
            rock: { name: 'ë¡ ğŸ¸', icon: 'ğŸ¸', effect: 'ì²´ë ¥ +10' },
            pop: { name: 'íŒ ğŸ¤', icon: 'ğŸ¤', effect: 'ì§€ë ¥ +5, ë§¤ë ¥ +5' },
            ballad: { name: 'ë°œë¼ë“œ ğŸ¹', icon: 'ğŸ¹', effect: 'ì²´ë ¥ +5, ë§¤ë ¥ +5' }
        };

        const DECORATION_TYPES = {
            // ë¶ˆ ì†ì„± (6ê°œ)
            fire_common1: { name: 'ìš©ì•”ì„', icon: 'ğŸ”¥', attr: 'fire', power: 1, quality: 'common', price: 30 },
            fire_common2: { name: 'í™”ì‚°ì¬', icon: 'ğŸŒ‹', attr: 'fire', power: 1, quality: 'common', price: 30 },
            fire_rare1: { name: 'ë¶ˆê½ƒ ì¡°ê°ìƒ', icon: 'ğŸ”†', attr: 'fire', power: 2, quality: 'rare', price: 60 },
            fire_rare2: { name: 'íƒ€ì˜¤ë¥´ëŠ” ë¨í”„', icon: 'ğŸ®', attr: 'fire', power: 2, quality: 'rare', price: 60 },
            fire_epic: { name: 'ë¶ˆì‚¬ì¡° ê¹ƒí„¸', icon: 'ğŸ¦…', attr: 'fire', power: 3, quality: 'epic', price: 100 },
            fire_legendary: { name: 'íƒœì´ˆì˜ ë¶ˆê½ƒ', icon: 'ğŸ”±', attr: 'fire', power: 5, quality: 'legendary', price: 999 },
            
            // ë¬¼ ì†ì„± (6ê°œ)
            water_common1: { name: 'ë¶„ìˆ˜', icon: 'ğŸ’§', attr: 'water', power: 1, quality: 'common', price: 30 },
            water_common2: { name: 'ì¡°ì•½ëŒ', icon: 'ğŸª¨', attr: 'water', power: 1, quality: 'common', price: 30 },
            water_rare1: { name: 'ì‚°í˜¸ ì¥ì‹', icon: 'ğŸª¸', attr: 'water', power: 2, quality: 'rare', price: 60 },
            water_rare2: { name: 'ë¬¼ë°©ìš¸ êµ¬ìŠ¬', icon: 'ğŸ’', attr: 'water', power: 2, quality: 'rare', price: 60 },
            water_epic: { name: 'ì¸ì–´ì˜ ëˆˆë¬¼', icon: 'ğŸ§œ', attr: 'water', power: 3, quality: 'epic', price: 100 },
            water_legendary: { name: 'ì‹¬í•´ì˜ ì‹¬ì¥', icon: 'ğŸ«€', attr: 'water', power: 5, quality: 'legendary', price: 999 },
            
            // ë°”ëŒ ì†ì„± (6ê°œ)
            wind_common1: { name: 'ë°”ëŒê°œë¹„', icon: 'ğŸŒ¬ï¸', attr: 'wind', power: 1, quality: 'common', price: 30 },
            wind_common2: { name: 'ë¶€ë“œëŸ¬ìš´ ê¹ƒí„¸', icon: 'ğŸª¶', attr: 'wind', power: 1, quality: 'common', price: 30 },
            wind_rare1: { name: 'í’ê²½', icon: 'ğŸ', attr: 'wind', power: 2, quality: 'rare', price: 60 },
            wind_rare2: { name: 'ë‚˜ë¹„ í‘œë³¸', icon: 'ğŸ¦‹', attr: 'wind', power: 2, quality: 'rare', price: 60 },
            wind_epic: { name: 'í•˜ëŠ˜ì˜ ê¹ƒí„¸', icon: 'â˜ï¸', attr: 'wind', power: 3, quality: 'epic', price: 100 },
            wind_legendary: { name: 'í­í’ì˜ ëˆˆ', icon: 'ğŸŒ€', attr: 'wind', power: 5, quality: 'legendary', price: 999 },
            
            // ë•… ì†ì„± (6ê°œ)
            earth_common1: { name: 'í™”ë¶„', icon: 'ğŸŒ±', attr: 'earth', power: 1, quality: 'common', price: 30 },
            earth_common2: { name: 'ì´ë¼ëŒ', icon: 'ğŸªµ', attr: 'earth', power: 1, quality: 'common', price: 30 },
            earth_rare1: { name: 'ë‚˜ë¬´ ì¡°ê°', icon: 'ğŸŒ³', attr: 'earth', power: 2, quality: 'rare', price: 60 },
            earth_rare2: { name: 'ë²„ì„¯ êµ°ë½', icon: 'ğŸ„', attr: 'earth', power: 2, quality: 'rare', price: 60 },
            earth_epic: { name: 'ì„¸ê³„ìˆ˜ ê°€ì§€', icon: 'ğŸŒ²', attr: 'earth', power: 3, quality: 'epic', price: 100 },
            earth_legendary: { name: 'ëŒ€ì§€ì˜ ì •ìˆ˜', icon: 'ğŸ’', attr: 'earth', power: 5, quality: 'legendary', price: 999 },
            
            // ë¹› ì†ì„± (6ê°œ)
            light_common1: { name: 'ìˆ˜ì •', icon: 'âœ¨', attr: 'light', power: 1, quality: 'common', price: 30 },
            light_common2: { name: 'ë°˜ì§ì´ ê°€ë£¨', icon: 'â­', attr: 'light', power: 1, quality: 'common', price: 30 },
            light_rare1: { name: 'ë¹›ë‚˜ëŠ” ë³´ì„', icon: 'ğŸ’ ', attr: 'light', power: 2, quality: 'rare', price: 60 },
            light_rare2: { name: 'íƒœì–‘ì„', icon: 'â˜€ï¸', attr: 'light', power: 2, quality: 'rare', price: 60 },
            light_epic: { name: 'ë³„ì˜ íŒŒí¸', icon: 'ğŸŒŸ', attr: 'light', power: 3, quality: 'epic', price: 100 },
            light_legendary: { name: 'ì²œìƒì˜ ê´‘íœ˜', icon: 'ğŸ‘¼', attr: 'light', power: 5, quality: 'legendary', price: 999 },
            
            // ì–´ë‘  ì†ì„± (6ê°œ)
            dark_common1: { name: 'í‘ìš”ì„', icon: 'ğŸŒ™', attr: 'dark', power: 1, quality: 'common', price: 30 },
            dark_common2: { name: 'ê²€ì€ ëª¨ë˜', icon: 'ğŸ–¤', attr: 'dark', power: 1, quality: 'common', price: 30 },
            dark_rare1: { name: 'ë‹¬ë¹›ì„', icon: 'ğŸŒ‘', attr: 'dark', power: 2, quality: 'rare', price: 60 },
            dark_rare2: { name: 'ê·¸ë¦¼ì ìˆ˜ì •', icon: 'ğŸ”®', attr: 'dark', power: 2, quality: 'rare', price: 60 },
            dark_epic: { name: 'ë°¤ì˜ ì •ìˆ˜', icon: 'ğŸŒŒ', attr: 'dark', power: 3, quality: 'epic', price: 100 },
            dark_legendary: { name: 'ì˜ì›í•œ ì–´ë‘ ', icon: 'ğŸ•³ï¸', attr: 'dark', power: 5, quality: 'legendary', price: 999 }
        };

        const FOOD_NAMES = {
            fire: 'ë¶ˆê½ƒì—´ë§¤',
            water: 'ë§‘ì€ì´ìŠ¬',
            wind: 'ë°”ëŒê¿€',
            earth: 'ëŒ€ì§€ë²„ì„¯',
            light: 'ë¹›ë‚˜ëŠ” ë„¥íƒ€',
            dark: 'ê²€ì€ ê½ƒê°€ë£¨'
        };
        
        // ì•½ì´ˆ ì•„ì´í…œ
        const MEDICINE = {
            name: 'ë§Œë³‘í†µì¹˜ ì•½ì´ˆ',
            icon: 'ğŸŒ¿',
            price: 50,
            description: 'ì •ë ¹ì˜ ì§ˆë³‘ì„ ì¹˜ë£Œí•©ë‹ˆë‹¤'
        };



        // ë„ê° íŒíŠ¸ ë°ì´í„°
        const ENCYCLOPEDIA_HINTS = {
            // ì „ì„¤
            'titania': 'ë‚˜ë¹„ë¥¼ ê±°ëŠë¦¬ëŠ” ì •ë ¹ë“¤ì˜ êµ°ì£¼.',
            'oberon': 'ë‚˜ë°©ì„ ê±°ëŠë¦¬ëŠ” ì •ë ¹ë“¤ì˜ êµ°ì£¼.',
            
            // ë°±ì˜ ì •ë ¹
            'nostat-normal': 'ìˆœìˆ˜í•œ ë°±ìƒ‰. ì•„ë¬´ ì†ì„±ë„ ê¹ƒë“¤ì§€ ì•Šì€ ì •ë ¹.',
            'intelligent-low-normal': 'ì§€í˜œë¡­ì§€ë§Œ ìˆœìˆ˜í•œ ì •ë ¹.',
            'intelligent-mid-normal': 'ì§€ì ì´ë©° ìˆœìˆ˜í•œ ì •ë ¹.',
            'intelligent-high-normal': 'ì„¸ìƒì˜ ì§€í˜œë¥¼ ë‹´ì€ ìˆœìˆ˜í•œ ì •ë ¹.',
            'strong-low-normal': 'íŠ¼íŠ¼í•˜ì§€ë§Œ ìˆœìˆ˜í•œ ì •ë ¹.',
            'strong-mid-normal': 'ê°•í•˜ë©° ìˆœìˆ˜í•œ ì •ë ¹.',
            'strong-high-normal': 'ì„¸ìƒì˜ í˜ì„ ë‹´ì€ ìˆœìˆ˜í•œ ì •ë ¹.',
            'beautiful-low-normal': 'ê·€ì—½ê³  ìˆœìˆ˜í•œ ì •ë ¹.',
            'beautiful-mid-normal': 'ì•„ë¦„ë‹µê³  ìˆœìˆ˜í•œ ì •ë ¹.',
            'beautiful-high-normal': 'ì„¸ìƒì˜ ì•„ë¦„ë‹¤ì›€ì„ ë‹´ì€ ìˆœìˆ˜í•œ ì •ë ¹.',
            
            // ë¶ˆ ì†ì„±
            'nostat-fire': 'ë¶ˆì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'intelligent-low-fire': 'ë˜‘ë˜‘í•œ ë¶ˆì˜ ì •ë ¹.',
            'intelligent-mid-fire': 'ì§€ì ì¸ ë¶ˆì˜ ì •ë ¹.',
            'intelligent-high-fire': 'ì„¸ìƒì˜ ë¶ˆì„ ë‹¤ìŠ¤ë¦¬ëŠ” ì§€í˜œë¡œìš´ ì •ë ¹.',
            'strong-low-fire': 'íŠ¼íŠ¼í•œ ë¶ˆì˜ ì •ë ¹.',
            'strong-mid-fire': 'ê°•í•œ ë¶ˆì˜ ì •ë ¹.',
            'strong-high-fire': 'ì„¸ìƒì˜ ë¶ˆì„ ë‹¤ìŠ¤ë¦¬ëŠ” ê°•ì¸í•œ ì •ë ¹.',
            'beautiful-low-fire': 'ê·€ì—¬ìš´ ë¶ˆì˜ ì •ë ¹.',
            'beautiful-mid-fire': 'ì•„ë¦„ë‹¤ìš´ ë¶ˆì˜ ì •ë ¹.',
            'beautiful-high-fire': 'ì„¸ìƒì˜ ë¶ˆì„ ë‹¤ìŠ¤ë¦¬ëŠ” ë§¤í˜¹ì ì¸ ì •ë ¹.',
            
            // ë¬¼ ì†ì„±
            'nostat-water': 'ë¬¼ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'intelligent-low-water': 'ë˜‘ë˜‘í•œ ë¬¼ì˜ ì •ë ¹.',
            'intelligent-mid-water': 'ì§€ì ì¸ ë¬¼ì˜ ì •ë ¹.',
            'intelligent-high-water': 'ì„¸ìƒì˜ ë¬¼ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ì§€í˜œë¡œìš´ ì •ë ¹.',
            'strong-low-water': 'íŠ¼íŠ¼í•œ ë¬¼ì˜ ì •ë ¹.',
            'strong-mid-water': 'ê°•í•œ ë¬¼ì˜ ì •ë ¹.',
            'strong-high-water': 'ì„¸ìƒì˜ ë¬¼ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ê°•ì¸í•œ ì •ë ¹.',
            'beautiful-low-water': 'ê·€ì—¬ìš´ ë¬¼ì˜ ì •ë ¹.',
            'beautiful-mid-water': 'ì•„ë¦„ë‹¤ìš´ ë¬¼ì˜ ì •ë ¹.',
            'beautiful-high-water': 'ì„¸ìƒì˜ ë¬¼ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ë§¤í˜¹ì ì¸ ì •ë ¹.',
            
            // ë°”ëŒ ì†ì„±
            'nostat-wind': 'ë°”ëŒì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'intelligent-low-wind': 'ë˜‘ë˜‘í•œ ë°”ëŒì˜ ì •ë ¹.',
            'intelligent-mid-wind': 'ì§€ì ì¸ ë°”ëŒì˜ ì •ë ¹.',
            'intelligent-high-wind': 'ì„¸ìƒì˜ ë°”ëŒì„ ë‹¤ìŠ¤ë¦¬ëŠ” ì§€í˜œë¡œìš´ ì •ë ¹.',
            'strong-low-wind': 'íŠ¼íŠ¼í•œ ë°”ëŒì˜ ì •ë ¹.',
            'strong-mid-wind': 'ê°•í•œ ë°”ëŒì˜ ì •ë ¹.',
            'strong-high-wind': 'ì„¸ìƒì˜ ë°”ëŒì„ ë‹¤ìŠ¤ë¦¬ëŠ” ê°•ì¸í•œ ì •ë ¹.',
            'beautiful-low-wind': 'ê·€ì—¬ìš´ ë°”ëŒì˜ ì •ë ¹.',
            'beautiful-mid-wind': 'ì•„ë¦„ë‹¤ìš´ ë°”ëŒì˜ ì •ë ¹.',
            'beautiful-high-wind': 'ì„¸ìƒì˜ ë°”ëŒì„ ë‹¤ìŠ¤ë¦¬ëŠ” ë§¤í˜¹ì ì¸ ì •ë ¹.',
            
            // ë•… ì†ì„±
            'nostat-earth': 'ë•…ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'intelligent-low-earth': 'ë˜‘ë˜‘í•œ ë•…ì˜ ì •ë ¹.',
            'intelligent-mid-earth': 'ì§€ì ì¸ ë•…ì˜ ì •ë ¹.',
            'intelligent-high-earth': 'ì„¸ìƒì˜ ë•…ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ì§€í˜œë¡œìš´ ì •ë ¹.',
            'strong-low-earth': 'íŠ¼íŠ¼í•œ ë•…ì˜ ì •ë ¹.',
            'strong-mid-earth': 'ê°•í•œ ë•…ì˜ ì •ë ¹.',
            'strong-high-earth': 'ì„¸ìƒì˜ ë•…ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ê°•ì¸í•œ ì •ë ¹.',
            'beautiful-low-earth': 'ê·€ì—¬ìš´ ë•…ì˜ ì •ë ¹.',
            'beautiful-mid-earth': 'ì•„ë¦„ë‹¤ìš´ ë•…ì˜ ì •ë ¹.',
            'beautiful-high-earth': 'ì„¸ìƒì˜ ë•…ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ë§¤í˜¹ì ì¸ ì •ë ¹.',
            
            // ë¹› ì†ì„±
            'nostat-light': 'ë¹›ì˜ ê¸°ìš´ì´ ê°•í•˜ê²Œ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'intelligent-low-light': 'ë˜‘ë˜‘í•œ ë¹›ì˜ ì •ë ¹.',
            'intelligent-mid-light': 'ì§€ì ì¸ ë¹›ì˜ ì •ë ¹.',
            'intelligent-high-light': 'ì„¸ìƒì˜ ë¹›ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ì§€í˜œë¡œìš´ ì •ë ¹.',
            'strong-low-light': 'íŠ¼íŠ¼í•œ ë¹›ì˜ ì •ë ¹.',
            'strong-mid-light': 'ê°•í•œ ë¹›ì˜ ì •ë ¹.',
            'strong-high-light': 'ì„¸ìƒì˜ ë¹›ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ê°•ì¸í•œ ì •ë ¹.',
            'beautiful-low-light': 'ê·€ì—¬ìš´ ë¹›ì˜ ì •ë ¹.',
            'beautiful-mid-light': 'ì•„ë¦„ë‹¤ìš´ ë¹›ì˜ ì •ë ¹.',
            'beautiful-high-light': 'ì„¸ìƒì˜ ë¹›ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ë§¤í˜¹ì ì¸ ì •ë ¹.',
            
            // ì–´ë‘  ì†ì„±
            'nostat-dark': 'ì–´ë‘ ì˜ ê¸°ìš´ì´ ê°•í•˜ê²Œ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'intelligent-low-dark': 'ë˜‘ë˜‘í•œ ì–´ë‘ ì˜ ì •ë ¹.',
            'intelligent-mid-dark': 'ì§€ì ì¸ ì–´ë‘ ì˜ ì •ë ¹.',
            'intelligent-high-dark': 'ì„¸ìƒì˜ ì–´ë‘ ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ì§€í˜œë¡œìš´ ì •ë ¹.',
            'strong-low-dark': 'íŠ¼íŠ¼í•œ ì–´ë‘ ì˜ ì •ë ¹.',
            'strong-mid-dark': 'ê°•í•œ ì–´ë‘ ì˜ ì •ë ¹.',
            'strong-high-dark': 'ì„¸ìƒì˜ ì–´ë‘ ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ê°•ì¸í•œ ì •ë ¹.',
            'beautiful-low-dark': 'ê·€ì—¬ìš´ ì–´ë‘ ì˜ ì •ë ¹.',
            'beautiful-mid-dark': 'ì•„ë¦„ë‹¤ìš´ ì–´ë‘ ì˜ ì •ë ¹.',
            'beautiful-high-dark': 'ì„¸ìƒì˜ ì–´ë‘ ì„ ë‹¤ìŠ¤ë¦¬ëŠ” ë§¤í˜¹ì ì¸ ì •ë ¹.',
            
            // ë³µí•© ì†ì„± (ê°„ëµí•˜ê²Œ)
            'nostat-fire-water': 'ë¶ˆê³¼ ë¬¼ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-fire-wind': 'ë¶ˆê³¼ ë°”ëŒì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-fire-earth': 'ë¶ˆê³¼ ë•…ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-fire-light': 'ë¶ˆê³¼ ë¹›ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-fire-dark': 'ë¶ˆê³¼ ì–´ë‘ ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-water-wind': 'ë¬¼ê³¼ ë°”ëŒì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-water-earth': 'ë¬¼ê³¼ ë•…ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-water-light': 'ë¬¼ê³¼ ë¹›ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-water-dark': 'ë¬¼ê³¼ ì–´ë‘ ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-wind-earth': 'ë°”ëŒê³¼ ë•…ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-wind-light': 'ë°”ëŒê³¼ ë¹›ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-wind-dark': 'ë°”ëŒê³¼ ì–´ë‘ ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-earth-light': 'ë•…ê³¼ ë¹›ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-earth-dark': 'ë•…ê³¼ ì–´ë‘ ì˜ ê¸°ìš´ì´ ëŠê»´ì§€ëŠ” ì •ë ¹.',
            'nostat-light-dark': 'ë¹›ê³¼ ì–´ë‘ ì´ ê³µì¡´í•˜ëŠ” ì‹ ë¹„ë¡œìš´ ì •ë ¹.',
            'nostat-balanced': 'ëª¨ë“  ì†ì„±ì´ ì¡°í™”ë¡­ê²Œ ê· í˜•ì¡íŒ ì •ë ¹.',
            'nostat-multi': 'ì—¬ëŸ¬ ì†ì„±ì´ ë’¤ì„ì¸ í˜¼ëˆì˜ ì •ë ¹.'
        };

        // ìƒíƒœ í‚¤ì›Œë“œ ì‹œìŠ¤í…œ
        function getStatusKeywords(spirit) {
            const keywords = [];
            const keywordColor = '#2a2a2a';  // ê²€ì •ìƒ‰ í†µì¼
            
            // ì• ì •ë„ ê¸°ë°˜
            if (spirit.parameters.affection >= 100) {
                keywords.push({ text: 'ì‚¬ë‘ì´ ê°€ë“í•œ', color: keywordColor });
            } else if (spirit.parameters.affection >= 70) {
                keywords.push({ text: 'ì• ì • ì–´ë¦°', color: keywordColor });
            } else if (spirit.parameters.affection <= 10) {
                keywords.push({ text: 'ê²½ê³„í•˜ëŠ”', color: keywordColor });
            }
            
            // ì§ˆë³‘ ìƒíƒœ
            if (spirit.isSick) {
                keywords.push({ text: 'ì§ˆë³‘ì— ê±¸ë¦°', color: keywordColor });
            }
            
            // ìŒì•… ì²­ì·¨ íšŸìˆ˜ (musicListened ì¹´ìš´íŠ¸)
            if (spirit.musicListened >= 10) {
                keywords.push({ text: 'ìŒì•…ì„ ì‚¬ë‘í•˜ëŠ”', color: keywordColor });
            }
            
            // ìŠ¤íƒ¯ ê¸°ë°˜
            if (spirit.parameters.intelligence >= 80) {
                keywords.push({ text: 'í˜„ëª…í•œ', color: keywordColor });
            }
            if (spirit.parameters.strength >= 80) {
                keywords.push({ text: 'ê°•ì¸í•œ', color: keywordColor });
            }
            if (spirit.parameters.charm >= 80) {
                keywords.push({ text: 'ë§¤í˜¹ì ì¸', color: keywordColor });
            }
            
            // ì„±ì¥ ë‹¨ê³„ ê¸°ë°˜
            const stage = getStage(spirit.growth);
            if (stage === 'adult' && !spirit.isCompleted) {
                keywords.push({ text: 'ë²ˆë°ê¸°ê°€ ëœ', color: keywordColor });
            }
            
            // ë§Œì¡±ë„ ê¸°ë°˜
            if (spirit.satisfaction === 'high') {
                keywords.push({ text: 'í–‰ë³µí•œ', color: keywordColor });
            } else if (spirit.satisfaction === 'low') {
                keywords.push({ text: 'ë¶ˆë§Œì¡±ìŠ¤ëŸ¬ìš´', color: keywordColor });
            }
            
            // ë°©ì¹˜ ì‹œê°„ ê¸°ë°˜ (30ë¶„ ì´ìƒ)
            const timeSinceInteraction = Date.now() - (spirit.lastInteraction || Date.now());
            if (timeSinceInteraction > 30 * 60 * 1000) {
                keywords.push({ text: 'ì™¸ë¡œìš´', color: keywordColor });
            }
            
            // í…Œë¼ë¦¬ì›€ í™˜ê²½ê³¼ ì†ì„± ì¼ì¹˜ë„
            const dominantAttr = getDominantAttribute(spirit);
            const terrariumEnv = Object.keys(terrarium).reduce((a, b) => 
                terrarium[a] > terrarium[b] ? a : b
            );
            if (dominantAttr === terrariumEnv && terrarium[terrariumEnv] >= 30) {
                keywords.push({ text: 'í™˜ê²½ì— ì ì‘í•œ', color: keywordColor });
            }
            
            // ë¹›/ì–´ë‘  ì‹œê°„ ê¸°ë°˜
            if (spirit.lightTime >= 10) {
                keywords.push({ text: 'íƒœì–‘ì„ ë™ê²½í•˜ëŠ”', color: keywordColor });
            }
            if (spirit.darkTime >= 10) {
                keywords.push({ text: 'ì–´ë‘ ì„ ì¢‹ì•„í•˜ëŠ”', color: keywordColor });
            }
            
            // ë¨¹ì´ íšŸìˆ˜ (feedCount ì¹´ìš´íŠ¸)
            if (spirit.feedCount >= 20) {
                keywords.push({ text: 'ë¯¸ì‹ê°€', color: keywordColor });
            }
            
            return keywords;
        }

                // ìƒì  ê°€ê²©í‘œ
        const SHOP_PRICES = {
            // íŒë§¤ ê°€ê²© (ì¸ë²¤í† ë¦¬ â†’ ì½”ì¸)
            sell: {
                food_common: 8,    // ì¼ë°˜ ë¨¹ì´ íŒë§¤
                food_rare: 15,     // í¬ê·€ ë¨¹ì´ íŒë§¤
                decoration: 15,    // ì¥ì‹ë¬¼ 1ê°œ = 15ì½”ì¸
                music: 25          // ìŒì•… 1ê°œ = 25ì½”ì¸
            },
            // êµ¬ë§¤ ê°€ê²© (ì½”ì¸ â†’ ì¸ë²¤í† ë¦¬)
            buy: {
                food_common: 20,   // ì¼ë°˜ ë¨¹ì´ (í™”ìˆ˜í’ì§€)
                food_rare: 40,     // í¬ê·€ ë¨¹ì´ (ë¹›ì•”)
                music: 80,         // ìŒì•… ë ˆì½”ë“œ
                decoration: 50     // ì¥ì‹ë¬¼
            }
        };

        const EVOLUTION_TYPES = {
            // ë…¸ë©€ (ëª¨ë“  ìŠ¤íƒ­ì´ 10 ë¯¸ë§Œ)
            normal: { name: 'ë°±ì˜ ì •ë ¹', icon: 'ğŸ¤', desc: 'ìˆœìˆ˜í•œ ë¹›ì„ ê°„ì§í•œ ì •ë ¹. ëª¨ë“  ì •ë ¹ì˜ ì‹œì‘ì´ì ê·¼ì›.' },
            
            // ì§€ì ì¸ ê³„ì—´ (intelligence ìµœê³ )
            'intelligent-low': { prefix: 'ë˜‘ë˜‘í•œ', icon: 'âœ¨' },
            'intelligent-mid': { prefix: 'ì§€ì ì¸', icon: 'ğŸ’' },
            'intelligent-high': { prefix: 'ì„¸ìƒì˜ ë¹„ë°€ì„ ì•„ëŠ”', icon: 'ğŸ”®' },
            
            // ê°•í•œ ê³„ì—´ (strength ìµœê³ )
            'strong-low': { prefix: 'íŠ¼íŠ¼í•œ', icon: 'âœ¨' },
            'strong-mid': { prefix: 'ê°•í•œ', icon: 'ğŸ’ª' },
            'strong-high': { prefix: 'ì„¸ìƒì„ ë°›ì¹˜ëŠ”', icon: 'âš¡' },
            
            // ì•„ë¦„ë‹¤ìš´ ê³„ì—´ (charm ìµœê³ )
            'beautiful-low': { prefix: 'ê·€ì—¬ìš´', icon: 'âœ¨' },
            'beautiful-mid': { prefix: 'ì•„ë¦„ë‹¤ìš´', icon: 'ğŸŒ¸' },
            'beautiful-high': { prefix: 'ì„¸ìƒì„ ë§¤í˜¹í•˜ëŠ”', icon: 'ğŸŒº' }
        };
        
        // ì†ì„±ë³„ ì •ë ¹ ì´ë¦„
        const ATTRIBUTE_NAMES = {
            normal: { name: 'ë°±ì˜ ì •ë ¹', icon: 'âšª', desc: 'ìˆœìˆ˜í•œ ë°±ìƒ‰ì˜ ë¹›ì„ ì§€ë‹Œ ì •ë ¹.' },
            fire: { name: 'í™”ì—¼ì˜ ì •ë ¹', icon: 'ğŸ”¥', desc: 'íƒ€ì˜¤ë¥´ëŠ” ì—´ì •ì„ ê°„ì§í•œ í™”ì—¼ì˜ ì •ë ¹.' },
            water: { name: 'ë¹™í•˜ì˜ ì •ë ¹', icon: 'ğŸ’§', desc: 'ì°¨ê°€ìš´ ì§€í˜œë¥¼ í’ˆì€ ë¬¼ì˜ ì •ë ¹.' },
            wind: { name: 'ì§ˆí’ì˜ ì •ë ¹', icon: 'ğŸŒ¬ï¸', desc: 'ììœ ë¡œìš´ ë°”ëŒì„ ë‹´ì€ ì§ˆí’ì˜ ì •ë ¹.' },
            earth: { name: 'ëŒ€ì§€ì˜ ì •ë ¹', icon: 'ğŸŒ±', desc: 'ê²¬ê³ í•œ ëŒ€ì§€ì˜ í˜ì„ ì§€ë‹Œ ì •ë ¹.' },
            light: { name: 'ê´‘ëª…ì˜ ì •ë ¹', icon: 'âœ¨', desc: 'ì°¬ë€í•œ ë¹›ìœ¼ë¡œ ê°€ë“í•œ ê´‘ëª…ì˜ ì •ë ¹.' },
            dark: { name: 'ì•”í‘ì˜ ì •ë ¹', icon: 'ğŸŒ™', desc: 'ì‹ ë¹„ë¡œìš´ ì–´ë‘ ì„ ë‹´ì€ ì•”í‘ì˜ ì •ë ¹.' },
            
            // 2ì†ì„± ì¡°í•©
            'fire-water': { name: 'ì¦ê¸°ì˜ ì •ë ¹', icon: 'ğŸ’¨', desc: 'ë¶ˆê³¼ ë¬¼ì´ ë§Œë‚˜ íƒ„ìƒí•œ ì¦ê¸°ì˜ ì •ë ¹.' },
            'fire-wind': { name: 'í­í’ì˜ ì •ë ¹', icon: 'ğŸŒªï¸', desc: 'ë¶ˆê³¼ ë°”ëŒì´ ë§Œë“  ëœ¨ê±°ìš´ í­í’ì˜ ì •ë ¹.' },
            'fire-earth': { name: 'ìš©ì•”ì˜ ì •ë ¹', icon: 'ğŸŒ‹', desc: 'ë¶ˆê³¼ ëŒ€ì§€ê°€ ë¹šì–´ë‚¸ ìš©ì•”ì˜ ì •ë ¹.' },
            'fire-light': { name: 'íƒœì–‘ì˜ ì •ë ¹', icon: 'â˜€ï¸', desc: 'ë¶ˆê³¼ ë¹›ì´ í•©ì³ì§„ íƒœì–‘ì˜ ì •ë ¹.' },
            'fire-dark': { name: 'ì—°ê¸°ì˜ ì •ë ¹', icon: 'ğŸ’¨', desc: 'ë¶ˆê³¼ ì–´ë‘ ì´ ë§Œë“  ì—°ê¸°ì˜ ì •ë ¹.' },
            'water-wind': { name: 'êµ¬ë¦„ì˜ ì •ë ¹', icon: 'â˜ï¸', desc: 'ë¬¼ê³¼ ë°”ëŒì´ ë§Œë“  êµ¬ë¦„ì˜ ì •ë ¹.' },
            'water-earth': { name: 'ì§„í™ì˜ ì •ë ¹', icon: 'ğŸª¨', desc: 'ë¬¼ê³¼ ëŒ€ì§€ê°€ ì„ì¸ ì§„í™ì˜ ì •ë ¹.' },
            'water-light': { name: 'ë¬´ì§€ê°œì˜ ì •ë ¹', icon: 'ğŸŒˆ', desc: 'ë¬¼ê³¼ ë¹›ì´ ë§Œë“  ë¬´ì§€ê°œì˜ ì •ë ¹.' },
            'water-dark': { name: 'ì•ˆê°œì˜ ì •ë ¹', icon: 'ğŸŒ«ï¸', desc: 'ë¬¼ê³¼ ì–´ë‘ ì´ ë§Œë“  ì•ˆê°œì˜ ì •ë ¹.' },
            'earth-wind': { name: 'ëª¨ë˜ì˜ ì •ë ¹', icon: 'ğŸœï¸', desc: 'ë°”ëŒê³¼ ëŒ€ì§€ê°€ ë§Œë“  ëª¨ë˜ì˜ ì •ë ¹.' },
            'light-wind': { name: 'ì˜¤ë¡œë¼ì˜ ì •ë ¹', icon: 'ğŸŒŒ', desc: 'ë°”ëŒê³¼ ë¹›ì´ ë§Œë“  ì˜¤ë¡œë¼ì˜ ì •ë ¹.' },
            'dark-wind': { name: 'íšŒì˜¤ë¦¬ì˜ ì •ë ¹', icon: 'ğŸŒ€', desc: 'ë°”ëŒê³¼ ì–´ë‘ ì´ ë§Œë“  íšŒì˜¤ë¦¬ì˜ ì •ë ¹.' },
            'earth-light': { name: 'ìˆ˜ì •ì˜ ì •ë ¹', icon: 'ğŸ’', desc: 'ëŒ€ì§€ì™€ ë¹›ì´ ë§Œë“  ìˆ˜ì •ì˜ ì •ë ¹.' },
            'dark-earth': { name: 'ë™êµ´ì˜ ì •ë ¹', icon: 'â›°ï¸', desc: 'ëŒ€ì§€ì™€ ì–´ë‘ ì´ ë§Œë“  ë™êµ´ì˜ ì •ë ¹.' },
            'dark-light': { name: 'í™˜í˜¹ì˜ ì •ë ¹', icon: 'âœ¨ğŸŒ™', desc: 'ë¹›ê³¼ ì–´ë‘ ì´ ê³µì¡´í•˜ëŠ” í™˜í˜¹ì˜ ì •ë ¹.' },
            
            // 3ì†ì„± ì´ìƒ (ë³µí•©)
            balanced: { name: 'ì¡°í™”ì˜ ì •ë ¹', icon: 'âš–ï¸', desc: 'ëª¨ë“  ì†ì„±ì´ ì¡°í™”ë¡­ê²Œ ê· í˜• ì¡íŒ ì •ë ¹.' },
            multi: { name: 'í˜¼ëˆì˜ ì •ë ¹', icon: 'ğŸŒªï¸', desc: 'ì—¬ëŸ¬ ì†ì„±ì´ ë’¤ì„ì¸ í˜¼ëˆì˜ ì •ë ¹.' }
        };

        function loadGame() {
            const saved = localStorage.getItem('spiritGardenV2');
            if (saved) {
                const data = JSON.parse(saved);
                spirits = data.spirits || [];
                collection = data.collection || [];
                encyclopedia = data.encyclopedia || {};
                
                // ê¸°ì¡´ ë„ê° ë°ì´í„° í˜¸í™˜ì„± ì²˜ë¦¬ - ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì§„í™” íƒ€ì… ì œê±°
                collection = collection.filter(item => {
                    return EVOLUTION_TYPES[item.type] !== undefined;
                });
                
                inventory = data.inventory || { 
                    music: [], 
                    decorations: [],
                    food: ['fire', 'fire', 'fire', 'water', 'water', 'water', 'wind', 'wind', 'wind', 'earth', 'earth', 'earth']
                };
                
                // ì˜ëª»ëœ ìŒì•… í‚¤ ì œê±° (quest, lullaby ë“± â†’ classic, jazz ë“±)
                if (inventory.music) {
                    const validMusicKeys = ['classic', 'jazz', 'rock', 'pop', 'ballad'];
                    inventory.music = inventory.music.filter(m => validMusicKeys.includes(m));
                }
                
                // ê¸°ì¡´ ì¥ì‹ë¬¼ í‚¤ë¥¼ ìƒˆ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (fire â†’ fire_common1 ë“±)
                const oldToNewDecoMapping = {
                    fire: 'fire_common1',
                    water: 'water_common1',
                    wind: 'wind_common1',
                    earth: 'earth_common1',
                    light: 'light_common1',
                    dark: 'dark_common1'
                };
                
                if (inventory.decorations) {
                    inventory.decorations = inventory.decorations.map(d => {
                        // ì´ë¯¸ ìƒˆ í˜•ì‹ì´ë©´ ê·¸ëŒ€ë¡œ, ì•„ë‹ˆë©´ ë³€í™˜
                        return oldToNewDecoMapping[d] || d;
                    });
                }
                
                if (installedDecorations) {
                    installedDecorations = installedDecorations.map(d => {
                        return oldToNewDecoMapping[d] || d;
                    });
                }
                
                terrarium = data.terrarium || {
                    fire: 0, water: 0, wind: 0, earth: 0, light: 0, dark: 0
                };
                installedDecorations = data.installedDecorations || [];
                
                // ê¸°ì¡´ ë¬¸ìì—´ ë°°ì—´ì„ ê°ì²´ ë°°ì—´ë¡œ ë³€í™˜ (í•˜ìœ„ í˜¸í™˜ì„±)
                installedDecorations = installedDecorations.map((d, index) => {
                    if (typeof d === 'string') {
                        return { type: d, index: index };
                    }
                    return d;
                });
                
                lightMode = data.lightMode !== undefined ? data.lightMode : true;
                coins = data.coins || 0;
                lastGatherTime = data.lastGatherTime || null;
                currentTitle = data.currentTitle || 'none';
                isPaused = data.isPaused || false;
                darkModeLocked = data.darkModeLocked || false;

                // ì¹­í˜¸ UI ë°˜ì˜
                const titleSelect = document.getElementById('titleSelect');
                if (titleSelect) {
                    titleSelect.value = currentTitle;
                }
                
                // ì¼ì‹œì •ì§€ ë²„íŠ¼ UI ë°˜ì˜
                const pauseBtn = document.getElementById('pauseBtn');
                if (pauseBtn && isPaused) {
                    pauseBtn.textContent = 'â–¶ï¸';
                    pauseBtn.classList.add('paused');
                    pauseBtn.title = 'ì¬ê°œ';
                }

                // ì„¤ì¹˜ëœ ì¥ì‹ë¬¼ë¡œ í™˜ê²½ ì¬ê³„ì‚°
                if (installedDecorations.length > 0) {
                    recalculateTerrariumEnvironment();
                }
                
                // ê¸°ì¡´ ì •ë ¹ë“¤ì˜ ë§Œì¡±ë„ ì´ˆê¸°í™” (í•˜ìœ„ í˜¸í™˜ì„±)
                spirits.forEach(spirit => {
                    if (!spirit.satisfaction) {
                        spirit.satisfaction = 'mid';
                    }
                });

                // ì¡°ëª… ìƒíƒœ ì ìš©
                applyLightMode();
            }
        }

        function saveGame() {
            localStorage.setItem('spiritGardenV2', JSON.stringify({
                spirits,
                collection,
                encyclopedia,
                inventory,
                terrarium,
                installedDecorations,
                lightMode,
                coins,
                lastGatherTime,
                currentTitle,
                currentGatherLocation,
                isPaused,
                darkModeLocked
            }));
        }

        const EGG_NAMES = [
            'ë°˜ì§ì´ëŠ” ì•Œ', 'ë§¤ëˆë§¤ëˆí•œ ì•Œ', 'ì–¼ë£©ë¬´ëŠ¬ ì•Œ', 'ë³´ë¼ìƒ‰ ì•Œ',
            'íˆ¬ëª…í•œ ì•Œ', 'í™©ê¸ˆë¹› ì•Œ', 'ì€ë¹› ì•Œ', 'ê²€ì€ìƒ‰ ì•Œ',
            'í•˜ì–€ìƒ‰ ì•Œ', 'ë¬´ì§€ê°œ ì•Œ', 'ì‘ì€ ì•Œ', 'í° ì•Œ',
            'ë”°ëœ»í•œ ì•Œ', 'ì°¨ê°€ìš´ ì•Œ', 'ë¶€ë“œëŸ¬ìš´ ì•Œ', 'ë‹¨ë‹¨í•œ ì•Œ'
        ];

        function addLog(spirit, message) {
            if (!spirit.logs) spirit.logs = [];
            const timestamp = new Date().toLocaleString('ko-KR', {
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
            spirit.logs.unshift({ time: timestamp, message }); // ìµœì‹ ì´ ìœ„ë¡œ
            if (spirit.logs.length > 50) spirit.logs.pop(); // ìµœëŒ€ 50ê°œ ìœ ì§€
            
            // ì¼ì§€ ì¶”ê°€ ì‹œì—ë§Œ ì „ì²´ ë Œë”ë§
            renderSpirits();
        }

        function createNewSpirit() {
            if (spirits.length >= 6) {
                showNotification('ì •ì›ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤ (ìµœëŒ€ 6ë§ˆë¦¬)');
                return;
            }

            const randomName = EGG_NAMES[Math.floor(Math.random() * EGG_NAMES.length)];

            const spirit = {
                id: Date.now(),
                name: randomName,
                growth: 0,
                // ê³µê°œ ìŠ¤íƒ¯
                parameters: {
                    intelligence: 0,  // ì§€ë ¥
                    strength: 0,      // ì²´ë ¥
                    charm: 0,         // ë§¤ë ¥
                    affection: 0      // ì• ì •
                },
                // ìˆ¨ê²¨ì§„ ì†ì„± (ì§„í™” ê²°ì •)
                hiddenAttributes: {
                    fire: 0,
                    water: 0,
                    wind: 0,
                    earth: 0,
                    light: 0,
                    dark: 0
                },
                satisfaction: 'mid',  // ë§Œì¡±ë„: 'high', 'mid', 'low'
                lastFed: null,
                lastMusic: null,
                lastPat: null,
                lastDecorate: null,
                lastInteraction: Date.now(),  // ë§ˆì§€ë§‰ ìƒí˜¸ì‘ìš© ì‹œê°„
                status: 'ë°°ê³ íŒŒ ë³´ì…ë‹ˆë‹¤...',
                birthTime: Date.now(),
                logs: [],  // ì¼ì§€
                lightTime: 0,  // ë¹› ëª¨ë“œ ëˆ„ì  ì‹œê°„ (ì´ˆ)
                darkTime: 0,   // ì–´ë‘  ëª¨ë“œ ëˆ„ì  ì‹œê°„ (ì´ˆ)
                musicListened: 0,  // ìŒì•… ì²­ì·¨ íšŸìˆ˜
                feedCount: 0       // ë¨¹ì´ íšŸìˆ˜
            };

            spirits.push(spirit);
            saveGame();
            renderSpirits();
            showNotification(`${randomName}ì´(ê°€) íƒœì–´ë‚¬ìŠµë‹ˆë‹¤! ğŸ¥š`);
        }


        function showAppearance(spiritId) {
            const spirit = spirits.find(s => s.id === spiritId);
            if (!spirit) return;
            
            const appearance = getAppearanceDescription(spirit);
            if (appearance) {
                showNotification(`${spirit.name}ì˜ ëª¨ìŠµ: ${appearance}`);
            } else {
                showNotification(`${spirit.name}ì˜ ëª¨ìŠµì„ ìì„¸íˆ ë³¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
            }
        }

        function changeName(spiritId) {
            currentSpiritId = spiritId;
            const spirit = spirits.find(s => s.id === spiritId);
            document.getElementById('nameInput').value = spirit.name;
            document.getElementById('nameModal').classList.add('active');
            
            // ì´ë¦„ ë³€ê²½ ëª¨ë“œë¡œ ì „í™˜
            const confirmBtn = document.querySelector('#nameModal button');
            const originalHandler = confirmBtn.onclick;
            confirmBtn.onclick = function() {
                const newName = document.getElementById('nameInput').value.trim();
                if (!newName) {
                    showNotification('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                    return;
                }
                spirit.name = newName;
                closeModal('nameModal');
                saveGame();
                updateSpiritCard(spirit);
                showNotification('ì´ë¦„ì„ ë³€ê²½í–ˆìŠµë‹ˆë‹¤');
                
                // ì›ë˜ í•¨ìˆ˜ë¡œ ë³µêµ¬
                confirmBtn.onclick = originalHandler;
            };
        }

        // ì •ë ¹ì˜ ì£¼ìš” ì†ì„± ì°¾ê¸°
        function getDominantAttribute(spirit) {
            if (!spirit.hiddenAttributes) {
                return 'normal';
            }
            
            let maxAttr = 'normal';
            let maxValue = 0;
            
            for (let attr in spirit.hiddenAttributes) {
                if (spirit.hiddenAttributes[attr] > maxValue) {
                    maxValue = spirit.hiddenAttributes[attr];
                    maxAttr = attr;
                }
            }
            
            // ìµœê³  ì†ì„±ê°’ì´ 50 ë¯¸ë§Œì´ë©´ normal (ë°±ì˜ ì •ë ¹)
            if (maxValue < 50) {
                return 'normal';
            }
            
            return maxAttr;
        }

                function getStage(growth) {
            if (growth >= STAGE_REQUIREMENTS.adult) return 'adult';
            if (growth >= STAGE_REQUIREMENTS.pupa) return 'pupa';
            if (growth >= STAGE_REQUIREMENTS.larva3) return 'larva3';
            if (growth >= STAGE_REQUIREMENTS.larva2) return 'larva2';
            if (growth >= STAGE_REQUIREMENTS.larva1) return 'larva1';
            return 'egg';
        }
        
        // í˜„ì¬ ì†ì„±ì— ë”°ë¥¸ ì™¸í˜• ë¬˜ì‚¬ ê°€ì ¸ì˜¤ê¸°
        function getAppearanceDescription(spirit) {
            const stage = getStage(spirit.growth);
            
            // ì„±ì¶©ì´ë©´ ì™¸í˜• ë¬˜ì‚¬ ì—†ìŒ
            if (stage === 'adult') return null;
            
            // ì•Œ ~ ë²ˆë°ê¸°ë§Œ ì™¸í˜• ë¬˜ì‚¬ ìˆìŒ
            if (!APPEARANCE_DESCRIPTIONS[stage]) return null;
            
            // í˜„ì¬ ì†ì„± ê³„ì‚° (ë¨¹ì´ + í…Œë¼ë¦¬ì›€)
            const foodAttrs = spirit.hiddenAttributes || { fire: 0, water: 0, wind: 0, earth: 0, light: 0, dark: 0 };
            const finalAttrs = {};
            for (let attr in foodAttrs) {
                finalAttrs[attr] = (foodAttrs[attr] * 0.5) + (terrarium[attr] * 0.5);
            }
            
            // ì†ì„±ì„ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedAttrs = Object.entries(finalAttrs)
                .sort((a, b) => b[1] - a[1]);
            
            const firstAttr = sortedAttrs[0][0];
            const firstValue = sortedAttrs[0][1];
            const secondAttr = sortedAttrs[1][0];
            const secondValue = sortedAttrs[1][1];
            
            // ì†ì„±ì´ 10 ë¯¸ë§Œì´ë©´ normal
            if (firstValue < 10) {
                return APPEARANCE_DESCRIPTIONS[stage]['normal'] || 'í‰ë²”í•œ ëª¨ìŠµì…ë‹ˆë‹¤.';
            }
            
            // 2ê°œ ì†ì„±ì´ ë¹„ìŠ·í•œì§€ í™•ì¸ (ì°¨ì´ê°€ 30% ì´í•˜)
            // larva2, larva3, pupaë§Œ í˜¼í•© ì™¸í˜• ìˆìŒ
            if ((stage === 'larva2' || stage === 'larva3' || stage === 'pupa') && secondValue >= 10) {
                const diffPercent = ((firstValue - secondValue) / firstValue) * 100;
                
                if (diffPercent <= 30) {
                    // í˜¼í•© ì†ì„±!
                    const comboKey = [firstAttr, secondAttr].sort().join('-');
                    const mixedDesc = APPEARANCE_DESCRIPTIONS[stage][comboKey];
                    
                    if (mixedDesc) {
                        return mixedDesc;
                    }
                }
            }
            
            // ë‹¨ì¼ ì†ì„±
            return APPEARANCE_DESCRIPTIONS[stage][firstAttr] || 'í‰ë²”í•œ ëª¨ìŠµì…ë‹ˆë‹¤.';
        }
        
        // í’ˆì§ˆ ë“±ê¸‰ì„ ì ìˆ˜ë¡œ ë³€í™˜
        function getQualityScore(quality) {
            const qualityScores = {
                'common': 1,   // ë‚®ìŒ
                'rare': 3,     // ë³´í†µ
                'epic': 5      // ë†’ìŒ
            };
            return qualityScores[quality] || 1;
        }
        
        // í…Œë¼ë¦¬ì›€ ì „ì²´ í’ˆì§ˆ ê³„ì‚°
        function calculateTerrariumQuality() {
            if (installedDecorations.length === 0) return 0;
            
            let totalQuality = 0;
            installedDecorations.forEach(deco => {
                // ë¬¸ìì—´ ë˜ëŠ” ê°ì²´ ëª¨ë‘ ì§€ì›
                const key = typeof deco === 'string' ? deco : deco.type;
                const decoData = DECORATION_TYPES[key];
                if (decoData) {
                    totalQuality += getQualityScore(decoData.quality);
                }
            });
            
            // í‰ê·  í’ˆì§ˆ ë°˜í™˜ (ì†Œìˆ˜ì  1ìë¦¬)
            return Math.round((totalQuality / installedDecorations.length) * 10) / 10;
        }
        
        // ë§Œì¡±ë„ ê³„ì‚° í•¨ìˆ˜
        function calculateSatisfaction(spirit) {
            const stage = getStage(spirit.growth);
            
            // ì£½ì—ˆê±°ë‚˜ ì™„ì„±ëœ ì •ë ¹ì€ ë§Œì¡±ë„ ê³„ì‚° ì•ˆ í•¨
            if (spirit.isDead || spirit.isCompleted) return spirit.satisfaction || 'mid';
            
            // ì¥ì‹ë¬¼ì´ ì—†ìœ¼ë©´ ë‚®ìŒ
            if (installedDecorations.length === 0) return 'low';
            
            // í…Œë¼ë¦¬ì›€ ì „ì²´ í’ˆì§ˆ
            const avgQuality = calculateTerrariumQuality();
            
            // ì•Œ ~ ì• ë²Œë ˆ1: í’ˆì§ˆë§Œ í™•ì¸
            if (stage === 'egg' || stage === 'larva1') {
                // í’ˆì§ˆ í‰ê· ì´ 3(ë³´í†µ)ì„ ì´ˆê³¼í•˜ë©´ ë§Œì¡±
                if (avgQuality > 3) return 'high';
                else if (avgQuality >= 2) return 'mid';
                else return 'low';
            }
            // ì• ë²Œë ˆ2, ì• ë²Œë ˆ3, ë²ˆë°ê¸°: í’ˆì§ˆ + ì†ì„± ìœ ì‚¬ë„ (ë‚œì´ë„ ì™„í™”)
            else {
                // ì •ë ¹ì˜ í˜„ì¬ ì†ì„± ê³„ì‚°
                const foodAttrs = spirit.hiddenAttributes || { fire: 0, water: 0, wind: 0, earth: 0, light: 0, dark: 0 };
                const spiritAttrs = {};
                for (let attr in foodAttrs) {
                    spiritAttrs[attr] = (foodAttrs[attr] * 0.5) + (terrarium[attr] * 0.5);
                }
                
                // ì •ë ¹ì˜ ì£¼ ì†ì„± ì°¾ê¸° (ê°€ì¥ ë†’ì€ ì†ì„±)
                let maxAttr = null;
                let maxValue = 0;
                for (let attr in spiritAttrs) {
                    if (spiritAttrs[attr] > maxValue) {
                        maxValue = spiritAttrs[attr];
                        maxAttr = attr;
                    }
                }
                
                // ì†ì„±ì´ 10 ë¯¸ë§Œì´ë©´ ì†ì„±ì´ ëª…í™•í•˜ì§€ ì•ŠìŒ
                if (maxValue < 10) {
                    // í’ˆì§ˆë§Œìœ¼ë¡œ íŒë‹¨ (ì™„í™”)
                    if (avgQuality > 3.5) return 'high';
                    else if (avgQuality >= 2) return 'mid';
                    else return 'low';
                }
                
                // í…Œë¼ë¦¬ì›€ì˜ ì£¼ ì†ì„±ê³¼ ì •ë ¹ì˜ ì£¼ ì†ì„± ë¹„êµ
                const terrariumMaxAttr = Object.entries(terrarium)
                    .sort((a, b) => b[1] - a[1])[0][0];
                
                // ì†ì„± ì¼ì¹˜ í™•ì¸ (ì™„í™”: ì •ë ¹ ì†ì„±ì´ í…Œë¼ë¦¬ì›€ ìƒìœ„ 2ê°œ ì•ˆì— ìˆìœ¼ë©´ OK)
                const topTerrariumAttrs = Object.entries(terrarium)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 2)
                    .map(([attr]) => attr);
                
                if (topTerrariumAttrs.includes(maxAttr)) {
                    // ì†ì„± ì¼ì¹˜ + í’ˆì§ˆ ì ì • = ë§Œì¡±
                    return avgQuality >= 2.5 ? 'high' : 'mid';
                } else {
                    // ì†ì„± ë¶ˆì¼ì¹˜
                    if (avgQuality > 4) return 'mid';
                    else return 'low';
                }
            }
        }

        function getNextStageRequirement(growth) {
            const stage = getStage(growth);
            const stages = Object.keys(STAGE_REQUIREMENTS);
            const currentIndex = stages.indexOf(stage);
            if (currentIndex < stages.length - 1) {
                return STAGE_REQUIREMENTS[stages[currentIndex + 1]];
            }
            return STAGE_REQUIREMENTS.adult;
        }

        function canDoAction(spirit, action) {
            const now = Date.now();
            const cooldown = 10000; // 10ì´ˆ

            if (action === 'feed') {
                return !spirit.lastFeed || (now - spirit.lastFeed > cooldown);
            }
            if (action === 'music') {
                return !spirit.lastMusic || (now - spirit.lastMusic > cooldown);
            }
            if (action === 'pat') {
                return !spirit.lastPat || (now - spirit.lastPat > cooldown);
            }
            if (action === 'decorate') {
                return !spirit.lastDecorate || (now - spirit.lastDecorate > cooldown);
            }
            return false;
        }


        // ì»¤ìŠ¤í…€ í™•ì¸ ì°½ í‘œì‹œ
        function showConfirm(title, message, onConfirm) {
            return new Promise((resolve) => {
                const modal = document.getElementById('confirmModal');
                const titleEl = document.getElementById('confirmTitle');
                const messageEl = document.getElementById('confirmMessage');
                const okBtn = document.getElementById('confirmOkBtn');
                const cancelBtn = document.getElementById('confirmCancelBtn');
                
                titleEl.textContent = title;
                messageEl.textContent = message;
                modal.classList.add('active');
                
                // ì´ì „ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                const newOkBtn = okBtn.cloneNode(true);
                const newCancelBtn = cancelBtn.cloneNode(true);
                okBtn.parentNode.replaceChild(newOkBtn, okBtn);
                cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);
                
                // í™•ì¸ ë²„íŠ¼
                document.getElementById('confirmOkBtn').onclick = () => {
                    modal.classList.remove('active');
                    if (onConfirm) onConfirm();
                    resolve(true);
                };
                
                // ì·¨ì†Œ ë²„íŠ¼
                document.getElementById('confirmCancelBtn').onclick = () => {
                    modal.classList.remove('active');
                    resolve(false);
                };
            });
        }

        function openFeedModal(spiritId) {
            const spirit = spirits.find(s => s.id === spiritId);
            if (!canDoAction(spirit, 'feed')) {
                showNotification('ì•„ì§ ë°°ê°€ ë¶€ë¦…ë‹ˆë‹¤');
                return;
            }
            if (!inventory.food) inventory.food = [];
            if (inventory.food.length === 0) {
                showNotification('ë¨¹ì´ê°€ ì—†ìŠµë‹ˆë‹¤. ì±„ì§‘ì„ í•´ë³´ì„¸ìš”!');
                return;
            }
            currentSpiritId = spiritId;
            renderFeedOptions();
            document.getElementById('feedModal').classList.add('active');
        }

        function renderFeedOptions() {
            if (!inventory.food) inventory.food = [];
            
            const modal = document.getElementById('feedModal');
            const spirit = spirits.find(s => s.id === currentSpiritId);
            
            const foodCounts = {};
            inventory.food.forEach(f => {
                foodCounts[f] = (foodCounts[f] || 0) + 1;
            });
            
            // medicineì„ foodCountsì—ì„œ ë¶„ë¦¬
            const medicineCount = foodCounts['medicine'] || 0;
            delete foodCounts['medicine'];
            
            let medicineSection = '';
            if (spirit && spirit.isSick && medicineCount > 0) {
                medicineSection = `
                    <button class="option-btn" onclick="giveMedicineFromModal(${currentSpiritId})">
                        <span class="option-icon">ğŸŒ¿</span>
                        <div class="option-info">
                            <div class="option-name">${MEDICINE.name} Ã—${medicineCount}</div>
                            <div class="option-effect">ë³‘ì„ ì™„ì „íˆ ì¹˜ë£Œí•©ë‹ˆë‹¤</div>
                        </div>
                    </button>
                `;
            } else if (spirit && spirit.isSick) {
                medicineSection = `
                    <div style="margin-bottom: 10px; padding: 10px; background: var(--card); border: 1px solid var(--border);">
                        <div style="font-size: 0.9rem; color: #666;">ì •ë ¹ì´ ì•„í”•ë‹ˆë‹¤! ì•½ì´ˆê°€ í•„ìš”í•©ë‹ˆë‹¤.</div>
                    </div>
                `;
            }

            const content = `
                <div class="modal-title">ë¬´ì—‡ì„ ë¨¹ì¼ê¹Œìš”?</div>
                <div style="font-weight: 600; margin-bottom: 10px; color: var(--text);">ğŸ ë¨¹ì´</div>
                <div class="food-grid">
                    ${medicineSection}
                    ${Object.entries(foodCounts).map(([type, count]) => {
                        const isRare = type === 'light' || type === 'dark';
                        const gain = isRare ? 2 : 1;
                        const growth = isRare ? 3 : 2;
                        return `
                            <button class="option-btn" onclick="feedSpiritFromInventory(${currentSpiritId}, '${type}')">
                                <span class="option-icon">${ENV_ICONS[type]}</span>
                                <div class="option-info">
                                    <div class="option-name">${FOOD_NAMES[type]} Ã—${count}</div>
                                    <div class="option-effect">${ENV_ICONS[type]}+${gain} ì„±ì¥+${growth}</div>
                                </div>
                            </button>
                        `;
                    }).join('')}
                </div>
                <button class="close-btn" onclick="closeModal('feedModal')">ë‹«ê¸°</button>
            `;
            modal.querySelector('.modal-content').innerHTML = content;
        }
        
        function giveMedicineFromModal(spiritId) {
            giveMedicine(spiritId);
            closeModal('feedModal');
        }

        function feedSpiritFromInventory(spiritId, foodType) {
            if (isPaused) {
                showNotification('ê²Œì„ì´ ì¼ì‹œì •ì§€ ìƒíƒœì…ë‹ˆë‹¤');
                return;
            }
            
            const spirit = spirits.find(s => s.id === spiritId);
            if (!spirit) return;

            if (!inventory.food) inventory.food = [];
            const foodIndex = inventory.food.indexOf(foodType);
            if (foodIndex === -1) {
                showNotification('ë¨¹ì´ê°€ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            // ë¨¹ì´ ì†Œëª¨
            inventory.food.splice(foodIndex, 1);

            const isRare = foodType === 'light' || foodType === 'dark';
            const attrGain = isRare ? 6 : 3;  // í¬ê·€ +6, ì¼ë°˜ +3
            const growthGain = isRare ? 3 : 2;

            // ì •ë ¹ì˜ ìˆ¨ê²¨ì§„ ì†ì„± ì¦ê°€
            if (!spirit.hiddenAttributes) {
                spirit.hiddenAttributes = {
                    fire: 0, water: 0, wind: 0, earth: 0, light: 0, dark: 0
                };
            }
            spirit.hiddenAttributes[foodType] += attrGain;

            spirit.growth += growthGain;
            spirit.lastFeed = Date.now();
            spirit.lastFed = Date.now();  // ë°°ê³ í”” ì²´í¬ìš©
            spirit.lastInteraction = Date.now();  // ìƒí˜¸ì‘ìš© ì‹œê°„ ì—…ë°ì´íŠ¸
            spirit.status = 'ë§›ìˆê²Œ ë¨¹ì—ˆìŠµë‹ˆë‹¤!';
            spirit.parameters.affection += 1;
            
            // ë¨¹ì´ íšŸìˆ˜ ì¦ê°€
            if (!spirit.feedCount) spirit.feedCount = 0;
            spirit.feedCount += 1;

            // ì¼ì§€ ì¶”ê°€
            addLog(spirit, `${FOOD_NAMES[foodType]}ë¥¼ ë¨¹ì—ˆìŠµë‹ˆë‹¤`);
            addLog(spirit, 'ë§›ìˆê²Œ ë¨¹ì—ˆìŠµë‹ˆë‹¤!');

            // ì„±ì¶© ì²´í¬ (100 ì´ìƒì´ë©´ ë¬´ì¡°ê±´ ì™„ë£Œ)
            if (spirit.growth >= STAGE_REQUIREMENTS.adult && !spirit.isCompleted) {
                completeSpirit(spirit);
            }

            closeModal('feedModal');
            saveGame();
            renderSpirits();  // ì „ì²´ ë Œë”ë§ìœ¼ë¡œ ì¿¨íƒ€ì„ í‘œì‹œ ì—…ë°ì´íŠ¸
            renderInventory();
            showNotification(`${ENV_ICONS[foodType]} ${FOOD_NAMES[foodType]}ë¥¼ ì£¼ì—ˆìŠµë‹ˆë‹¤`);
        }

        function openMusicModal(spiritId) {
            const spirit = spirits.find(s => s.id === spiritId);
            if (!canDoAction(spirit, 'music')) {
                showNotification('ì•„ì§ ìŒì•…ì„ ë“£ê³  ìˆìŠµë‹ˆë‹¤');
                return;
            }
            if (inventory.music.length === 0) {
                showNotification('ë³´ìœ í•œ ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤. ì±„ì§‘ì„ í•´ë³´ì„¸ìš”!');
                return;
            }
            currentSpiritId = spiritId;
            renderMusicOptions();
            document.getElementById('musicModal').classList.add('active');
        }

        function renderMusicOptions() {
            const container = document.getElementById('musicOptions');
            
            // ìŒì•… ê°œìˆ˜ ì„¸ê¸°
            const musicCounts = {};
            inventory.music.forEach(m => {
                musicCounts[m] = (musicCounts[m] || 0) + 1;
            });
            
            // ìˆœì„œëŒ€ë¡œ í‘œì‹œ (classic, jazz, rock, pop, ballad)
            const musicOrder = ['classic', 'jazz', 'rock', 'pop', 'ballad'];
            const musicHTML = musicOrder
                .filter(type => musicCounts[type])
                .map(type => {
                    const musicData = MUSIC_TYPES[type];
                    const count = musicCounts[type];
                    return `
                        <button class="option-btn" onclick="playMusicByType('${type}')">
                            <span class="option-icon">${musicData.icon}</span>
                            <div class="option-info">
                                <div class="option-name">${musicData.name} Ã—${count}</div>
                                <div class="option-effect">${musicData.effect}</div>
                            </div>
                        </button>
                    `;
                }).join('');
            
            container.innerHTML = '<div class="music-grid">' + musicHTML + '</div>';
        }

        function playMusicByType(musicType) {
            const spiritId = currentSpiritId;
            
            // í•´ë‹¹ íƒ€ì…ì˜ ìŒì•… ì°¾ê¸°
            const musicIndex = inventory.music.indexOf(musicType);
            if (musicIndex === -1) {
                showNotification('í•´ë‹¹ ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            // ê¸°ì¡´ playMusic í•¨ìˆ˜ í˜¸ì¶œ
            playMusic(spiritId, musicType, musicIndex);
        }

        function playMusic(spiritId, musicType, inventoryIndex) {
            if (isPaused) {
                showNotification('ê²Œì„ì´ ì¼ì‹œì •ì§€ ìƒíƒœì…ë‹ˆë‹¤');
                return;
            }
            
            const spirit = spirits.find(s => s.id === spiritId);
            if (!spirit) return;

            const musicData = MUSIC_TYPES[musicType];
            
            // ë§Œì¡±ë„ ì¦‰ì‹œ ê³„ì‚°
            spirit.satisfaction = calculateSatisfaction(spirit);
            const singleStatBonus = spirit.satisfaction === 'high' ? 2 : 0; // ë‹¨ì¼ ìŠ¤íƒ¯ +2
            const dualStatBonus = spirit.satisfaction === 'high' ? 1 : 0;   // ë³µìˆ˜ ìŠ¤íƒ¯ ê° +1
            
            // íš¨ê³¼ ì ìš© (ë§Œì¡±ë„ ë†’ìœ¼ë©´ ë³´ë„ˆìŠ¤)
            if (musicType === 'classic') {
                spirit.parameters.intelligence = Math.min(100, spirit.parameters.intelligence + 10 + singleStatBonus);
            } else if (musicType === 'jazz') {
                spirit.parameters.charm = Math.min(100, spirit.parameters.charm + 10 + singleStatBonus);
            } else if (musicType === 'rock') {
                spirit.parameters.strength = Math.min(100, spirit.parameters.strength + 10 + singleStatBonus);
            } else if (musicType === 'pop') {
                spirit.parameters.intelligence = Math.min(100, spirit.parameters.intelligence + 5 + dualStatBonus);
                spirit.parameters.charm = Math.min(100, spirit.parameters.charm + 5 + dualStatBonus);
            } else if (musicType === 'ballad') {
                spirit.parameters.strength = Math.min(100, spirit.parameters.strength + 5 + dualStatBonus);
                spirit.parameters.charm = Math.min(100, spirit.parameters.charm + 5 + dualStatBonus);
            }

            // ì• ì •ë„ ì¦ê°€ (ë§Œì¡±ë„ ë†’ìœ¼ë©´ +1 ë³´ë„ˆìŠ¤)
            const affectionBonus = spirit.satisfaction === 'high' ? 3 : 2;
            spirit.parameters.affection += affectionBonus;

            spirit.lastMusic = Date.now();
            spirit.lastInteraction = Date.now();  // ìƒí˜¸ì‘ìš© ì‹œê°„ ì—…ë°ì´íŠ¸
            spirit.lastMusicType = musicType; // ë§ˆì§€ë§‰ìœ¼ë¡œ ë“¤ì€ ìŒì•… ì €ì¥
            
            // ìŒì•… ì²­ì·¨ íšŸìˆ˜ ì¦ê°€
            if (!spirit.musicListened) spirit.musicListened = 0;
            spirit.musicListened += 1;
            
            // ìŒì•… ê´€ë ¨ ëœë¤ ë©”ì‹œì§€
            const musicMessages = [
                `${spirit.name}ì´(ê°€) ${musicData.name}ì„(ë¥¼) í¥ì–¼ê±°ë¦½ë‹ˆë‹¤.`,
                `${spirit.name}ì´(ê°€) ${musicData.name}ì— ë§ì¶° ì¶¤ì„ ì¶¥ë‹ˆë‹¤.`,
                `${spirit.name}ì´(ê°€) ${musicData.name}ì˜ ì„ ìœ¨ì„ ë– ì˜¬ë¦½ë‹ˆë‹¤.`,
                `${spirit.name}ì´(ê°€) ìŒì•…ì— ì·¨í•´ ìˆìŠµë‹ˆë‹¤.`,
                `${spirit.name}ì´(ê°€) ${musicData.name}ì˜ ì—¬ìš´ì— ì –ì–´ ìˆìŠµë‹ˆë‹¤.`
            ];
            spirit.status = musicMessages[Math.floor(Math.random() * musicMessages.length)];

            // ì¼ì§€ ì¶”ê°€
            addLog(spirit, `${musicData.name}ì„(ë¥¼) ë“¤ì—ˆìŠµë‹ˆë‹¤`);

            // ìŒì•… ì†Œëª¨
            inventory.music.splice(inventoryIndex, 1);

            closeModal('musicModal');
            saveGame();
            renderSpirits();  // ì „ì²´ ë Œë”ë§ìœ¼ë¡œ ì¿¨íƒ€ì„ í‘œì‹œ ì—…ë°ì´íŠ¸
            renderInventory();
            const bonusText = spirit.satisfaction === 'high' ? ' (ë§Œì¡± ë³´ë„ˆìŠ¤!)' : '';
            showNotification(`${musicData.name}ì„(ë¥¼) ë“¤ë ¤ì£¼ì—ˆìŠµë‹ˆë‹¤${bonusText}`);
        }

        function patSpirit(spiritId) {
            if (isPaused) {
                showNotification('ê²Œì„ì´ ì¼ì‹œì •ì§€ ìƒíƒœì…ë‹ˆë‹¤');
                return;
            }
            
            const spirit = spirits.find(s => s.id === spiritId);
            if (!spirit) return;

            if (!canDoAction(spirit, 'pat')) {
                showNotification('ì•„ì§ ì“°ë‹¤ë“¬ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            // ë§Œì¡±ë„ ì¦‰ì‹œ ê³„ì‚°
            spirit.satisfaction = calculateSatisfaction(spirit);
            
            const currentAffection = spirit.parameters.affection || 0;
            const affectionBonus = spirit.satisfaction === 'high' ? 2 : 1;
            spirit.parameters.affection += affectionBonus;
            spirit.lastPat = Date.now();
            spirit.lastInteraction = Date.now();  // ìƒí˜¸ì‘ìš© ì‹œê°„ ì—…ë°ì´íŠ¸
            
            // ì• ì •ë„ì— ë”°ë¥¸ ë°˜ì‘ ë©”ì‹œì§€
            let messages = [];
            let notificationEmoji = '';
            
            if (currentAffection < 10) {
                // ë‚¯ì„¤ì–´í•¨, ê²½ê³„í•¨
                messages = [
                    `${spirit.name}ì´(ê°€) ë‹¹ì‹ ì„ ë‚¯ì„¤ì–´í•©ë‹ˆë‹¤...`,
                    `${spirit.name}ì´(ê°€) ê²½ê³„í•˜ë©° ë¬¼ëŸ¬ì„­ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ë°”ë¼ë´…ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ë‹¹ì‹ ì˜ ì†ê¸¸ì„ ë‘ë ¤ì›Œí•©ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ë¶ˆì•ˆí•´í•˜ë©° ëª¸ì„ ì›€ì¸ ë¦½ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ë‹¹ì‹ ì´ ëˆ„êµ¬ì¸ì§€ ê¶ê¸ˆí•´í•©ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ì²œì²œíˆ ë‹¤ê°€ì˜µë‹ˆë‹¤...`
                ];
                notificationEmoji = 'ğŸ˜Ÿ';
            } else if (currentAffection < 50) {
                // ìµìˆ™í•´ì§
                messages = [
                    `${spirit.name}ì´(ê°€) ë‹¹ì‹ ì—ê²Œ ìµìˆ™í•´ì¡ŒìŠµë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) í¸ì•ˆí•´ ë³´ì…ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ë‹¹ì‹ ì˜ ì†ê¸¸ì„ ë°›ì•„ë“¤ì…ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ì¡°ê¸ˆì”© ë§ˆìŒì„ ì—½ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ë‹¹ì‹ ì„ ì‹ ë¢°í•˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ê¸°ë¶„ì´ ì¢‹ì•„ ë³´ì…ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ë‹¹ì‹  ê³ì— ë¨¸ë­…ë‹ˆë‹¤`
                ];
                notificationEmoji = 'ğŸ˜Š';
            } else {
                // ì¹œí•´ì§, ì˜ ë”°ë¦„
                messages = [
                    `${spirit.name}ì´(ê°€) ë‹¹ì‹ ì„ ë¬´ì²™ ì¢‹ì•„í•©ë‹ˆë‹¤!`,
                    `${spirit.name}ì´(ê°€) ë‹¹ì‹ ì„ ë”°ë¼ë‹¤ë‹™ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) í–‰ë³µí•˜ê²Œ ë‹¹ì‹ ì„ ë°”ë¼ë´…ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ë‹¹ì‹ ì—ê²Œ ì• êµë¥¼ ë¶€ë¦½ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ë‹¹ì‹ ì˜ ì†ì„ ë¹„ë¹•ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ê¸°ë»í•˜ë©° ë‚ ì•„ì˜¤ë¦…ë‹ˆë‹¤!`,
                    `${spirit.name}ì´(ê°€) ë‹¹ì‹  ê³ì„ ë– ë‚˜ì§€ ì•Šìœ¼ë ¤ í•©ë‹ˆë‹¤`,
                    `${spirit.name}ì´(ê°€) ë‹¹ì‹ ì˜ ì‚¬ë‘ì„ ì˜¨ëª¸ìœ¼ë¡œ ëŠë‚ë‹ˆë‹¤`
                ];
                notificationEmoji = 'ğŸ¥°';
            }
            
            spirit.status = messages[Math.floor(Math.random() * messages.length)];

            // ì¼ì§€ ì¶”ê°€
            addLog(spirit, 'ì“°ë‹¤ë“¬ì—ˆìŠµë‹ˆë‹¤');
            addLog(spirit, spirit.status);

            saveGame();
            renderSpirits();  // ì „ì²´ ë Œë”ë§ìœ¼ë¡œ ì¿¨íƒ€ì„ í‘œì‹œ ì—…ë°ì´íŠ¸
            const bonusText = spirit.satisfaction === 'high' ? ' (ë§Œì¡± ë³´ë„ˆìŠ¤!)' : '';
            showNotification(`ì“°ë‹¤ë“¬ì—ˆìŠµë‹ˆë‹¤ (ì• ì • +${affectionBonus}${bonusText})`);
        }
        
        // ì•½ ë¨¹ì´ê¸° í•¨ìˆ˜
        function giveMedicine(spiritId) {
            if (isPaused) {
                showNotification('ê²Œì„ì´ ì¼ì‹œì •ì§€ ìƒíƒœì…ë‹ˆë‹¤');
                return;
            }
            
            const spirit = spirits.find(s => s.id === spiritId);
            if (!spirit) return;
            
            if (!spirit.isSick) {
                showNotification('ì´ ì •ë ¹ì€ ê±´ê°•í•©ë‹ˆë‹¤');
                return;
            }
            
            if (!inventory.food) inventory.food = [];
            const medicineIndex = inventory.food.indexOf('medicine');
            if (medicineIndex === -1) {
                showNotification('ì•½ì´ˆê°€ ì—†ìŠµë‹ˆë‹¤. ìƒì ì—ì„œ êµ¬ë§¤í•˜ì„¸ìš”!');
                return;
            }
            
            // ì•½ì´ˆ ì†Œëª¨
            inventory.food.splice(medicineIndex, 1);
            
            // ë³‘ ì¹˜ë£Œ
            spirit.isSick = false;
            spirit.sickWarned = false;
            delete spirit.sickTime;
            spirit.lastInteraction = Date.now(); // ìƒí˜¸ì‘ìš© ì‹œê°„ ì—…ë°ì´íŠ¸
            
            const healMessages = [
                `${spirit.name}ì´(ê°€) ì•½ì´ˆë¥¼ ë¨¹ê³  ê±´ê°•í•´ì¡ŒìŠµë‹ˆë‹¤! ğŸ’š`,
                `${spirit.name}ì˜ ë³‘ì´ ì™„ì „íˆ ë‚˜ì•˜ìŠµë‹ˆë‹¤!`,
                `${spirit.name}ì´(ê°€) í™œê¸°ë¥¼ ë˜ì°¾ì•˜ìŠµë‹ˆë‹¤! ğŸŒŸ`,
                `${spirit.name}ì´(ê°€) ë‹¹ì‹ ì˜ ë³´ì‚´í•Œì— ê°ì‚¬í•©ë‹ˆë‹¤`
            ];
            
            spirit.status = healMessages[Math.floor(Math.random() * healMessages.length)];
            
            // ì¼ì§€ ì¶”ê°€
            addLog(spirit, 'ì•½ì´ˆë¥¼ ë¨¹ê³  ê±´ê°•í•´ì¡ŒìŠµë‹ˆë‹¤');
            addLog(spirit, spirit.status);
            
            saveGame();
            updateSpiritCard(spirit);
            renderInventory();
            showNotification(`${spirit.name}ì˜ ë³‘ì´ ë‚˜ì•˜ìŠµë‹ˆë‹¤!`);
        }

        function changeTitle() {
            const select = document.getElementById('titleSelect');
            currentTitle = select.value;
            
            const titleNames = {
                'none': 'ì—†ìŒ',
                'hawk_eye': 'ğŸ¦… ë§¤ì˜ ëˆˆ',
                'gatherer': 'ğŸ ì±„ì§‘ê¾¼',
                'musician': 'ìŒì•…ê°€',
                'collector': 'ğŸ’ ìˆ˜ì§‘ê°€'
            };
            
            showNotification(`ì¹­í˜¸ë¥¼ ${titleNames[currentTitle]}(ìœ¼)ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤`);
            saveGame();
        }
        
        function changeShopCategory() {
            const select = document.getElementById('shopCategorySelect');
            currentShopCategory = select.value;
            renderShop();
        }


        function changeGatherLocation() {
            const select = document.getElementById('gatherLocationSelect');
            currentGatherLocation = select.value;
            saveGame();
            
            const locationNames = {
                garden: 'ğŸŒ¸ ì •ì›',
                lake: 'ğŸŒŠ í˜¸ìˆ˜',
                forest: 'ğŸŒ² ìˆ²'
            };
            showNotification(`ì±„ì§‘ ì¥ì†Œë¥¼ ${locationNames[currentGatherLocation]}(ìœ¼)ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤`);
        }

        function goGather() {
            if (isPaused) {
                showNotification('ê²Œì„ì´ ì¼ì‹œì •ì§€ ìƒíƒœì…ë‹ˆë‹¤');
                return;
            }
            
            const now = Date.now();
            const gatherCooldown = 15000; // 15ì´ˆ

            // ì¿¨ë‹¤ìš´ ì²´í¬
            if (lastGatherTime && (now - lastGatherTime < gatherCooldown)) {
                const remainingTime = Math.ceil((gatherCooldown - (now - lastGatherTime)) / 1000);
                showNotification(`${remainingTime}ì´ˆ í›„ì— ë‹¤ì‹œ ì±„ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤`);
                return;
            }
            
            // ì„ íƒëœ ì¥ì†Œì—ì„œ ë°”ë¡œ ì±„ì§‘
            gatherAtLocation(currentGatherLocation);
        }
        
        function gatherAtLocation(location) {
            const now = Date.now();

            if (!inventory.food) inventory.food = [];
            if (!inventory.music) inventory.music = [];
            if (!inventory.decorations) inventory.decorations = [];

            const discoveries = [];
            
            // ì¹­í˜¸ë³„ í™•ë¥  ë³´ë„ˆìŠ¤
            const titleBonus = {
                hawk_eye: 1.5,    // ë§¤ì˜ ëˆˆ: ëª¨ë“  í™•ë¥  1.5ë°°
                gatherer: 1.0,    // ì±„ì§‘ê¾¼: ë¨¹ì´ë§Œ 2ë°° (ì•„ë˜ì„œ ë”°ë¡œ ì²˜ë¦¬)
                musician: 1.0,    // ìŒì•…ê°€: ë ˆì½”ë“œë§Œ 2ë°° (ì•„ë˜ì„œ ë”°ë¡œ ì²˜ë¦¬)
                collector: 1.0    // ìˆ˜ì§‘ê°€: í…Œë¼ë¦¬ì›€ë§Œ 2ë°° (ì•„ë˜ì„œ ë”°ë¡œ ì²˜ë¦¬)
            };
            
            const baseBonus = currentTitle !== 'none' && titleBonus[currentTitle] ? titleBonus[currentTitle] : 1.0;
            const foodBonus = currentTitle === 'gatherer' ? 2.0 : baseBonus;
            
            // ì¥ì†Œë³„ ë¨¹ì´ íƒ€ì…
            let locationFoodTypes = [];
            let locationDecoTypes = [];
            
            if (location === 'garden') {
                locationFoodTypes = ['fire', 'water', 'wind', 'earth'];  // ì •ì›: ëª¨ë“  ê¸°ë³¸ ì†ì„±
                locationDecoTypes = ['fire', 'water', 'wind', 'earth'];
            } else if (location === 'lake') {
                locationFoodTypes = ['water', 'wind'];  // í˜¸ìˆ˜: ë¬¼, ë°”ëŒ
                locationDecoTypes = ['water', 'wind'];
            } else if (location === 'forest') {
                locationFoodTypes = ['earth', 'fire'];  // ìˆ²: ë•…, ë¶ˆ
                locationDecoTypes = ['earth', 'fire'];
            }
            
            // 80% í™•ë¥ ë¡œ ì¼ë°˜ ë¨¹ì´ ë°œê²¬ (ì¥ì†Œ ê³ ì •)
            if (Math.random() < (0.8 * foodBonus)) {
                const randomFood = locationFoodTypes[Math.floor(Math.random() * locationFoodTypes.length)];
                inventory.food.push(randomFood);
                discoveries.push(`ğŸ ${FOOD_NAMES[randomFood]}`);
            }

            // 40% í™•ë¥ ë¡œ í¬ê·€ ë¨¹ì´ ë°œê²¬ (ë¹›ì•”)
            if (Math.random() < (0.4 * foodBonus)) {
                const rareFoodTypes = ['light', 'dark'];
                const randomRareFood = rareFoodTypes[Math.floor(Math.random() * rareFoodTypes.length)];
                inventory.food.push(randomRareFood);
                discoveries.push(`${FOOD_NAMES[randomRareFood]}`);
            }

            // ì¥ì‹ë¬¼ ì±„ì§‘ (ì¥ì†Œë³„ + ë“±ê¸‰ë³„ í™•ë¥ )
            const decoBonus = currentTitle === 'collector' ? 2.0 : baseBonus;
            
            // 50% í™•ë¥ ë¡œ ì¼ë°˜(common) ì¥ì‹ë¬¼ (ì¥ì†Œ ê³ ì •)
            if (Math.random() < (0.5 * decoBonus)) {
                const commonDecos = Object.keys(DECORATION_TYPES).filter(key => {
                    const deco = DECORATION_TYPES[key];
                    return deco.quality === 'common' && locationDecoTypes.includes(deco.attr);
                });
                if (commonDecos.length > 0) {
                    const randomDeco = commonDecos[Math.floor(Math.random() * commonDecos.length)];
                    inventory.decorations.push(randomDeco);
                    discoveries.push(`${DECORATION_TYPES[randomDeco].icon} ${DECORATION_TYPES[randomDeco].name}`);
                }
            }
            
            // 20% í™•ë¥ ë¡œ í¬ê·€(rare) ì¥ì‹ë¬¼ (ì¥ì†Œ ê³ ì •)
            if (Math.random() < (0.2 * decoBonus)) {
                const rareDecos = Object.keys(DECORATION_TYPES).filter(key => {
                    const deco = DECORATION_TYPES[key];
                    return deco.quality === 'rare' && locationDecoTypes.includes(deco.attr);
                });
                if (rareDecos.length > 0) {
                    const randomDeco = rareDecos[Math.floor(Math.random() * rareDecos.length)];
                    inventory.decorations.push(randomDeco);
                    discoveries.push(`${DECORATION_TYPES[randomDeco].icon} ${DECORATION_TYPES[randomDeco].name}`);
                }
            }
            
            // 8% í™•ë¥ ë¡œ ìµœìƒê¸‰(epic) ì¥ì‹ë¬¼ (ì¥ì†Œ ê³ ì •)
            if (Math.random() < (0.08 * decoBonus)) {
                const epicDecos = Object.keys(DECORATION_TYPES).filter(key => {
                    const deco = DECORATION_TYPES[key];
                    return deco.quality === 'epic' && locationDecoTypes.includes(deco.attr);
                });
                if (epicDecos.length > 0) {
                    const randomDeco = epicDecos[Math.floor(Math.random() * epicDecos.length)];
                    inventory.decorations.push(randomDeco);
                    discoveries.push(`${DECORATION_TYPES[randomDeco].icon} ${DECORATION_TYPES[randomDeco].name} (ìµœìƒê¸‰!)`);
                }
            }

            // 15% í™•ë¥ ë¡œ ìŒì•… ë ˆì½”ë“œ ë°œê²¬
            const musicBonus = currentTitle === 'musician' ? 2.0 : baseBonus;
            if (Math.random() < (0.15 * musicBonus)) {
                const musicKeys = Object.keys(MUSIC_TYPES);
                const randomMusic = musicKeys[Math.floor(Math.random() * musicKeys.length)];
                inventory.music.push(randomMusic);
                discoveries.push(`${MUSIC_TYPES[randomMusic].name}`);
            }

            if (discoveries.length === 0) {
                showNotification('ì•„ë¬´ê²ƒë„ ë°œê²¬í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤...');
            } else {
                const locationNames = { garden: 'ğŸŒ¸ ì •ì›', lake: 'ğŸŒŠ í˜¸ìˆ˜', forest: 'ğŸŒ² ìˆ²' };
                showNotification(`${locationNames[location]} ì±„ì§‘: ${discoveries.join(', ')}`);
            }

            lastGatherTime = now;
            saveGame();
            renderInventory();
            updateGatherButton();
        }

        function updateGatherButton() {
            const gatherBtn = document.querySelector('.walk-btn');
            if (!gatherBtn) return;

            const now = Date.now();
            const gatherCooldown = 15000; // 15ì´ˆ
            
            // ì¼ì‹œì •ì§€ ì¤‘ì´ë©´ ë²„íŠ¼ ë¹„í™œì„±í™”
            if (isPaused) {
                gatherBtn.disabled = true;
                gatherBtn.textContent = 'ì±„ì§‘í•˜ê¸° (ì¼ì‹œì •ì§€)';
                return;
            }

            if (lastGatherTime && (now - lastGatherTime < gatherCooldown)) {
                gatherBtn.disabled = true;
                const remainingTime = Math.ceil((gatherCooldown - (now - lastGatherTime)) / 1000);
                gatherBtn.textContent = `ì±„ì§‘í•˜ê¸° (${remainingTime}ì´ˆ)`;
            } else {
                gatherBtn.disabled = false;
                gatherBtn.textContent = 'ì±„ì§‘í•˜ê¸°';
            }
        }

        function confirmDeleteSpirit(spiritId) {
            const spirit = spirits.find(s => s.id === spiritId);
            if (!spirit) return;

            showConfirm(
                'ì •ë ¹ ë³´ë‚´ê¸°',
                `ì •ë§ë¡œ ${spirit.name}ì„(ë¥¼) ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`,
                () => deleteSpirit(spiritId)
            );
        }

        function deleteSpirit(spiritId) {
            spirits = spirits.filter(s => s.id !== spiritId);
            saveGame();
            renderSpirits();
            showNotification('ì •ë ¹ì„ ë– ë‚˜ë³´ëƒˆìŠµë‹ˆë‹¤');
        }

        function renderInventory() {
            // ë¨¹ì´ê°€ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
            if (!inventory.food) {
                inventory.food = [];
            }

            // ë¨¹ì´ ì¸ë²¤í† ë¦¬ (ìˆœì„œ ê³ ì •: fire, water, wind, earth, light, dark)
            const foodContainer = document.getElementById('foodInventory');
            if (inventory.food.length === 0) {
                foodContainer.innerHTML = '<div class="inventory-item">ì—†ìŒ</div>';
            } else {
                const foodCounts = {};
                inventory.food.forEach(f => {
                    foodCounts[f] = (foodCounts[f] || 0) + 1;
                });
                const foodOrder = ['fire', 'water', 'wind', 'earth', 'light', 'dark'];
                foodContainer.innerHTML = foodOrder
                    .filter(type => foodCounts[type])
                    .map(type => `
                        <div class="inventory-item">
                            ${ENV_ICONS[type]} Ã—${foodCounts[type]}
                        </div>
                    `).join('');
            }

            // ìŒì•… ì¸ë²¤í† ë¦¬ (ìˆœì„œ ê³ ì •: classic, jazz, rock, pop, ballad)
            const musicContainer = document.getElementById('musicInventory');
            if (!inventory.music) inventory.music = [];
            console.log('=== Music Inventory Debug ===');
            console.log('Music array:', inventory.music);
            console.log('Music array length:', inventory.music.length);
            
            if (inventory.music.length === 0) {
                console.log('No music, showing empty state');
                musicContainer.innerHTML = '<div class="inventory-item">ì—†ìŒ</div>';
            } else {
                const musicCounts = {};
                inventory.music.forEach(m => {
                    console.log('Processing music:', m);
                    musicCounts[m] = (musicCounts[m] || 0) + 1;
                });
                console.log('Music counts:', musicCounts);
                const musicOrder = ['classic', 'jazz', 'rock', 'pop', 'ballad'];
                const filteredMusic = musicOrder.filter(type => musicCounts[type]);
                console.log('Filtered music types:', filteredMusic);
                
                const musicHTML = filteredMusic.map(type => {
                    const html = `
                        <div class="inventory-item">
                            ${MUSIC_TYPES[type].icon} Ã—${musicCounts[type]}
                        </div>
                    `;
                    console.log('Generated HTML for', type, ':', html);
                    return html;
                }).join('');
                
                console.log('Final music HTML length:', musicHTML.length);
                console.log('Final music HTML:', musicHTML);
                musicContainer.innerHTML = musicHTML || '<div class="inventory-item">ì—†ìŒ</div>';
            }

            // ì¥ì‹ë¬¼ ì¸ë²¤í† ë¦¬ (ë“±ê¸‰ë³„ í‘œì‹œ)
            const decorContainer = document.getElementById('decorInventory');
            if (!inventory.decorations) inventory.decorations = [];
            if (inventory.decorations.length === 0) {
                decorContainer.innerHTML = '<div class="inventory-item">ì—†ìŒ</div>';
            } else {
                const decorCounts = {};
                inventory.decorations.forEach(d => {
                    decorCounts[d] = (decorCounts[d] || 0) + 1;
                });
                
                const decorHTML = Object.keys(decorCounts).map(key => {
                    const decoData = DECORATION_TYPES[key];
                    if (!decoData) return '';
                    
                    const qualityLabel = decoData.quality === 'epic' ? 'â­' : decoData.quality === 'rare' ? 'ğŸ’' : '';
                    return `
                        <div class="inventory-item" title="${decoData.name} (${decoData.attr} +${decoData.power})">
                            ${qualityLabel}${decoData.icon} Ã—${decorCounts[key]}
                        </div>
                    `;
                }).join('');
                
                decorContainer.innerHTML = decorHTML || '<div class="inventory-item">ì—†ìŒ</div>';
            }
        }


        function manualCompleteSpirit(spiritId) {
            if (isPaused) {
                showNotification('ê²Œì„ì´ ì¼ì‹œì •ì§€ ìƒíƒœì…ë‹ˆë‹¤');
                return;
            }
            
            const spirit = spirits.find(s => s.id === spiritId);
            if (!spirit) {
                showNotification('ì •ë ¹ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (spirit.growth >= 100 && !spirit.isCompleted) {
                try {
                    completeSpirit(spirit);
                    saveGame();
                    renderSpirits();
                    showNotification('âœ¨ ì •ë ¹ì´ ì§„í™”í•©ë‹ˆë‹¤!');
                } catch (error) {
                    console.error('ì§„í™” ì˜¤ë¥˜:', error);
                    showNotification('ì§„í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            } else {
                showNotification(`ì•„ì§ ì§„í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ì„±ì¥ë„: ${Math.floor(spirit.growth)}/100)`);
            }
        }

        function completeSpirit(spirit) {
            // ìŠ¤íƒ¯ìœ¼ë¡œ ì§„í™” ê²°ì •
            const params = spirit.parameters;
            const maxStat = Math.max(params.intelligence, params.strength, params.charm);
            
            // ë…¸ë©€ ì§„í™” ì²´í¬ (ëª¨ë“  ìŠ¤íƒ¯ì´ 20 ë¯¸ë§Œ)
            // í•˜ì§€ë§Œ ì†ì„±ì´ ìˆìœ¼ë©´ ì†ì„± ì§„í™” ê°€ëŠ¥
            const hasLowStats = maxStat < 20;
            
            // ìŠ¤íƒ¯ ê³„ì—´ ê²°ì • (20 ì´ìƒì¸ ê²½ìš°ë§Œ)
            let statType = '';
            let evolutionKey = '';
            
            if (!hasLowStats) {
                // ìµœê³  ìŠ¤íƒ¯ ê²°ì •
                if (params.intelligence >= params.strength && params.intelligence >= params.charm) {
                    statType = 'intelligent';
                } else if (params.strength >= params.intelligence && params.strength >= params.charm) {
                    statType = 'strong';
                } else {
                    statType = 'beautiful';
                }

                // ì§„í™” ë‹¨ê³„ ê²°ì • (ìŠ¤íƒ¯ ìˆ˜ì¹˜ ê¸°ì¤€)
                if (maxStat >= 80) {
                    evolutionKey = `${statType}-high`;  // 80+ : ì„¸ìƒì˜~
                } else if (maxStat >= 50) {
                    evolutionKey = `${statType}-mid`;  // 50-79 : ì§€ì ì¸/ê°•í•œ/ì•„ë¦„ë‹¤ìš´
                } else {
                    evolutionKey = `${statType}-low`;  // 20-49 : ë˜‘ë˜‘í•œ/íŠ¼íŠ¼í•œ/ê·€ì—¬ìš´
                }
            }

            // ì†ì„± ë¶„ì„ (ë¨¹ì´ 50% + í…Œë¼ë¦¬ì›€ 50%)
            const foodAttrs = spirit.hiddenAttributes || { fire: 0, water: 0, wind: 0, earth: 0, light: 0, dark: 0 };
            const terrariumAttrs = terrarium || { fire: 0, water: 0, wind: 0, earth: 0, light: 0, dark: 0 };
            
            // ìµœì¢… ì†ì„± = (ë¨¹ì´ ì†ì„± Ã— 0.5) + (í…Œë¼ë¦¬ì›€ ì†ì„± Ã— 0.5)
            const finalAttrs = {};
            for (let attr in foodAttrs) {
                finalAttrs[attr] = (foodAttrs[attr] * 0.5) + (terrariumAttrs[attr] * 0.5);
            }
            
            const sortedAttrs = Object.entries(finalAttrs)
                .sort((a, b) => b[1] - a[1]); // ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
            
            // ìµœê³  ì†ì„±ê°’
            const maxAttrValue = sortedAttrs[0][1];
            
            let attributeKey = '';
            let attributeData = null;
            
            if (maxAttrValue < 50) {
                // ëª¨ë“  ì†ì„±ì´ 50 ë¯¸ë§Œ - ë°±ì˜ ì •ë ¹
                attributeKey = 'normal';
                attributeData = { name: 'ë°±ì˜ ì •ë ¹', icon: 'ğŸ¤', desc: 'ì†ì„±ì´ ê¹ƒë“¤ì§€ ì•Šì€ ìˆœìˆ˜í•œ ì •ë ¹.' };
            } else {
                // 50 ì´ìƒì¸ ì†ì„±ë“¤ë§Œ í•„í„°ë§
                const significantAttrs = sortedAttrs.filter(([_, value]) => value >= 50);
                
                if (significantAttrs.length === 1) {
                    // ë‹¨ì¼ ì†ì„± (í•˜ë‚˜ë§Œ 60 ì´ìƒ)
                    attributeKey = significantAttrs[0][0];
                    attributeData = ATTRIBUTE_NAMES[attributeKey];
                    if (!attributeData) {
                        console.error('Missing ATTRIBUTE_NAMES for:', attributeKey);
                        // ê°€ì¥ ë†’ì€ ë‹¨ì¼ ì†ì„±ìœ¼ë¡œ í´ë°±
                        attributeKey = sortedAttrs[0][0];
                        attributeData = ATTRIBUTE_NAMES[attributeKey] || ATTRIBUTE_NAMES['fire'];
                    }
                } else if (significantAttrs.length === 2) {
                    // 2ì†ì„±: 1ìœ„ì™€ 2ìœ„ ì°¨ì´ê°€ 40% ì´í•˜ë©´ ì¡°í•©, ì´ˆê³¼ë©´ ë‹¨ì¼
                    const first = significantAttrs[0][1];
                    const second = significantAttrs[1][1];
                    const diffPercent = ((first - second) / first) * 100;
                    
                    if (diffPercent <= 40) {
                        // 2ì†ì„± ì¡°í•©
                        const attr1 = significantAttrs[0][0];
                        const attr2 = significantAttrs[1][0];
                        const comboKey = [attr1, attr2].sort().join('-');
                        attributeData = ATTRIBUTE_NAMES[comboKey];
                        attributeKey = comboKey;
                        if (!attributeData) {
                            console.error('Missing ATTRIBUTE_NAMES for combo:', comboKey);
                            // ì¡°í•©ì´ ì—†ìœ¼ë©´ 1ìˆœìœ„ ë‹¨ì¼ ì†ì„±ìœ¼ë¡œ í´ë°±
                            attributeKey = attr1;
                            attributeData = ATTRIBUTE_NAMES[attr1] || ATTRIBUTE_NAMES['fire'];
                        }
                    } else {
                        // ë‹¨ì¼ ì†ì„± (ì°¨ì´ê°€ ë„ˆë¬´ í¼)
                        attributeKey = significantAttrs[0][0];
                        attributeData = ATTRIBUTE_NAMES[attributeKey];
                        if (!attributeData) {
                            console.error('Missing ATTRIBUTE_NAMES for:', attributeKey);
                            // ê°€ì¥ ë†’ì€ ì†ì„±ìœ¼ë¡œ í´ë°±
                            attributeKey = sortedAttrs[0][0];
                            attributeData = ATTRIBUTE_NAMES[attributeKey] || ATTRIBUTE_NAMES['fire'];
                        }
                    }
                } else if (significantAttrs.length >= 3) {
                    // 3ì†ì„± ì´ìƒ
                    const topValues = significantAttrs.slice(0, 3).map(a => a[1]);
                    const maxVal = Math.max(...topValues);
                    const minVal = Math.min(...topValues);
                    const diffPercent = ((maxVal - minVal) / maxVal) * 100;
                    
                    if (diffPercent <= 25) {
                        // ì¡°í™” (ì°¨ì´ 25% ì´í•˜)
                        attributeKey = 'balanced';
                        attributeData = ATTRIBUTE_NAMES['balanced'];
                    } else {
                        // í˜¼ëˆ (ì°¨ì´ 25% ì´ˆê³¼)
                        attributeKey = 'multi';
                        attributeData = ATTRIBUTE_NAMES['multi'];
                    }
                    if (!attributeData) {
                        console.error('Missing ATTRIBUTE_NAMES for:', attributeKey);
                        // ê°€ì¥ ë†’ì€ ë‹¨ì¼ ì†ì„±ìœ¼ë¡œ í´ë°±
                        attributeKey = significantAttrs[0][0];
                        attributeData = ATTRIBUTE_NAMES[attributeKey] || ATTRIBUTE_NAMES['fire'];
                    }
                }
            }
            
            // ìµœì¢… ì´ë¦„ê³¼ ì•„ì´ì½˜ ì¡°í•©
            let finalName = '';
            let finalIcon = '';
            let finalDesc = '';
            
            // ë‚ ê°œ íƒ€ì… ë¨¼ì € ê²°ì • (í‹°íƒ€ë‹ˆì•„/ì˜¤ë² ë¡  íŒì •ì— í•„ìš”)
            if (!spirit.lightTime) spirit.lightTime = 0;
            if (!spirit.darkTime) spirit.darkTime = 0;
            
            let wingType = null;
            if (spirit.lightTime > spirit.darkTime) {
                wingType = 'butterfly';
            } else if (spirit.darkTime > spirit.lightTime) {
                wingType = 'moth';
            } else {
                wingType = 'butterfly'; // ë™ì ì´ë©´ ë‚˜ë¹„
            }
            
            // í‹°íƒ€ë‹ˆì•„/ì˜¤ë² ë¡  ì¡°ê±´ ì²´í¬
            // ëª¨ë“  ìŠ¤íƒ¯ 70 ì´ìƒ + ëª¨ë“  ì†ì„± 100 ê·¼ì ‘ (90 ì´ìƒ)
            const isPerfectStats = params.intelligence >= 70 && params.strength >= 70 && params.charm >= 70;
            const isPerfectAttributes = Object.values(finalAttrs).every(val => val >= 90);
            
            if (isPerfectStats && isPerfectAttributes) {
                // ì™„ë²½í•œ ì •ë ¹ - í‹°íƒ€ë‹ˆì•„/ì˜¤ë² ë¡ 
                if (wingType === 'butterfly') {
                    finalName = 'í‹°íƒ€ë‹ˆì•„';
                    finalIcon = 'ğŸ¦‹âœ¨';
                    finalDesc = 'ëª¨ë“  í˜ì„ ì™„ë²½íˆ ê°–ì¶˜ ë‚˜ë¹„ì˜ ì—¬ì™•. ë¹›ê³¼ ìƒëª…ì„ ê´€ì¥í•˜ëŠ” ì „ì„¤ì  ì¡´ì¬.';
                } else {
                    finalName = 'ì˜¤ë² ë¡ ';
                    finalIcon = 'ğŸ¦‹ğŸŒ™';
                    finalDesc = 'ëª¨ë“  í˜ì„ ì™„ë²½íˆ ê°–ì¶˜ ë‚˜ë°©ì˜ êµ°ì£¼. ì–´ë‘ ê³¼ ì‹ ë¹„ë¥¼ ì§€ë°°í•˜ëŠ” ì „ì„¤ì  ì¡´ì¬.';
                }
            } else if (attributeKey === 'normal') {
                // ì†ì„± ì—†ìŒ
                if (hasLowStats) {
                    // ìŠ¤íƒ¯ë„ ë‚®ìŒ - ìˆœìˆ˜í•œ ë°±ì˜ ì •ë ¹
                    if (attributeData) {
                        finalName = attributeData.name;
                        finalIcon = attributeData.icon;
                        finalDesc = attributeData.desc;
                    } else {
                        finalName = 'ë°±ì˜ ì •ë ¹';
                        finalIcon = 'ğŸ¤';
                        finalDesc = 'ì†ì„±ì´ ê¹ƒë“¤ì§€ ì•Šì€ ìˆœìˆ˜í•œ ì •ë ¹.';
                    }
                } else {
                    // ìŠ¤íƒ¯ì€ ë†’ìŒ - "ìŠ¤íƒ¯ ê³„ì—´ + ë°±ì˜ ì •ë ¹"
                    const evolution = EVOLUTION_TYPES[evolutionKey];
                    if (evolution && attributeData) {
                        finalName = `${evolution.prefix} ${attributeData.name}`;
                        finalIcon = `${evolution.icon}${attributeData.icon}`;
                        finalDesc = attributeData.desc;
                    } else if (evolution) {
                        // evolutionì€ ìˆëŠ”ë° attributeDataê°€ ì—†ìœ¼ë©´ ë°±ì˜ ì •ë ¹ ì‚¬ìš©
                        finalName = `${evolution.prefix} ë°±ì˜ ì •ë ¹`;
                        finalIcon = `${evolution.icon}ğŸ¤`;
                        finalDesc = 'ì†ì„±ì´ ê¹ƒë“¤ì§€ ì•Šì€ ìˆœìˆ˜í•œ ì •ë ¹.';
                    } else {
                        finalName = 'ë°±ì˜ ì •ë ¹';
                        finalIcon = 'ğŸ¤';
                        finalDesc = 'ì†ì„±ì´ ê¹ƒë“¤ì§€ ì•Šì€ ìˆœìˆ˜í•œ ì •ë ¹.';
                    }
                }
            } else if (hasLowStats) {
                // ìŠ¤íƒ¯ ë¶€ì¡±í•˜ì§€ë§Œ ì†ì„± ìˆìŒ - ì†ì„± ì´ë¦„ë§Œ
                if (attributeData) {
                    finalName = attributeData.name;
                    finalIcon = attributeData.icon;
                    finalDesc = attributeData.desc;
                } else {
                    console.error('attributeData is undefined for key:', attributeKey);
                    // ê°€ì¥ ë†’ì€ ë‹¨ì¼ ì†ì„±ìœ¼ë¡œ í´ë°±
                    const fallbackKey = sortedAttrs[0][0];
                    const fallbackData = ATTRIBUTE_NAMES[fallbackKey] || ATTRIBUTE_NAMES['fire'];
                    finalName = fallbackData.name;
                    finalIcon = fallbackData.icon;
                    finalDesc = fallbackData.desc;
                    attributeKey = fallbackKey;
                }
            } else {
                // ìŠ¤íƒ¯ë„ ìˆê³  ì†ì„±ë„ ìˆìŒ - "ìŠ¤íƒ¯ ê³„ì—´ + ì†ì„± ì´ë¦„" í˜•íƒœ
                const evolution = EVOLUTION_TYPES[evolutionKey];
                if (evolution && attributeData) {
                    finalName = `${evolution.prefix} ${attributeData.name}`;
                    finalIcon = `${evolution.icon}${attributeData.icon}`;
                    finalDesc = attributeData.desc;
                } else {
                    console.error('Evolution data missing:', { evolutionKey, attributeKey, evolution, attributeData });
                    // í´ë°±: ê°€ì¥ ë†’ì€ ì†ì„±ìœ¼ë¡œ ì§„í™”
                    const fallbackKey = sortedAttrs[0][0];
                    const fallbackData = ATTRIBUTE_NAMES[fallbackKey] || ATTRIBUTE_NAMES['fire'];
                    const fallbackEvolution = EVOLUTION_TYPES[evolutionKey] || EVOLUTION_TYPES['intelligent-mid'];
                    if (fallbackEvolution && fallbackData) {
                        finalName = `${fallbackEvolution.prefix} ${fallbackData.name}`;
                        finalIcon = `${fallbackEvolution.icon}${fallbackData.icon}`;
                        finalDesc = fallbackData.desc;
                    } else {
                        finalName = fallbackData.name;
                        finalIcon = fallbackData.icon;
                        finalDesc = fallbackData.desc;
                    }
                    attributeKey = fallbackKey;
                }
            }
            
            // evolutionKey ì„¤ì • (ë„ê° ë“±ë¡ìš©)
            let finalEvolutionType = evolutionKey;
            if (isPerfectStats && isPerfectAttributes) {
                // í‹°íƒ€ë‹ˆì•„/ì˜¤ë² ë¡ 
                finalEvolutionType = wingType === 'butterfly' ? 'titania' : 'oberon';
            } else if (hasLowStats) {
                // ìŠ¤íƒ¯ ë¶€ì¡±í•œ ê²½ìš°
                if (attributeKey === 'normal') {
                    finalEvolutionType = 'nostat';  // ìŠ¤íƒ¯ ë‚®ê³  ì†ì„±ë„ ì—†ìŒ -> nostat-normal
                } else {
                    finalEvolutionType = 'nostat';  // ìŠ¤íƒ¯ ë‚®ê³  ì†ì„± ìˆìŒ -> nostat-fire ë“±
                }
            } else if (attributeKey === 'normal') {
                // ìŠ¤íƒ¯ì€ ë†’ì€ë° ì†ì„± ì—†ìŒ -> intelligent-high-normal ê°™ì€ í˜•íƒœ ìœ ì§€
                finalEvolutionType = evolutionKey;
            }
            
            // ì •ë ¹ì„ ì™„ì„± ìƒíƒœë¡œ í‘œì‹œ (ì•„ì§ ì œê±°í•˜ì§€ ì•ŠìŒ)
            spirit.isCompleted = true;
            spirit.evolutionData = {
                type: finalEvolutionType,
                attributeType: attributeKey,
                name: finalName,
                icon: finalIcon,
                desc: finalDesc,
                wingType: wingType
            };
            
            saveGame();
            renderSpirits();
            showNotification('ğŸ‰ ì •ë ¹ì´ ì„±ì¥ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ìœ¡ì„± íƒ­ì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”.');
        }
        
        function confirmEvolution(spiritId) {
            const spirit = spirits.find(s => s.id === spiritId);
            if (!spirit || !spirit.isCompleted) {
                console.log('confirmEvolution failed:', { spirit, spiritId, isCompleted: spirit?.isCompleted });
                return;
            }
            
            const evolutionData = spirit.evolutionData;
            console.log('Evolution data:', evolutionData);
            
            const affection = spirit.parameters.affection || 0;
            
            // ì• ì •ë„ë³„ ì—”ë”© ë©”ì‹œì§€
            let endingMessage = '';
            
            if (affection >= 150) {
                endingMessage = `${spirit.name}ì€(ëŠ”) ë‹¹ì‹ ì—ê²Œ "ã…ã…ã…ã…"ë¼ëŠ” ë§ì„ ë‚¨ê¸°ê³  ë– ë‚©ë‹ˆë‹¤.\n\nì •ë ¹ì–´ ì‚¬ì „ì„ ì°¾ì•„ë³´ë©´ ê·¸ ë§ì€ "ì‚¬ë‘í•´ìš”"ë¼ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.`;
            } else if (affection >= 100) {
                endingMessage = `${spirit.name}ì€(ëŠ”) ë‹¹ì‹ ì˜ ëº¨ì— ì…ë§ì¶¤ì„ ë‚¨ê¸°ê³  ë– ë‚©ë‹ˆë‹¤.`;
            } else if (affection >= 50) {
                endingMessage = `${spirit.name}ì€(ëŠ”) ë‹¹ì‹ ì—ê²Œ ê°ì‚¬ì˜ ì¸ì‚¬ë¥¼ ë‚¨ê¸°ê³  ë– ë‚©ë‹ˆë‹¤.`;
            } else {
                endingMessage = `${spirit.name}ì´(ê°€) ë– ë‚˜ê°‘ë‹ˆë‹¤.`;
            }
            
            showConfirm(
                'ì •ë ¹ ì™„ì„±',
                endingMessage,
                () => {
                    // ì•¨ë²”ì— ì¶”ê°€
                collection.push({
                    type: evolutionData.type,
                    attributeType: evolutionData.attributeType,
                    name: evolutionData.name,
                    icon: evolutionData.icon,
                    desc: evolutionData.desc,
                    parameters: { ...spirit.parameters },
                    hiddenAttributes: { ...spirit.hiddenAttributes },
                    originalName: spirit.name,
                    wingType: evolutionData.wingType,
                    lightTime: spirit.lightTime,
                    darkTime: spirit.darkTime,
                    completedAt: Date.now()
                });
                
                // ë„ê°ì— ë“±ë¡ (ì§„í™” íƒ€ì…ë³„ ì¹´ìš´íŠ¸)
                let encyclopediaKey;
                if (evolutionData.type === 'titania' || evolutionData.type === 'oberon') {
                    // ì „ì„¤ì  ì¡´ì¬ëŠ” ê³ ìœ  í‚¤ ì‚¬ìš©
                    encyclopediaKey = evolutionData.type;
                } else if (evolutionData.type === 'nostat') {
                    // ìˆ˜ì‹ì–´ ì—†ëŠ” ì •ë ¹
                    encyclopediaKey = `nostat-${evolutionData.attributeType}`;
                } else {
                    // ì¼ë°˜ ì •ë ¹ (ìŠ¤íƒ¯-ë ˆë²¨-ì†ì„±)
                    encyclopediaKey = `${evolutionData.type}-${evolutionData.attributeType}`;
                }
                
                if (!encyclopedia[encyclopediaKey]) {
                    encyclopedia[encyclopediaKey] = 0;
                }
                encyclopedia[encyclopediaKey]++;
                
                console.log('ë„ê° ë“±ë¡:', encyclopediaKey, 'ì¹´ìš´íŠ¸:', encyclopedia[encyclopediaKey]);
                
                // ì½”ì¸ ë³´ìƒ (25ì½”ì¸)
                coins += 25;
                
                // ì •ë ¹ ì œê±°
                spirits = spirits.filter(s => s.id !== spiritId);
                saveGame();
                updateCoinDisplay();
                
                // ìë™ ë¡œì»¬ ë°±ì—… (ìµœê·¼ 10ê°œ ìœ ì§€)
                try {
                    const backups = JSON.parse(localStorage.getItem('spiritGarden_autoBackups') || '[]');
                    backups.unshift({
                        timestamp: Date.now(),
                        collection: [...collection],
                        encyclopedia: {...encyclopedia}
                    });
                    // ìµœê·¼ 10ê°œë§Œ ìœ ì§€
                    if (backups.length > 10) backups.length = 10;
                    localStorage.setItem('spiritGarden_autoBackups', JSON.stringify(backups));
                } catch (e) {
                    console.warn('ìë™ ë°±ì—… ì‹¤íŒ¨:', e);
                }
                
                    renderSpirits();
                    showNotification(`${evolutionData.icon} ${spirit.name}ì´(ê°€) ${evolutionData.name}(ìœ¼)ë¡œ ì•¨ë²”ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤ (+25ğŸ’°)`);
                }
            );
        }

        function showAlbumDetail(index) {
            const item = collection[index];
            if (!item) return;
            
            const modal = document.getElementById('albumDetailModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            
            modalTitle.textContent = item.name;
            
            // ë‚ ê°œ ì •ë³´
            let wingInfo = '';
            if (item.wingType === 'butterfly') {
                wingInfo = 'ğŸ¦‹ ë‚˜ë¹„ì˜ ë‚ ê°œ';
            } else if (item.wingType === 'moth') {
                wingInfo = 'ğŸ¦‹ ë‚˜ë°©ì˜ ë‚ ê°œ';
            }
            
            // ì¡°ëª… ì‹œê°„ ê³„ì‚°
            const lightMinutes = Math.floor((item.lightTime || 0) / 60);
            const darkMinutes = Math.floor((item.darkTime || 0) / 60);
            
            // ìˆ¨ê²¨ì§„ ì†ì„± ì •ë³´
            const hiddenAttrs = item.hiddenAttributes || { fire: 0, water: 0, wind: 0, earth: 0, light: 0, dark: 0 };
            
            modalContent.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 4rem; margin-bottom: 10px;">${item.icon}${wingInfo ? 'ğŸ¦‹' : ''}</div>
                    <div style="font-size: 0.9rem; color: #888;">ë³¸ëª…: ${item.originalName || 'ì´ë¦„ ì—†ìŒ'}</div>
                    ${wingInfo ? `<div style="font-size: 0.9rem; color: #888; margin-top: 4px;">${wingInfo}</div>` : ''}
                    ${item.desc ? `<div style="font-size: 0.9rem; color: #888; margin-top: 8px; line-height: 1.4; font-style: italic;">"${item.desc}"</div>` : ''}
                </div>
                
                <div style="background: var(--bg); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h3 style="font-size: 1rem; margin-bottom: 10px; color: var(--text);">ğŸ“Š ê¸°ë³¸ ìŠ¤íƒ¯</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <div class="param">ğŸ§  ì§€ë ¥: ${item.parameters.intelligence}</div>
                        <div class="param">ğŸ’ª ì²´ë ¥: ${item.parameters.strength}</div>
                        <div class="param">ë§¤ë ¥: ${item.parameters.charm}</div>
                        <div class="param">ì• ì •ë„: ${item.parameters.affection || 0}</div>
                    </div>
                </div>
                
                <div style="background: var(--bg); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h3 style="font-size: 1rem; margin-bottom: 10px; color: var(--text);">ğŸŒˆ ìˆ¨ê²¨ì§„ ì†ì„±</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                        <div style="font-size: 0.85rem; padding: 8px; background: var(--card); border-radius: 4px;">ğŸ”¥ í™”: ${hiddenAttrs.fire}</div>
                        <div style="font-size: 0.85rem; padding: 8px; background: var(--card); border-radius: 4px;">ğŸ’§ ìˆ˜: ${hiddenAttrs.water}</div>
                        <div style="font-size: 0.85rem; padding: 8px; background: var(--card); border-radius: 4px;">ğŸŒ¬ï¸ í’: ${hiddenAttrs.wind}</div>
                        <div style="font-size: 0.85rem; padding: 8px; background: var(--card); border-radius: 4px;">ğŸŒ± ì§€: ${hiddenAttrs.earth}</div>
                        <div style="font-size: 0.85rem; padding: 8px; background: var(--card); border-radius: 4px;">ë¹›: ${hiddenAttrs.light}</div>
                        <div style="font-size: 0.85rem; padding: 8px; background: var(--card); border-radius: 4px;">ğŸŒ™ ì•”: ${hiddenAttrs.dark}</div>
                    </div>
                </div>
                
                <div style="background: var(--bg); padding: 15px; border-radius: 8px;">
                    <h3 style="font-size: 1rem; margin-bottom: 10px; color: var(--text);">â±ï¸ ìœ¡ì„± ì •ë³´</h3>
                    <div style="font-size: 0.85rem; line-height: 1.6;">
                        <div>â˜€ï¸ ë¹› ì‹œê°„: ${lightMinutes}ë¶„</div>
                        <div>ğŸŒ™ ì–´ë‘  ì‹œê°„: ${darkMinutes}ë¶„</div>
                        <div style="margin-top: 8px; color: #888;">ë“±ë¡ ë‚ ì§œ: ${new Date(item.completedAt).toLocaleString('ko-KR')}</div>
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
        }
        
        function closeAlbumDetail() {
            const modal = document.getElementById('albumDetailModal');
            modal.style.display = 'none';
        }

        function applyGrowth() {
            if (isPaused) return; // ì¼ì‹œì •ì§€ ì¤‘ì´ë©´ ì„±ì¥ ì•ˆ í•¨
            
            spirits.forEach(spirit => {
                if (spirit.isDead || spirit.isCompleted) return;

                // ì„±ì¥ë„ +1
                const previousGrowth = spirit.growth;
                spirit.growth += 1;

                console.log(`Spirit ${spirit.name}: growth ${previousGrowth} â†’ ${spirit.growth}`);

                // ì„±ì¶© ì²´í¬ (100 ì´ìƒì´ë©´ ë¬´ì¡°ê±´ ì™„ë£Œ)
                if (spirit.growth >= STAGE_REQUIREMENTS.adult) {
                    console.log(`Completing spirit ${spirit.name} with growth ${spirit.growth}`);
                    completeSpirit(spirit);
                }
            });

            saveGame();
            updateAllSpiritCards();
        }

        function applyTerrariumGrowth() {
            if (isPaused) return; // ì¼ì‹œì •ì§€ ì¤‘ì´ë©´ ì‹¤í–‰ ì•ˆ í•¨
            
            spirits.forEach(spirit => {
                if (spirit.isDead || spirit.isCompleted) return;  // ì£½ì—ˆê±°ë‚˜ ì™„ì„±ëœ ì •ë ¹ ì œì™¸

                // ì¡°ëª… ëˆ„ì  ì‹œê°„ ì¶”ê°€ (300ì´ˆ = 5ë¶„)
                if (!spirit.lightTime) spirit.lightTime = 0;
                if (!spirit.darkTime) spirit.darkTime = 0;
                
                if (lightMode) {
                    spirit.lightTime += 300;
                } else {
                    spirit.darkTime += 300;
                }

                // ì •ë ¹ì˜ ìˆ¨ê²¨ì§„ ì†ì„±ì— í…Œë¼ë¦¬ì›€ í™˜ê²½ê°’ ì¶”ê°€
                if (!spirit.hiddenAttributes) {
                    spirit.hiddenAttributes = {
                        fire: 0, water: 0, wind: 0, earth: 0, light: 0, dark: 0
                    };
                }

                // í…Œë¼ë¦¬ì›€ì˜ ê° ì†ì„±ê°’ë§Œí¼ ì •ë ¹ì˜ ì†ì„± ì¦ê°€ (ìµœëŒ€ 100ê¹Œì§€ë§Œ)
                Object.keys(terrarium).forEach(attr => {
                    if (terrarium[attr] > 0) {
                        spirit.hiddenAttributes[attr] = Math.min(
                            spirit.hiddenAttributes[attr] + terrarium[attr],
                            100  // ì†ì„± ìµœëŒ€ì¹˜
                        );
                    }
                });
                
                // ì§ˆë³‘ ì²´í¬ (5ë¶„ë§ˆë‹¤, ì´ë¯¸ ì•„í”„ì§€ ì•Šì€ ê²½ìš°)
                if (!spirit.isSick) {
                    checkForDisease(spirit);
                }
            });

            saveGame();
            updateAllSpiritCards();
        }
        
        // ì§ˆë³‘ ì²´í¬ í•¨ìˆ˜
        function checkForDisease(spirit) {
            // ì •ë ¹ì˜ ì£¼ ì†ì„± ì°¾ê¸°
            const attrs = spirit.hiddenAttributes || { fire: 0, water: 0, wind: 0, earth: 0, light: 0, dark: 0 };
            let maxAttr = null;
            let maxValue = 0;
            
            for (let attr in attrs) {
                if (attrs[attr] > maxValue) {
                    maxValue = attrs[attr];
                    maxAttr = attr;
                }
            }
            
            // ì†ì„±ì´ ë„ˆë¬´ ë‚®ìœ¼ë©´ ì²´í¬ ì•ˆ í•¨
            if (maxValue < 20) return;
            
            // ëŒ€ë¦½ ì†ì„± ì •ì˜
            const opposites = {
                fire: 'water',
                water: 'fire',
                wind: 'earth',
                earth: 'wind',
                light: 'dark',
                dark: 'light'
            };
            
            const oppositeAttr = opposites[maxAttr];
            if (!oppositeAttr) return;
            
            // í…Œë¼ë¦¬ì›€ì˜ ëŒ€ë¦½ ì†ì„±ì´ ì •ë ¹ì˜ ì£¼ ì†ì„±ë³´ë‹¤ ë†’ìœ¼ë©´ ì§ˆë³‘ ìœ„í—˜
            if (terrarium[oppositeAttr] > terrarium[maxAttr] && terrarium[oppositeAttr] >= 10) {
                // 20% í™•ë¥ ë¡œ ì§ˆë³‘ ë°œìƒ
                if (Math.random() < 0.2) {
                    spirit.isSick = true;
                    spirit.sickTime = Date.now();
                    spirit.status = `${spirit.name}ì´(ê°€) ì•„íŒŒ ë³´ì…ë‹ˆë‹¤... ğŸ¤’`;
                    addLog(spirit, 'í™˜ê²½ì´ ë§ì§€ ì•Šì•„ ë³‘ì— ê±¸ë ¸ìŠµë‹ˆë‹¤');
                    showNotification(`${spirit.name}ì´(ê°€) ë³‘ì— ê±¸ë ¸ìŠµë‹ˆë‹¤!`);
                }
            }
        }

        function checkSpiritStatus() {
            const now = Date.now();
            spirits.forEach(spirit => {
                if (!spirit.lastFed) {
                    spirit.lastFed = spirit.birthTime;
                }

                const timeSinceLastFed = now - spirit.lastFed;
                const hours = timeSinceLastFed / 1000 / 60 / 60;

                // 24ì‹œê°„ ê²½ê³¼ - ì‚¬ë§ë§Œ ì²´í¬ (ë°°ê³ í”” ë©”ì‹œì§€ëŠ” getRandomMessageì—ì„œ ì²˜ë¦¬)
                if (hours >= 24) {
                    if (getStage(spirit.growth) === 'egg') {
                        spirit.status = 'âŒ ì•Œì´ ê¹¨ì ¸ì„œ ë¯¸ë™ì´ ì—†ìŠµë‹ˆë‹¤...';
                        spirit.isDead = true;
                    } else {
                        spirit.status = 'âŒ í…Œë¼ë¦¬ì›€ ë°–ìœ¼ë¡œ ë‚˜ê°€ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤...';
                        spirit.isDead = true;
                    }
                }
            });
        }

        function updateAllSpiritCards() {
            spirits.forEach(spirit => {
                updateSpiritCard(spirit);
            });
        }


        // ì¿¨íƒ€ì„ í…ìŠ¤íŠ¸ë§Œ ì—…ë°ì´íŠ¸ (ì„±ëŠ¥ ìµœì í™”)
        function updateCooldownDisplay() {
            if (currentTab !== 'garden' || isPaused) return;
            
            const now = Date.now();
            spirits.forEach((spirit, index) => {
                const cards = document.querySelectorAll('.spirit-card');
                const card = cards[index];
                if (!card) return;
                
                // ë²„íŠ¼ë“¤ ì°¾ê¸°
                const buttons = card.querySelectorAll('button');
                buttons.forEach(button => {
                    const text = button.textContent;
                    
                    // ë¨¹ì´ì£¼ê¸° ë²„íŠ¼
                    if (text.includes('ë¨¹ì´ì£¼ê¸°')) {
                        const canFeed = !isPaused && canDoAction(spirit, 'feed') && !spirit.isDead;
                        if (!canFeed && spirit.lastFeed) {
                            const remaining = Math.max(0, Math.ceil((10000 - (now - spirit.lastFeed)) / 1000));
                            button.textContent = `${spirit.isSick ? 'ğŸ¤¢ ' : ''}ë¨¹ì´ì£¼ê¸° (${remaining}ì´ˆ)`;
                        } else if (canFeed) {
                            button.textContent = `${spirit.isSick ? 'ğŸ¤¢ ' : ''}ë¨¹ì´ì£¼ê¸°`;
                        }
                    }
                    
                    // ìŒì•… ë“£ê¸° ë²„íŠ¼
                    if (text.includes('ìŒì•… ë“£ê¸°')) {
                        const canMusic = !isPaused && canDoAction(spirit, 'music') && !spirit.isDead;
                        if (!canMusic && spirit.lastMusic) {
                            const remaining = Math.max(0, Math.ceil((10000 - (now - spirit.lastMusic)) / 1000));
                            button.textContent = `ìŒì•… ë“£ê¸° (${remaining}ì´ˆ)`;
                        } else if (canMusic) {
                            button.textContent = `ìŒì•… ë“£ê¸°`;
                        }
                    }
                    
                    // ì“°ë‹¤ë“¬ê¸° ë²„íŠ¼
                    if (text.includes('ì“°ë‹¤ë“¬ê¸°')) {
                        const canPat = !isPaused && canDoAction(spirit, 'pat') && !spirit.isDead;
                        if (!canPat && spirit.lastPat) {
                            const remaining = Math.max(0, Math.ceil((10000 - (now - spirit.lastPat)) / 1000));
                            button.textContent = `ì“°ë‹¤ë“¬ê¸° (${remaining}ì´ˆ)`;
                        } else if (canPat) {
                            button.textContent = `ì“°ë‹¤ë“¬ê¸°`;
                        }
                    }
                });
            });
        }

        function updateSpiritCard(spirit) {
            const cards = document.querySelectorAll('.spirit-card');
            const index = spirits.findIndex(s => s.id === spirit.id);
            if (index === -1 || !cards[index]) return;

            const card = cards[index];
            const stage = getStage(spirit.growth);
            const nextReq = getNextStageRequirement(spirit.growth);
            const progress = (spirit.growth / nextReq) * 100;
            
            const canFeed = canDoAction(spirit, 'feed') && !spirit.isDead;
            const canMusic = canDoAction(spirit, 'music') && !spirit.isDead;
            const canPat = canDoAction(spirit, 'pat') && !spirit.isDead;

            let icon = STAGE_ICONS[stage];
            if (stage === 'adult' && spirit.evolutionType) {
                const evolutionData = EVOLUTION_TYPES[spirit.evolutionType];
                if (evolutionData) {
                    icon = evolutionData.icon;
                }
            }
            if (spirit.isDead) {
                icon = stage === 'egg' ? 'ğŸ’”' : 'ğŸ‘»';
            }

            // ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
            const iconElement = card.querySelector('.spirit-icon');
            if (iconElement && iconElement.textContent !== icon) {
                iconElement.textContent = icon;
            }

            // ìŠ¤í…Œì´ì§€ ì—…ë°ì´íŠ¸
            const stageElement = card.querySelector('.spirit-stage');
            if (stageElement) {
                stageElement.textContent = STAGE_NAMES[stage];
            }

            // ì§„í–‰ë„ ì—…ë°ì´íŠ¸
            const progressFill = card.querySelector('.progress-fill');
            if (progressFill) {
                progressFill.style.width = `${Math.min(progress, 100)}%`;
            }

            const progressText = card.querySelector('.progress-text');
            if (progressText) {
                progressText.textContent = `ì„±ì¥ ${spirit.growth} / ${nextReq}`;
            }

            // íŒŒë¼ë¯¸í„° ì—…ë°ì´íŠ¸
            const params = card.querySelectorAll('.param');
            if (params.length >= 4) {
                params[0].innerHTML = `<span class="param-icon">ğŸ§ </span>ì§€ë ¥ ${spirit.parameters.intelligence}`;
                params[1].innerHTML = `<span class="param-icon">ğŸ’ª</span>ì²´ë ¥ ${spirit.parameters.strength}`;
                params[2].innerHTML = `<span class="param-icon">ğŸ’–</span>ë§¤ë ¥ ${spirit.parameters.charm}`;
                params[3].innerHTML = `<span class="param-icon">â¤ï¸</span>ì• ì • ${spirit.parameters.affection}`;
            }

            // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
            const statusElement = card.querySelector('.spirit-status');
            if (statusElement) {
                statusElement.textContent = spirit.status;
            }

            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            const actionButtons = card.querySelector('.action-buttons');
            if (actionButtons) {
                const buttons = actionButtons.querySelectorAll('button');
                if (buttons.length >= 4) {
                    buttons[0].disabled = !canFeed;
                    buttons[1].disabled = !canMusic;
                    buttons[2].disabled = !canPat;
                    // buttons[3]ëŠ” ë³´ë‚´ê¸° ë²„íŠ¼ì´ë¯€ë¡œ í•­ìƒ í™œì„±í™”
                }
            }
        }

        function toggleLogs(spiritId) {
            const logsDiv = document.getElementById(`logs${spiritId}`);
            const toggleIcon = document.getElementById(`logToggle${spiritId}`);
            
            if (logsDiv.style.display === 'none') {
                logsDiv.style.display = 'block';
                toggleIcon.textContent = 'â–²';
            } else {
                logsDiv.style.display = 'none';
                toggleIcon.textContent = 'â–¼';
            }
        }

        function renderSpirits() {
            const grid = document.getElementById('spiritsGrid');
            const now = Date.now(); // ì¿¨íƒ€ì„ ê³„ì‚°ìš©
            
            if (spirits.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ¥š</div>
                        <div>ì•„ì§ ì •ë ¹ì´ ì—†ìŠµë‹ˆë‹¤<br>ìƒˆë¡œìš´ ì•Œì„ ë°›ì•„ë³´ì„¸ìš”</div>
                    </div>
                `;
                return;
            }

            grid.innerHTML = spirits.map(spirit => {
                const stage = getStage(spirit.growth);
                const nextReq = getNextStageRequirement(spirit.growth);
                const progress = (spirit.growth / nextReq) * 100;
                
                const canFeed = !isPaused && canDoAction(spirit, 'feed') && !spirit.isDead;
                const canMusic = !isPaused && canDoAction(spirit, 'music') && !spirit.isDead;
                const canPat = !isPaused && canDoAction(spirit, 'pat') && !spirit.isDead;

                let icon = STAGE_ICONS[stage];
                if (stage === 'adult' && spirit.evolutionType) {
                    const evolutionData = EVOLUTION_TYPES[spirit.evolutionType];
                    if (evolutionData) {
                        icon = evolutionData.icon;
                    }
                }
                if (spirit.isDead) {
                    icon = stage === 'egg' ? 'ğŸ’”' : 'ğŸ‘»';
                }

                // í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•œ íŒŒë¼ë¯¸í„° ì²´í¬
                if (!spirit.parameters.affection && spirit.parameters.mystery !== undefined) {
                    spirit.parameters.affection = spirit.parameters.mystery;
                    delete spirit.parameters.mystery;
                }
                if (!spirit.hiddenAttributes) {
                    spirit.hiddenAttributes = {
                        fire: 0, water: 0, wind: 0, earth: 0, light: 0, dark: 0
                    };
                }
                if (!spirit.logs) {
                    spirit.logs = [];
                }
                if (!spirit.lightTime) {
                    spirit.lightTime = 0;
                }
                if (!spirit.darkTime) {
                    spirit.darkTime = 0;
                }
                if (!spirit.musicListened) {
                    spirit.musicListened = 0;
                }
                if (!spirit.feedCount) {
                    spirit.feedCount = 0;
                }
                
                // ì™„ì„±ëœ ì •ë ¹ì¸ ê²½ìš° íŠ¹ë³„í•œ ì¹´ë“œ í‘œì‹œ
                if (spirit.isCompleted && spirit.evolutionData) {
                    return `
                        <div class="spirit-card" style="background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); border: 3px solid #ffa500;">
                            <div style="text-align: center; padding: 20px;">
                                <div style="font-size: 4rem; margin-bottom: 15px;">${spirit.evolutionData.icon}</div>
                                <div style="font-size: 1.3rem; font-weight: 700; color: #333; margin-bottom: 10px;">
                                    ğŸ‰ ë²ˆë°ê¸°ì—ì„œ ì •ë ¹ì´ ë¶€í™”í–ˆìŠµë‹ˆë‹¤! ğŸ‰
                                </div>
                                <div style="font-size: 1rem; color: #555; margin-bottom: 8px;">
                                    ${spirit.name} â†’ ${spirit.evolutionData.name}
                                </div>
                                <div style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">
                                    ì• ì •ë„: ${spirit.parameters.affection || 0}
                                </div>
                                <button onclick="confirmEvolution(${spirit.id})" style="
                                    background: #ff6b6b;
                                    color: white;
                                    border: none;
                                    padding: 15px 30px;
                                    font-size: 1.1rem;
                                    font-weight: 700;
                                    border-radius: 8px;
                                    cursor: pointer;
                                    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                                ">
                                    í™•ì¸í•˜ê¸°
                                </button>
                            </div>
                        </div>
                    `;
                }
                // ì™¸í˜• ë¬˜ì‚¬ ê°€ì ¸ì˜¤ê¸°
                const appearance = getAppearanceDescription(spirit);

                return `
                    <div class="spirit-card" style="position: relative;">
                        ${(() => {
                            const satisfaction = spirit.satisfaction || 'mid';
                            const satisfactionIcons = { high: '', mid: '', low: '' };
                            const satisfactionTexts = { high: 'ë§Œì¡±', mid: 'ë³´í†µ', low: 'ë¶ˆë§Œ' };
                            const satisfactionColors = { high: '#4caf50', mid: '#ff9800', low: '#f44336' };
                            return `
                                <div style="position: absolute; top: 12px; right: 12px; display: flex; align-items: center; gap: 4px; padding: 4px 8px; background: ${satisfactionColors[satisfaction]}22; border: 1px solid ${satisfactionColors[satisfaction]}; border-radius: 12px; font-size: 0.75rem;">
                                    <span style="font-size: 1rem;">${satisfactionIcons[satisfaction]}</span>
                                    <span style="font-weight: 600; color: ${satisfactionColors[satisfaction]};">${satisfactionTexts[satisfaction]}</span>
                                </div>
                            `;
                        })()}
                        <div class="spirit-header">
                            <div class="spirit-icon" onclick="showAppearance(${spirit.id})" style="cursor: pointer;">${icon}</div>
                            <div class="spirit-info">
                                <div class="spirit-name" onclick="changeName(${spirit.id})">${spirit.name}</div>
                                <div class="spirit-stage">${STAGE_NAMES[stage]}</div>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(progress, 100)}%"></div>
                        </div>
                        <div class="progress-text">ì„±ì¥ ${spirit.growth} / ${nextReq}</div>
                        <div class="parameters">
                            <div class="param"><span class="param-icon">ğŸ§ </span>ì§€ë ¥ ${spirit.parameters.intelligence}</div>
                            <div class="param"><span class="param-icon">ğŸ’ª</span>ì²´ë ¥ ${spirit.parameters.strength}</div>
                            <div class="param"><span class="param-icon">ğŸ’–</span>ë§¤ë ¥ ${spirit.parameters.charm}</div>
                            <div class="param"><span class="param-icon">â¤ï¸</span>ì• ì • ${spirit.parameters.affection}</div>
                        </div>
                        ${(() => {
                            const keywords = getStatusKeywords(spirit);
                            if (keywords.length === 0) return '';
                            return `
                                <div style="margin: 12px 0; padding: 10px; background: var(--bg); border: 1px solid var(--border); display: flex; flex-wrap: wrap; gap: 6px;">
                                    ${keywords.map(kw => `
                                        <span style="
                                            display: inline-flex;
                                            align-items: center;
                                            padding: 4px 10px;
                                            background: #f5f5f5;
                                            border: 1px solid #ddd;
                                            font-size: 0.8rem;
                                            font-weight: 600;
                                            color: ${kw.color};
                                        ">
                                            ${kw.text}
                                        </span>
                                    `).join('')}
                                </div>
                            `;
                        })()}
                        <div class="spirit-status">${spirit.status}</div>
                        ${spirit.logs && spirit.logs.length > 0 ? `
                            <div style="margin-top: 12px; border-top: 1px solid var(--border); padding-top: 12px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;" onclick="toggleLogs(${spirit.id})">
                                    <span style="font-size: 0.9rem; font-weight: 600;">ì¼ì§€ (${spirit.logs.length}ê°œ)</span>
                                    <span id="logToggle${spirit.id}" style="font-size: 0.8rem;">â–¼</span>
                                </div>
                                <div id="logs${spirit.id}" style="display: none; margin-top: 8px; max-height: 200px; overflow-y: auto;">
                                    ${spirit.logs.map(log => `
                                        <div style="font-size: 0.85rem; color: #888; padding: 4px 0; border-bottom: 1px solid var(--border);">
                                            <span style="color: #666;">${log.time}</span> - ${log.message}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        <div class="action-buttons">
                            ${spirit.isSick ? `
                                <button onclick="giveMedicine(${spirit.id})" style="background: var(--earth); color: white; font-weight: 700;">
                                    ğŸŒ¿ ì•½ì´ˆ ì‚¬ìš©
                                </button>
                            ` : ''}
                            <button onclick="openFeedModal(${spirit.id})" ${!canFeed ? 'disabled' : ''}>
                                ${spirit.isSick ? 'ğŸ¤’ ' : ''}ë¨¹ì´ì£¼ê¸°${!canFeed && spirit.lastFeed ? ` (${Math.ceil((10000 - (now - spirit.lastFeed)) / 1000)}ì´ˆ)` : ''}
                            </button>
                            <button onclick="openMusicModal(${spirit.id})" ${!canMusic ? 'disabled' : ''}>
                                ìŒì•… ë“£ê¸°${!canMusic && spirit.lastMusic ? ` (${Math.max(0, Math.ceil((10000 - (now - spirit.lastMusic)) / 1000))}ì´ˆ)` : ''}
                            </button>
                            <button onclick="patSpirit(${spirit.id})" ${!canPat ? 'disabled' : ''}>
                                ì“°ë‹¤ë“¬ê¸°${!canPat && spirit.lastPat ? ` (${Math.max(0, Math.ceil((10000 - (now - spirit.lastPat)) / 1000))}ì´ˆ)` : ''}
                            </button>
                            ${spirit.growth >= 100 && !spirit.isCompleted ? `
                                <button onclick="manualCompleteSpirit(${spirit.id})" style="background: #ffd700; color: #000; font-weight: 700;">
                                    ì§„í™”í•˜ê¸°
                                </button>
                            ` : ''}
                            <button onclick="confirmDeleteSpirit(${spirit.id})">
                                ë³´ë‚´ê¸°
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateCoinDisplay() {
            const displays = document.querySelectorAll('#coinDisplay, #shopCoinDisplay');
            displays.forEach(el => {
                if (el) el.textContent = coins;
            });
        }


        function changeSellFilter() {
            const select = document.getElementById('sellFilterSelect');
            sellFilter = select.value;
            renderSellList();
        }

        function changeBuyFilter() {
            const select = document.getElementById('buyFilterSelect');
            buyFilter = select.value;
            renderBuyList();
        }

        function renderShop() {
            updateCoinDisplay();
            renderSellList();
            renderBuyList();
        }

        function renderSellList() {
            const container = document.getElementById('sellList');
            if (!container) return;

            const items = [];

            if (currentShopCategory === 'all' || currentShopCategory === 'food') {
                // ë¨¹ì´ íŒë§¤ (ìˆœì„œ ê³ ì •)
                if (inventory.food && inventory.food.length > 0) {
                    const foodCounts = {};
                    inventory.food.forEach(f => {
                        foodCounts[f] = (foodCounts[f] || 0) + 1;
                    });

                    const foodOrder = ['fire', 'water', 'wind', 'earth', 'light', 'dark'];
                    foodOrder.filter(type => foodCounts[type]).forEach(type => {
                        // ì†ì„± í•„í„° ì²´í¬
                        if (sellFilter === 'all') {
                            // ì „ì²´ ë³´ê¸°
                        } else if (['intelligence', 'strength', 'charm'].includes(sellFilter)) {
                            return; // ìŠ¤íƒ¯ í•„í„° ì‹œ ë¨¹ì´ ìˆ¨ê¹€
                        } else if (type !== sellFilter) {
                            return; // ë‹¤ë¥¸ ì†ì„±ì´ë©´ ìˆ¨ê¹€
                        }
                        
                        const count = foodCounts[type];
                        const isRare = type === 'light' || type === 'dark';
                        const price = isRare ? SHOP_PRICES.sell.food_rare : SHOP_PRICES.sell.food_common;
                        items.push(`
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); border: 1px solid var(--border); margin-bottom: 10px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-size: 1.5rem;">${ENV_ICONS[type]}</span>
                                    <div>
                                        <div style="font-weight: 700;">${FOOD_NAMES[type]} Ã—${count}</div>
                                        <div style="font-size: 0.85rem; color: #888;">íŒë§¤ê°€: ${price}ğŸ’°</div>
                                    </div>
                                </div>
                                <button onclick="sellItem('food', '${type}')" style="padding: 8px 16px; background: var(--fire); color: white;">íŒë§¤</button>
                            </div>
                        `);
                    });
                }
            }
            
            if (currentShopCategory === 'all' || currentShopCategory === 'decoration') {
                // ì¥ì‹ë¬¼ íŒë§¤ (ì†ì„± â†’ í’ˆì§ˆ â†’ ì´ë¦„ ìˆœ ì •ë ¬)
                if (inventory.decorations && inventory.decorations.length > 0) {
                    const decorCounts = {};
                    inventory.decorations.forEach(d => {
                        decorCounts[d] = (decorCounts[d] || 0) + 1;
                    });

                    // ì†ì„±ë³„, í’ˆì§ˆë³„, ì´ë¦„ë³„ë¡œ ì •ë ¬
                    const sortedDecoKeys = Object.keys(decorCounts).sort((a, b) => {
                        const dataA = DECORATION_TYPES[a];
                        const dataB = DECORATION_TYPES[b];
                        if (!dataA || !dataB) return 0;
                        
                        // 1. ì†ì„±ë³„ ì •ë ¬
                        const attrOrder = { fire: 0, water: 1, wind: 2, earth: 3, light: 4, dark: 5 };
                        const attrDiff = (attrOrder[dataA.attr] || 0) - (attrOrder[dataB.attr] || 0);
                        if (attrDiff !== 0) return attrDiff;
                        
                        // 2. í’ˆì§ˆë³„ ì •ë ¬ (ë†’ì€ ìˆœ)
                        const qualityOrder = { epic: 0, rare: 1, common: 2 };
                        const qualityDiff = (qualityOrder[dataA.quality] || 2) - (qualityOrder[dataB.quality] || 2);
                        if (qualityDiff !== 0) return qualityDiff;
                        
                        // 3. ì´ë¦„ë³„ ì •ë ¬
                        return dataA.name.localeCompare(dataB.name);
                    });
                    
                    sortedDecoKeys.forEach(key => {
                        const decoData = DECORATION_TYPES[key];
                        if (!decoData) return; // ë°ì´í„° ì—†ìœ¼ë©´ ìŠ¤í‚µ
                        
                        // ì†ì„± í•„í„° ì²´í¬
                        if (sellFilter === 'all') {
                            // ì „ì²´ ë³´ê¸°
                        } else if (['intelligence', 'strength', 'charm'].includes(sellFilter)) {
                            return; // ìŠ¤íƒ¯ í•„í„° ì‹œ ì¥ì‹ë¬¼ ìˆ¨ê¹€
                        } else if (decoData.attr !== sellFilter) {
                            return; // ë‹¤ë¥¸ ì†ì„±ì´ë©´ ìˆ¨ê¹€
                        }
                        
                        const count = decorCounts[key];
                        
                        const sellPrice = Math.floor(decoData.price * 0.5); // íŒë§¤ê°€ëŠ” êµ¬ë§¤ê°€ì˜ 50%
                        const qualityLabel = decoData.quality === 'epic' ? 'â­' : decoData.quality === 'rare' ? 'ğŸ’' : '';
                        
                        items.push(`
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); border: 1px solid var(--border); margin-bottom: 10px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-size: 1.5rem;">${qualityLabel}${decoData.icon}</span>
                                    <div>
                                        <div style="font-weight: 700;">${decoData.name} Ã—${count}</div>
                                        <div style="font-size: 0.85rem; color: #888;">íŒë§¤ê°€: ${sellPrice}ğŸ’°</div>
                                    </div>
                                </div>
                                <button onclick="sellItem('decoration', '${key}')" style="padding: 8px 16px; background: var(--fire); color: white;">íŒë§¤</button>
                            </div>
                        `);
                    });
                }
            }

            

            if (currentShopCategory === 'all' || currentShopCategory === 'music') {
                // ìŒì•… íŒë§¤ (ìˆœì„œ ê³ ì •)
                if (inventory.music && inventory.music.length > 0) {
                    const musicCounts = {};
                    inventory.music.forEach(m => {
                        musicCounts[m] = (musicCounts[m] || 0) + 1;
                    });

                    const musicOrder = ['classic', 'jazz', 'rock', 'pop', 'ballad'];
                    musicOrder.filter(type => musicCounts[type]).forEach(type => {
                        const musicData = MUSIC_TYPES[type];
                        
                        // ìŠ¤íƒ¯ í•„í„° ì²´í¬ (ìŒì•… ì „ìš©)
                        if (sellFilter === 'all') {
                            // ì „ì²´ ë³´ê¸°ì¼ ë•ŒëŠ” í•„í„°ë§ ì•ˆ í•¨
                        } else if (sellFilter === 'intelligence') {
                            if (type !== 'classic') return;
                        } else if (sellFilter === 'strength') {
                            if (type !== 'rock') return;
                        } else if (sellFilter === 'charm') {
                            if (!['jazz', 'pop', 'ballad'].includes(type)) return;
                        } else if (['fire', 'water', 'wind', 'earth', 'light', 'dark'].includes(sellFilter)) {
                            return; // ì†ì„± í•„í„° ì‹œ ìŒì•… ìˆ¨ê¹€
                        }
                        
                        const count = musicCounts[type];
                        items.push(`
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); border: 1px solid var(--border); margin-bottom: 10px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-size: 1.5rem;">ğŸµ</span>
                                    <div>
                                        <div style="font-weight: 700;">${musicData.name} Ã—${count}</div>
                                        <div style="font-size: 0.85rem; color: #888;">íŒë§¤ê°€: ${SHOP_PRICES.sell.music}ğŸ’°</div>
                                    </div>
                                </div>
                                <button onclick="sellItem('music', '${type}')" style="padding: 8px 16px; background: var(--fire); color: white;">íŒë§¤</button>
                            </div>
                        `);
                    });
                }
            }

            if (items.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">íŒë§¤í•  ë¬¼í’ˆì´ ì—†ìŠµë‹ˆë‹¤</p>';
            } else {
                container.innerHTML = items.join('');
            }
        }

        function renderBuyList() {
            const container = document.getElementById('buyList');
            if (!container) return;

            const items = [];
            
            if (currentShopCategory === 'all' || currentShopCategory === 'food') {
                // ì•½ì´ˆ êµ¬ë§¤ (ì œì¼ ìœ„ì— í‘œì‹œ)
                items.push(`
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); border: 1px solid var(--border); margin-bottom: 10px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.5rem;">${MEDICINE.icon}</span>
                            <div>
                                <div style="font-weight: 700;">${MEDICINE.name}</div>
                                <div style="font-size: 0.85rem; color: #666;">${MEDICINE.description}</div>
                                <div style="font-size: 0.85rem; color: #888;">ê°€ê²©: ${MEDICINE.price}ğŸ’°</div>
                            </div>
                        </div>
                        <button onclick="buyItem('medicine', 'medicine', ${MEDICINE.price})" style="padding: 8px 16px;">êµ¬ë§¤</button>
                    </div>
                `);
                
                // ì¼ë°˜ ë¨¹ì´ êµ¬ë§¤
                ['fire', 'water', 'wind', 'earth'].forEach(type => {
                    // ì†ì„± í•„í„° ì²´í¬
                    if (buyFilter === 'all') {
                        // ì „ì²´ ë³´ê¸°
                    } else if (['intelligence', 'strength', 'charm'].includes(buyFilter)) {
                        return; // ìŠ¤íƒ¯ í•„í„° ì‹œ ë¨¹ì´ ìˆ¨ê¹€
                    } else if (type !== buyFilter) {
                        return; // ë‹¤ë¥¸ ì†ì„±ì´ë©´ ìˆ¨ê¹€
                    }
                    
                    items.push(`
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); border: 1px solid var(--border); margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5rem;">${ENV_ICONS[type]}</span>
                                <div>
                                    <div style="font-weight: 700;">${FOOD_NAMES[type]}</div>
                                    <div style="font-size: 0.85rem; color: #888;">ê°€ê²©: ${SHOP_PRICES.buy.food_common}ğŸ’°</div>
                                </div>
                            </div>
                            <button onclick="buyItem('food', '${type}', ${SHOP_PRICES.buy.food_common})" style="padding: 8px 16px;">êµ¬ë§¤</button>
                        </div>
                    `);
                });

                // í¬ê·€ ë¨¹ì´ êµ¬ë§¤
                ['light', 'dark'].forEach(type => {
                    // ì†ì„± í•„í„° ì²´í¬
                    if (buyFilter === 'all') {
                        // ì „ì²´ ë³´ê¸°
                    } else if (['intelligence', 'strength', 'charm'].includes(buyFilter)) {
                        return; // ìŠ¤íƒ¯ í•„í„° ì‹œ ë¨¹ì´ ìˆ¨ê¹€
                    } else if (type !== buyFilter) {
                        return; // ë‹¤ë¥¸ ì†ì„±ì´ë©´ ìˆ¨ê¹€
                    }
                    
                    items.push(`
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); border: 1px solid var(--border); margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5rem;">${ENV_ICONS[type]}</span>
                                <div>
                                    <div style="font-weight: 700;">${FOOD_NAMES[type]}</div>
                                    <div style="font-size: 0.85rem; color: #888;">ê°€ê²©: ${SHOP_PRICES.buy.food_rare}ğŸ’°</div>
                                </div>
                            </div>
                            <button onclick="buyItem('food', '${type}', ${SHOP_PRICES.buy.food_rare})" style="padding: 8px 16px;">êµ¬ë§¤</button>
                        </div>
                    `);
                });
            }

            

            if (currentShopCategory === 'all' || currentShopCategory === 'music') {
                // ìŒì•… êµ¬ë§¤
                Object.keys(MUSIC_TYPES).forEach(type => {
                    // ìŠ¤íƒ¯ í•„í„° ì²´í¬ (ìŒì•… ì „ìš©)
                    if (buyFilter === 'all') {
                        // ì „ì²´ ë³´ê¸°ì¼ ë•ŒëŠ” í•„í„°ë§ ì•ˆ í•¨
                    } else if (buyFilter === 'intelligence') {
                        if (type !== 'classic') return;
                    } else if (buyFilter === 'strength') {
                        if (type !== 'rock') return;
                    } else if (buyFilter === 'charm') {
                        if (!['jazz', 'pop', 'ballad'].includes(type)) return;
                    } else if (['fire', 'water', 'wind', 'earth', 'light', 'dark'].includes(buyFilter)) {
                        return; // ì†ì„± í•„í„° ì‹œ ìŒì•… ìˆ¨ê¹€
                    }
                    
                    const musicData = MUSIC_TYPES[type];
                    items.push(`
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); border: 1px solid var(--border); margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5rem;">ğŸµ</span>
                                <div>
                                    <div style="font-weight: 700;">${musicData.name}</div>
                                    <div style="font-size: 0.85rem; color: #888;">ê°€ê²©: ${SHOP_PRICES.buy.music}ğŸ’°</div>
                                </div>
                            </div>
                            <button onclick="buyItem('music', '${type}', ${SHOP_PRICES.buy.music})" style="padding: 8px 16px;">êµ¬ë§¤</button>
                        </div>
                    `);
                });
            }
            
            if (currentShopCategory === 'all' || currentShopCategory === 'decoration') {
                // ì¥ì‹ë¬¼ êµ¬ë§¤ (ë“±ê¸‰ë³„ ê·¸ë£¹í™”)
                const decorationsByQuality = {
                    common: [],
                    rare: [],
                    epic: []
                };
                
                Object.keys(DECORATION_TYPES).forEach(key => {
                    const decoData = DECORATION_TYPES[key];
                    
                    // ì†ì„± í•„í„° ì²´í¬
                    if (buyFilter === 'all') {
                        // ì „ì²´ ë³´ê¸°
                    } else if (['intelligence', 'strength', 'charm'].includes(buyFilter)) {
                        return; // ìŠ¤íƒ¯ í•„í„° ì‹œ ì¥ì‹ë¬¼ ìˆ¨ê¹€
                    } else if (decoData.attr !== buyFilter) {
                        return; // ë‹¤ë¥¸ ì†ì„±ì´ë©´ ìˆ¨ê¹€
                    }
                    
                    decorationsByQuality[decoData.quality].push({ key, data: decoData });
                });
                
                // ì¼ë°˜ ì¥ì‹ë¬¼
                items.push(`<div style="margin: 20px 0; padding: 10px; background: #f0f0f0; color: #333; font-weight: 700;">ğŸ  ì¼ë°˜ ì¥ì‹ë¬¼</div>`);
                decorationsByQuality.common.forEach(({ key, data }) => {
                    items.push(`
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); border: 1px solid var(--border); margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5rem;">${data.icon}</span>
                                <div>
                                    <div style="font-weight: 700;">${data.name}</div>
                                    <div style="font-size: 0.85rem; color: #888;">ê°€ê²©: ${data.price}ğŸ’° | ${data.attr} +${data.power}</div>
                                </div>
                            </div>
                            <button onclick="buyItem('decoration', '${key}', ${data.price})" style="padding: 8px 16px;">êµ¬ë§¤</button>
                        </div>
                    `);
                });
                
                // í¬ê·€ ì¥ì‹ë¬¼
                items.push(`<div style="margin: 20px 0; padding: 10px; background: #e3f2fd; color: #1565c0; font-weight: 700;">ğŸ’ í¬ê·€ ì¥ì‹ë¬¼</div>`);
                decorationsByQuality.rare.forEach(({ key, data }) => {
                    items.push(`
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); border: 1px solid var(--border); margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5rem;">ğŸ’${data.icon}</span>
                                <div>
                                    <div style="font-weight: 700;">${data.name}</div>
                                    <div style="font-size: 0.85rem; color: #888;">ê°€ê²©: ${data.price}ğŸ’° | ${data.attr} +${data.power}</div>
                                </div>
                            </div>
                            <button onclick="buyItem('decoration', '${key}', ${data.price})" style="padding: 8px 16px;">êµ¬ë§¤</button>
                        </div>
                    `);
                });
                
                // ìµœìƒê¸‰ ì¥ì‹ë¬¼
                items.push(`<div style="margin: 20px 0; padding: 10px; background: #fff3e0; color: #e65100; font-weight: 700;">â­ ìµœìƒê¸‰ ì¥ì‹ë¬¼</div>`);
                decorationsByQuality.epic.forEach(({ key, data }) => {
                    items.push(`
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); border: 1px solid var(--border); margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5rem;">â­${data.icon}</span>
                                <div>
                                    <div style="font-weight: 700;">${data.name}</div>
                                    <div style="font-size: 0.85rem; color: #888;">ê°€ê²©: ${data.price}ğŸ’° | ${data.attr} +${data.power}</div>
                                </div>
                            </div>
                            <button onclick="buyItem('decoration', '${key}', ${data.price})" style="padding: 8px 16px;">êµ¬ë§¤</button>
                        </div>
                    `);
                });
            }

            container.innerHTML = items.length > 0 ? items.join('') : '<p style="color: #888; text-align: center; padding: 20px;">êµ¬ë§¤ ê°€ëŠ¥í•œ ë¬¼í’ˆì´ ì—†ìŠµë‹ˆë‹¤</p>';
        }

        function sellItem(category, type) {
            if (category === 'food') {
                const index = inventory.food.indexOf(type);
                if (index === -1) return;
                inventory.food.splice(index, 1);
                const isRare = type === 'light' || type === 'dark';
                const price = isRare ? SHOP_PRICES.sell.food_rare : SHOP_PRICES.sell.food_common;
                coins += price;
                showNotification(`${FOOD_NAMES[type]}ì„(ë¥¼) ${price}ğŸ’°ì— íŒë§¤í–ˆìŠµë‹ˆë‹¤`);
            } else if (category === 'decoration') {
                const index = inventory.decorations.indexOf(type);
                if (index === -1) return;
                inventory.decorations.splice(index, 1);
                
                const decoData = DECORATION_TYPES[type];
                const sellPrice = Math.floor(decoData.price * 0.5);
                coins += sellPrice;
                showNotification(`${decoData.name}ì„(ë¥¼) ${sellPrice}ğŸ’°ì— íŒë§¤í–ˆìŠµë‹ˆë‹¤`);
            } else if (category === 'music') {
                const index = inventory.music.indexOf(type);
                if (index === -1) return;
                inventory.music.splice(index, 1);
                coins += SHOP_PRICES.sell.music;
                showNotification(`${MUSIC_TYPES[type].name}ì„(ë¥¼) ${SHOP_PRICES.sell.music}ğŸ’°ì— íŒë§¤í–ˆìŠµë‹ˆë‹¤`);
            }

            saveGame();
            renderShop();
            renderInventory();
        }

        function buyItem(category, type, price) {
            if (coins < price) {
                showNotification('ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!');
                return;
            }

            coins -= price;

            if (category === 'food') {
                if (!inventory.food) inventory.food = [];
                inventory.food.push(type);
                if (type === 'medicine') {
                    showNotification(`${MEDICINE.name}ì„(ë¥¼) ${price}ğŸ’°ì— êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤`);
                } else {
                    showNotification(`${FOOD_NAMES[type]}ì„(ë¥¼) ${price}ğŸ’°ì— êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤`);
                }
            } else if (category === 'music') {
                if (!inventory.music) inventory.music = [];
                inventory.music.push(type);
                showNotification(`${MUSIC_TYPES[type].name}ì„(ë¥¼) ${price}ğŸ’°ì— êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤`);
            } else if (category === 'decoration') {
                if (!inventory.decorations) inventory.decorations = [];
                inventory.decorations.push(type);
                showNotification(`${DECORATION_TYPES[type].name}ì„(ë¥¼) ${price}ğŸ’°ì— êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤`);
            }

            saveGame();
            renderShop();
            renderInventory();
        }


        // ì•¨ë²” ë°ì´í„°ë¡œë¶€í„° ë„ê° ì¬êµ¬ì„±
        function rebuildEncyclopediaFromAlbum() {
            console.log('ì•¨ë²”ì—ì„œ ë„ê° ì¬êµ¬ì„± ì‹œì‘...');
            console.log('ì•¨ë²” ë°ì´í„°:', collection);
            
            const newEncyclopedia = {};
            
            collection.forEach(spirit => {
                let encyclopediaKey;
                
                if (spirit.type === 'titania' || spirit.type === 'oberon') {
                    // ì „ì„¤ì  ì¡´ì¬ëŠ” ê³ ìœ  í‚¤ ì‚¬ìš©
                    encyclopediaKey = spirit.type;
                } else if (spirit.type === 'nostat') {
                    // ìˆ˜ì‹ì–´ ì—†ëŠ” ì •ë ¹
                    encyclopediaKey = `nostat-${spirit.attributeType}`;
                } else {
                    // ì¼ë°˜ ì •ë ¹ (ìŠ¤íƒ¯-ì†ì„±)
                    encyclopediaKey = `${spirit.type}-${spirit.attributeType}`;
                }
                
                if (!newEncyclopedia[encyclopediaKey]) {
                    newEncyclopedia[encyclopediaKey] = 0;
                }
                newEncyclopedia[encyclopediaKey]++;
            });
            
            console.log('ì¬êµ¬ì„±ëœ ë„ê°:', newEncyclopedia);
            encyclopedia = newEncyclopedia;
            saveGame();
            
            return Object.keys(newEncyclopedia).length;
        }


        async function manualRebuildEncyclopedia() {
            if (collection.length === 0) {
                showNotification('ì•¨ë²”ì— ë°ì´í„°ê°€ ì—†ì–´ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const confirmed = await showConfirm(
                'ë„ê° ë³µêµ¬',
                `ì•¨ë²”ì— ìˆëŠ” ${collection.length}ë§ˆë¦¬ì˜ ì •ë ¹ ë°ì´í„°ë¡œ ë„ê°ì„ ë‹¤ì‹œ êµ¬ì„±í•©ë‹ˆë‹¤.\n\nê¸°ì¡´ ë„ê° ë°ì´í„°ëŠ” ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
            );
            
            if (!confirmed) {
                return;
            }
            
            const recoveredCount = rebuildEncyclopediaFromAlbum();
            renderEncyclopedia();
            showNotification(`âœ… ë„ê°ì„ ë³µêµ¬í–ˆìŠµë‹ˆë‹¤! (${recoveredCount}ì¢…)`);
        }

        function renderEncyclopedia() {
            try {
                console.log('ë„ê° ë Œë”ë§ ì‹œì‘');
                console.log('í˜„ì¬ ë„ê°:', encyclopedia);
                console.log('í˜„ì¬ ì•¨ë²”:', collection);
                
                const grid = document.getElementById('encyclopediaGrid');
                if (!grid) {
                    console.error('encyclopediaGrid ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                
                // encyclopediaê°€ nullì´ê±°ë‚˜ undefinedì¸ ê²½ìš° ì´ˆê¸°í™”
                if (!encyclopedia || typeof encyclopedia !== 'object') {
                    console.warn('âš ï¸ ë„ê° ë°ì´í„°ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ - ì´ˆê¸°í™”');
                    encyclopedia = {};
                }
                
                // ë„ê°ì´ ë¹„ì–´ìˆëŠ”ë° ì•¨ë²”ì— ë°ì´í„°ê°€ ìˆìœ¼ë©´ ìë™ ë³µêµ¬
                if (Object.keys(encyclopedia).length === 0 && collection && collection.length > 0) {
                    console.log('âš ï¸ ë„ê°ì´ ë¹„ì–´ìˆì§€ë§Œ ì•¨ë²”ì— ë°ì´í„° ì¡´ì¬ - ìë™ ë³µêµ¬ ì‹œì‘');
                    try {
                        const recoveredCount = rebuildEncyclopediaFromAlbum();
                        showNotification(`ë„ê°ì„ ë³µêµ¬í–ˆìŠµë‹ˆë‹¤! (${recoveredCount}ì¢…)`);
                    } catch (rebuildError) {
                        console.error('ë„ê° ë³µêµ¬ ì‹¤íŒ¨:', rebuildError);
                    }
                }
            
            const statTypes = [
                { key: 'nostat', name: '(ìˆ˜ì‹ì–´ ì—†ìŒ)' },
                { key: 'intelligent', name: 'ì§€ì ì¸ ê³„ì—´' },
                { key: 'strong', name: 'ê°•í•œ ê³„ì—´' },
                { key: 'beautiful', name: 'ì•„ë¦„ë‹¤ìš´ ê³„ì—´' }
            ];
            
            // ì†ì„±ë³„ ê·¸ë£¹ ì •ì˜
            const attributeGroups = [
                {
                    title: 'âšª ìˆœìˆ˜',
                    attrs: ['normal']
                },
                {
                    title: 'ğŸ”¥ğŸ’§ğŸŒ¬ï¸ğŸŒ±âœ¨ğŸŒ™ ê¸°ë³¸ ì†ì„±',
                    attrs: ['fire', 'water', 'wind', 'earth', 'light', 'dark']
                },
                {
                    title: 'ğŸ”¥ í™”ì—¼ ì¡°í•©',
                    attrs: ['fire-water', 'fire-wind', 'fire-earth', 'fire-light', 'fire-dark']
                },
                {
                    title: 'ğŸ’§ ë¹™í•˜ ì¡°í•©',
                    attrs: ['water-wind', 'water-earth', 'water-light', 'water-dark']
                },
                {
                    title: 'ğŸŒ¬ï¸ ì§ˆí’ ì¡°í•©',
                    attrs: ['wind-earth', 'wind-light', 'wind-dark']
                },
                {
                    title: 'ğŸŒ± ëŒ€ì§€ ì¡°í•©',
                    attrs: ['earth-light', 'earth-dark']
                },
                {
                    title: 'âœ¨ğŸŒ™ í™˜í˜¹',
                    attrs: ['light-dark']
                },
                {
                    title: 'âš–ï¸ğŸŒªï¸ ë‹¤ì†ì„±',
                    attrs: ['balanced', 'multi']
                }
            ];
            
            let html = '';
            
            // ì „ì„¤ì  ì¡´ì¬ (í‹°íƒ€ë‹ˆì•„/ì˜¤ë² ë¡ ) - ë§¨ ìœ„ì— íŠ¹ë³„ í‘œì‹œ
            html += `<div style="grid-column: 1 / -1; margin-top: 10px; margin-bottom: 15px;">
                <h2 style="font-family: 'Nanum Myeongjo', serif; font-size: 1.5rem; color: var(--text); border-bottom: 3px solid gold; padding-bottom: 10px;">
                    ì „ì„¤ì  ì¡´ì¬
                </h2>
            </div>`;
            
            // í‹°íƒ€ë‹ˆì•„
            const titaniaCount = encyclopedia['titania'] || 0;
            const titaniaUnlocked = titaniaCount > 0;
            html += `
                <div class="${titaniaUnlocked ? 'encyclopedia-card unlocked' : 'encyclopedia-card locked'}" style="min-height: 120px; border: 2px solid gold;">
                    <div class="encyclopedia-icon" style="font-size: 3rem;">${titaniaUnlocked ? 'ğŸ¦‹âœ¨' : '?'}</div>
                    <div class="encyclopedia-name" style="font-size: 1rem; font-weight: 700;">${titaniaUnlocked ? 'í‹°íƒ€ë‹ˆì•„' : '???????'}</div>
                    <div class="encyclopedia-count" style="font-size: 0.8rem;">${titaniaUnlocked ? `${titaniaCount}íšŒ` : 'ë¯¸ë‹¬ì„±'}</div>
                    <div style="font-size: 0.7rem; color: ${titaniaUnlocked ? 'gold' : '#888'}; margin-top: 5px;">${titaniaUnlocked ? ENCYCLOPEDIA_HINTS['titania'] : 'ë‚˜ë¹„ë¥¼ ê±°ëŠë¦¬ëŠ” ì •ë ¹ë“¤ì˜ êµ°ì£¼.'}</div>
                </div>
            `;
            
            // ì˜¤ë² ë¡ 
            const oberonCount = encyclopedia['oberon'] || 0;
            const oberonUnlocked = oberonCount > 0;
            html += `
                <div class="${oberonUnlocked ? 'encyclopedia-card unlocked' : 'encyclopedia-card locked'}" style="min-height: 120px; border: 2px solid gold;">
                    <div class="encyclopedia-icon" style="font-size: 3rem;">${oberonUnlocked ? 'ğŸ¦‹ğŸŒ™' : '?'}</div>
                    <div class="encyclopedia-name" style="font-size: 1rem; font-weight: 700;">${oberonUnlocked ? 'ì˜¤ë² ë¡ ' : '???????'}</div>
                    <div class="encyclopedia-count" style="font-size: 0.8rem;">${oberonUnlocked ? `${oberonCount}íšŒ` : 'ë¯¸ë‹¬ì„±'}</div>
                    <div style="font-size: 0.7rem; color: ${oberonUnlocked ? 'gold' : '#888'}; margin-top: 5px;">${oberonUnlocked ? ENCYCLOPEDIA_HINTS['oberon'] : 'ë‚˜ë°©ì„ ê±°ëŠë¦¬ëŠ” ì •ë ¹ë“¤ì˜ êµ°ì£¼.'}</div>
                </div>
            `;
            
            attributeGroups.forEach(group => {
                // ê·¸ë£¹ í—¤ë”
                html += `<div style="grid-column: 1 / -1; margin-top: 30px; margin-bottom: 15px;">
                    <h2 style="font-family: 'Nanum Myeongjo', serif; font-size: 1.5rem; color: var(--text); border-bottom: 3px solid var(--fire); padding-bottom: 10px;">
                        ${group.title}
                    </h2>
                </div>`;
                
                group.attrs.forEach(attrType => {
                    const attributeData = ATTRIBUTE_NAMES[attrType];
                    if (!attributeData) return;
                    
                    // ì†ì„± ì•„ì´ì½˜ë§Œ í‘œì‹œ (ì´ë¦„ ìˆ¨ê¹€)
                    html += `<div style="grid-column: 1 / -1; margin-top: 20px; margin-bottom: 10px;">
                        <h3 style="font-family: 'Nanum Myeongjo', serif; font-size: 1.2rem; color: var(--text); display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 2rem;">${attributeData.icon}</span>
                        </h3>
                    </div>`;
                    
                    // ê°€ë¡œë¡œ ë‚˜ì—´ (ìˆ˜ì‹ì–´ ì—†ìŒ + 3ê°œ ìŠ¤íƒ¯ ê³„ì—´)
                    statTypes.forEach(statInfo => {
                        let count = 0;
                        let displayName = '???????';
                        let displayIcon = '?';
                        let isUnlocked = false;
                        let achievedLevel = 'mid'; // ê¸°ë³¸ê°’ ì„¤ì • (ëª¨ë“  ê²½ë¡œì—ì„œ ì‚¬ìš© ê°€ëŠ¥)
                        
                        if (statInfo.key === 'nostat') {
                            // ìˆ˜ì‹ì–´ ì—†ëŠ” ì •ë ¹
                            count = encyclopedia[`nostat-${attrType}`] || 0;
                            isUnlocked = count > 0;
                            displayName = isUnlocked ? '(ìˆ˜ì‹ì–´ ì—†ìŒ)' : '???????';
                            displayIcon = isUnlocked ? attributeData.icon : '?';
                        } else {
                            // ìŠ¤íƒ¯ ê³„ì—´ ì •ë ¹
                            const lowCount = encyclopedia[`${statInfo.key}-low-${attrType}`] || 0;
                            const midCount = encyclopedia[`${statInfo.key}-mid-${attrType}`] || 0;
                            const highCount = encyclopedia[`${statInfo.key}-high-${attrType}`] || 0;
                            count = lowCount + midCount + highCount;
                            isUnlocked = count > 0;
                            
                            // ë‹¬ì„±ëœ ë ˆë²¨ ì°¾ê¸° (ìš°ì„ ìˆœìœ„: high > mid > low)
                            if (highCount > 0) achievedLevel = 'high';
                            else if (midCount > 0) achievedLevel = 'mid';
                            else if (lowCount > 0) achievedLevel = 'low';
                            
                            if (isUnlocked) {
                                const statPrefix = EVOLUTION_TYPES[`${statInfo.key}-${achievedLevel}`].prefix;
                                const statIcon = EVOLUTION_TYPES[`${statInfo.key}-${achievedLevel}`].icon;
                                displayName = statPrefix;
                                displayIcon = `${statIcon}${attributeData.icon}`;
                            }
                        }
                        
                        const cardClass = isUnlocked ? 'encyclopedia-card unlocked' : 'encyclopedia-card locked';
                        const countText = isUnlocked ? `${count}íšŒ` : 'ë¯¸ë‹¬ì„±';
                        
                        // ì •ë ¹ ì „ì²´ ì´ë¦„ ìƒì„±
                        let fullName = '???????';
                        let hintKey = '';
                        
                        if (isUnlocked) {
                            if (statInfo.key === 'nostat') {
                                fullName = attributeData.name;
                                hintKey = `nostat-${attrType}`;
                            } else {
                                const statPrefix = EVOLUTION_TYPES[`${statInfo.key}-${achievedLevel}`].prefix;
                                fullName = `${statPrefix} ${attributeData.name}`;
                                hintKey = `${statInfo.key}-${achievedLevel}-${attrType}`;
                            }
                        }
                        
                        // ì ê¸ˆ ìƒíƒœì—ì„œë„ íŒíŠ¸ í‘œì‹œ
                        let hint = '';
                        if (isUnlocked) {
                            hint = ENCYCLOPEDIA_HINTS[hintKey] || '';
                        } else {
                            // ì ê¸ˆ ìƒíƒœì¼ ë•Œë„ íŒíŠ¸ í‘œì‹œ
                            if (statInfo.key === 'nostat') {
                                hint = ENCYCLOPEDIA_HINTS[`nostat-${attrType}`] || '???';
                            } else {
                                // ì„ì˜ì˜ ë ˆë²¨ë¡œ íŒíŠ¸ í‘œì‹œ (mid ìš°ì„ )
                                hint = ENCYCLOPEDIA_HINTS[`${statInfo.key}-mid-${attrType}`] || 
                                       ENCYCLOPEDIA_HINTS[`${statInfo.key}-low-${attrType}`] || '???';
                            }
                        }
                        
                        html += `
                            <div class="${cardClass}" style="min-height: 120px;">
                                <div class="encyclopedia-icon" style="font-size: 2.5rem;">${displayIcon}</div>
                                <div class="encyclopedia-name" style="font-size: 0.85rem; font-weight: 600;">${fullName}</div>
                                <div class="encyclopedia-count" style="font-size: 0.75rem; margin-top: 4px;">${countText}</div>
                                ${hint ? `<div style="font-size: 0.7rem; color: #888; margin-top: 6px; line-height: 1.3; padding: 0 8px; text-align: center;">${hint}</div>` : ''}
                            </div>
                        `;
                    });
                });
            });
            
            grid.innerHTML = html;
            } catch (error) {
                console.error('ë„ê° ë Œë”ë§ ì˜¤ë¥˜:', error);
                console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                console.error('í˜„ì¬ ë„ê° ë°ì´í„°:', encyclopedia);
                console.error('í˜„ì¬ ì•¨ë²” ë°ì´í„°:', collection);
                
                const grid = document.getElementById('encyclopediaGrid');
                if (grid) {
                    grid.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <div style="color: #f44336; font-size: 1.2rem; margin-bottom: 20px;">âš ï¸ ë„ê° ë Œë”ë§ ì˜¤ë¥˜</div>
                            <div style="color: #666; margin-bottom: 20px;">
                                ì˜¤ë¥˜: ${error.message}<br>
                                ë„ê° í•­ëª©: ${Object.keys(encyclopedia).length}ê°œ<br>
                                ì•¨ë²” í•­ëª©: ${collection.length}ê°œ
                            </div>
                            <button onclick="manualRebuildEncyclopedia()" style="padding: 12px 24px; background: var(--water); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; margin-right: 10px;">
                                ğŸ“š ì•¨ë²”ì—ì„œ ë„ê° ë³µêµ¬
                            </button>
                            <button onclick="renderEncyclopedia()" style="padding: 12px 24px; background: var(--fire); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;">
                                ğŸ”„ ë‹¤ì‹œ ì‹œë„
                            </button>
                        </div>
                    `;
                }
            }
        }

        function renderCollection() {
            try {
                console.log('ì•¨ë²” ë Œë”ë§ ì‹œì‘');
                const grid = document.getElementById('collectionGrid');
                if (!grid) {
                    console.error('collectionGrid ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
            
            if (collection.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“–</div>
                        <div>ì•„ì§ ë“±ë¡ëœ ì •ë ¹ì´ ì—†ìŠµë‹ˆë‹¤<br>ì •ë ¹ì„ ì„±ì¶©ê¹Œì§€ í‚¤ì›Œë³´ì„¸ìš”</div>
                    </div>
                `;
                return;
            }

            // ì—­ìˆœìœ¼ë¡œ í‘œì‹œ (ìµœê·¼ ê²ƒì´ ë§¨ ì•ì—)
            const reversedCollection = [...collection].reverse();
            
            grid.innerHTML = reversedCollection.map((item, reverseIndex) => {
                const index = collection.length - 1 - reverseIndex; // ì›ë³¸ ì¸ë±ìŠ¤
                // descëŠ” ë„ê° ì•„ì´í…œì— ì €ì¥ë˜ì–´ ìˆìŒ
                const desc = item.desc || '';
                const originalName = item.originalName || item.name || 'ì´ë¦„ ì—†ìŒ';
                
                // ë‚ ê°œ ì´ëª¨ì§€ ê²°ì •
                let wingEmoji = '';
                if (item.wingType === 'butterfly') {
                    wingEmoji = 'ğŸ¦‹';
                } else if (item.wingType === 'moth') {
                    wingEmoji = 'ğŸ¦‹'; // ë‚˜ë°©ë„ ë‚˜ë¹„ ì´ëª¨ì§€ ì‚¬ìš© (ì‹œê°ì ìœ¼ë¡œ êµ¬ë¶„)
                } else if (item.wingType === 'both') {
                    wingEmoji = 'ğŸ¦‹ğŸ¦‹';
                }
                
                return `
                    <div class="collection-card" onclick="showAlbumDetail(${index})" style="cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        <div class="collection-icon">${item.icon}${wingEmoji}</div>
                        <div class="collection-name">${item.name}</div>
                        <div style="font-size: 0.85rem; color: #666; margin-top: 4px;">ë³¸ëª…: ${originalName}</div>
                        ${item.wingType ? `<div style="font-size: 0.85rem; color: #888; margin-top: 4px;">${item.wingType === 'butterfly' ? 'ë‚˜ë¹„ì˜ ë‚ ê°œ' : item.wingType === 'moth' ? 'ë‚˜ë°©ì˜ ë‚ ê°œ' : 'ë‚˜ë¹„ì™€ ë‚˜ë°©ì˜ ë‚ ê°œ'}</div>` : ''}
                        ${desc ? `<div style="font-size: 0.85rem; color: #888; margin-top: 8px; line-height: 1.4;">${desc}</div>` : ''}
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 12px;">
                            <div class="param">ğŸ§  ${item.parameters.intelligence}</div>
                            <div class="param">ğŸ’ª ${item.parameters.strength}</div>
                            <div class="param">${item.parameters.charm}</div>
                            <div class="param">${item.parameters.affection || 0}</div>
                        </div>
                        <div style="font-size: 0.75rem; color: #999; margin-top: 12px; text-align: center;">ğŸ“Š í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ ë³´ê¸°</div>
                    </div>
                `;
            }).join('');
            } catch (error) {
                console.error('ì•¨ë²” ë Œë”ë§ ì˜¤ë¥˜:', error);
                console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                const grid = document.getElementById('collectionGrid');
                if (grid) {
                    grid.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <div style="color: #f44336; font-size: 1.2rem; margin-bottom: 20px;">âš ï¸ ì•¨ë²” ë Œë”ë§ ì˜¤ë¥˜</div>
                            <div style="color: #666;">ì˜¤ë¥˜: ${error.message}</div>
                        </div>
                    `;
                }
            }
        }

        function switchTab(tab) {
            try {
                console.log('íƒ­ ì „í™˜:', tab);
                currentTab = tab; // í˜„ì¬ íƒ­ ì €ì¥
                
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                
                if (tab === 'garden') {
                    document.querySelector('.tab:nth-child(1)').classList.add('active');
                    document.getElementById('gardenSection').classList.add('active');
                } else if (tab === 'terrarium') {
                    document.querySelector('.tab:nth-child(2)').classList.add('active');
                    document.getElementById('terrariumSection').classList.add('active');
                    renderTerrariumManagement();
                } else if (tab === 'shop') {
                    document.querySelector('.tab:nth-child(3)').classList.add('active');
                    document.getElementById('shopSection').classList.add('active');
                    renderShop();
                } else if (tab === 'minigame') {
                    document.querySelector('.tab:nth-child(4)').classList.add('active');
                    document.getElementById('minigameSection').classList.add('active');
                    // ë¯¸ë‹ˆê²Œì„ íƒ­ ì „í™˜ ì‹œ ê²Œì„ ì¤‘ì´ë©´ ì¼ì‹œì •ì§€
                    if (minigameActive) {
                        pauseMinigame();
                    }
                } else if (tab === 'encyclopedia') {
                    document.querySelector('.tab:nth-child(5)').classList.add('active');
                    document.getElementById('encyclopediaSection').classList.add('active');
                    renderEncyclopedia();
                } else if (tab === 'album') {
                    document.querySelector('.tab:nth-child(6)').classList.add('active');
                    document.getElementById('albumSection').classList.add('active');
                    renderCollection();
                } else if (tab === 'settings') {
                    document.querySelector('.tab:nth-child(7)').classList.add('active');
                    document.getElementById('settingsSection').classList.add('active');
                    updateSettingsInfo();
                }
            } catch (error) {
                console.error('íƒ­ ì „í™˜ ì˜¤ë¥˜:', error);
                console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                showNotification('íƒ­ ì „í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }


        // ì„¤ì • ì •ë³´ ì—…ë°ì´íŠ¸
        function updateSettingsInfo() {
            // ë‹¤í¬ëª¨ë“œ í† ê¸€ ìƒíƒœ ì—…ë°ì´íŠ¸
            const toggle = document.getElementById('darkModeToggle');
            const slider = document.getElementById('darkModeSlider');
            if (toggle) {
                toggle.checked = darkModeLocked;
                if (darkModeLocked) {
                    slider.style.transform = 'translateX(28px)';
                    slider.parentElement.style.backgroundColor = '#4CAF50';
                } else {
                    slider.style.transform = 'translateX(0)';
                    slider.parentElement.style.backgroundColor = '#ccc';
                }
            }
        }
        
        // ë‹¤í¬ ëª¨ë“œ ê³ ì • í† ê¸€
        function toggleDarkModeLock() {
            darkModeLocked = !darkModeLocked;
            
            const slider = document.getElementById('darkModeSlider');
            if (darkModeLocked) {
                slider.style.transform = 'translateX(28px)';
                slider.parentElement.style.backgroundColor = '#4CAF50';
                showNotification('ğŸŒ™ ë‹¤í¬ ëª¨ë“œê°€ ê³ ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
            } else {
                slider.style.transform = 'translateX(0)';
                slider.parentElement.style.backgroundColor = '#ccc';
                showNotification('ğŸŒ“ ì¡°ëª…ì— ë”°ë¼ í…Œë§ˆê°€ ë³€ê²½ë©ë‹ˆë‹¤');
            }
            
            applyLightMode();
            saveGame();
        }
        
        // ê²Œì„ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportGameData() {
            const gameData = {
                version: '2.1.0',
                exportDate: new Date().toISOString(),
                spirits: spirits,
                collection: collection,
                encyclopedia: encyclopedia,
                inventory: inventory,
                coins: coins,
                terrarium: terrarium,
                installedDecorations: installedDecorations,
                lightMode: lightMode,
                isPaused: isPaused,
                darkModeLocked: darkModeLocked
            };
            
            const dataStr = JSON.stringify(gameData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `spirit-garden-backup-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification('âœ… ê²Œì„ ë°ì´í„°ë¥¼ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤');
        }
        
        // ê²Œì„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function importGameData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const gameData = JSON.parse(text);
                    
                    // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
                    if (!gameData.spirits || !gameData.collection || !gameData.inventory) {
                        throw new Error('ì˜¬ë°”ë¥¸ ê²Œì„ ë°ì´í„° íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤');
                    }
                    
                    const confirmed = await showConfirm(
                        'ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°',
                        `ë°±ì—… íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\n\në°±ì—… ì¼ì‹œ: ${new Date(gameData.exportDate).toLocaleString()}\nì •ë ¹ ìˆ˜: ${gameData.spirits.length}\nì•¨ë²”: ${gameData.collection.length}\n\ní˜„ì¬ ë°ì´í„°ëŠ” ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.`
                    );
                    
                    if (!confirmed) return;
                    
                    // ë°ì´í„° ë³µì›
                    spirits = gameData.spirits || [];
                    collection = gameData.collection || [];
                    encyclopedia = gameData.encyclopedia || {};
                    inventory = gameData.inventory || { food: [], music: [], decorations: [], medicine: [] };
                    coins = gameData.coins || 0;
                    terrarium = gameData.terrarium || { fire: 0, water: 0, wind: 0, earth: 0, light: 0, dark: 0 };
                    installedDecorations = gameData.installedDecorations || [];
                    lightMode = gameData.lightMode !== undefined ? gameData.lightMode : true;
                    isPaused = gameData.isPaused || false;
                    darkModeLocked = gameData.darkModeLocked || false;
                    
                    saveGame();
                    
                    // UI ìƒˆë¡œê³ ì¹¨
                    renderSpirits();
                    renderInventory();
                    updateCoinDisplay();
                    applyLightMode();
                    updateSettingsInfo();
                    
                    showNotification('âœ… ê²Œì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤');
                    switchTab('garden');
                } catch (error) {
                    console.error('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', error);
                    showNotification('âŒ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message);
                }
            };
            
            input.click();
        }

        function recalculateTerrariumEnvironment() {
            // í™˜ê²½ ì´ˆê¸°í™”
            terrarium = {
                fire: 0,
                water: 0,
                wind: 0,
                earth: 0,
                light: 0,
                dark: 0
            };

            // ì„¤ì¹˜ëœ ëª¨ë“  ì¥ì‹ë¬¼ì„ ìˆœíšŒí•˜ë©° í™˜ê²½ ê³„ì‚°
            installedDecorations.forEach(deco => {
                // ë¬¸ìì—´ ë˜ëŠ” ê°ì²´ ëª¨ë‘ ì§€ì›
                const decoKey = typeof deco === 'string' ? deco : deco.type;
                const decoData = DECORATION_TYPES[decoKey];
                if (!decoData) return;
                
                const attr = decoData.attr;
                const power = decoData.power;
                
                // í•´ë‹¹ ì†ì„± ì¦ê°€ (ìµœëŒ€ 50ê¹Œì§€)
                terrarium[attr] = Math.min(50, terrarium[attr] + power);

                // ëŒ€ë¦½ ì†ì„± ê°ì†Œ (powerë§Œí¼)
                const opposites = {
                    fire: 'water',
                    water: 'fire',
                    wind: 'earth',
                    earth: 'wind',
                    light: 'dark',
                    dark: 'light'
                };
                const opposite = opposites[attr];
                if (opposite) {
                    terrarium[opposite] = Math.max(0, terrarium[opposite] - power);
                }
            });

            // ì¡°ëª… íš¨ê³¼ ì ìš©
            if (lightMode) {
                terrarium.light = Math.min(50, terrarium.light + 3);
                terrarium.dark = Math.max(0, terrarium.dark - 2);
            } else {
                terrarium.dark = Math.min(50, terrarium.dark + 3);
                terrarium.light = Math.max(0, terrarium.light - 2);
            }
        }

        function toggleLight() {
            const now = Date.now();
            
            // í˜„ì¬ ì¡°ëª… ë³€ê²½ ê¸°ë¡
            lightToggleHistory.push(now);
            
            // 1ë¶„(60ì´ˆ) ì´ì „ ê¸°ë¡ ì œê±°
            lightToggleHistory = lightToggleHistory.filter(time => (now - time) < 60000);
            
            // 1ë¶„ ì´ë‚´ 5íšŒ ì´ìƒ ë³€ê²½ ì²´í¬
            const isSpamming = lightToggleHistory.length >= 5;
            
            lightMode = !lightMode;
            
            // ì •ë ¹ë“¤ ë°˜ì‘
            spirits.forEach(spirit => {
                if (!spirit.isDead && !spirit.isCompleted) {
                    if (isSpamming) {
                        // ì¡°ëª… ë‚¨ìš© ì‹œ í™”ë‚´ê±°ë‚˜ ì¶¤ì¶”ê¸°
                        const spamMessages = [
                            `${spirit.name}ì´(ê°€) ë‹¹ì‹ ì˜ ì¥ë‚œì— í™”ë¥¼ ëƒ…ë‹ˆë‹¤.`,
                            `${spirit.name}ì´(ê°€) ê²©í•œ ì¶¤ì„ ì¶¥ë‹ˆë‹¤.`,
                            `${spirit.name}ì´(ê°€) ì¡°ëª… ì¥ë‚œì— ì§œì¦ì„ ëƒ…ë‹ˆë‹¤.`,
                            `${spirit.name}ì´(ê°€) ì–´ì§€ëŸ¬ì›Œí•©ë‹ˆë‹¤!`
                        ];
                        spirit.status = spamMessages[Math.floor(Math.random() * spamMessages.length)];
                        
                        // ì¼ì§€ ì¶”ê°€
                        addLog(spirit, spirit.status);
                        
                        // ì• ì •ë„ -1
                        spirit.parameters.affection = Math.max(0, spirit.parameters.affection - 1);
                    } else {
                        // ì •ìƒì ì¸ ì¡°ëª… ì „í™˜ ë°˜ì‘
                        if (lightMode) {
                            // ì¡°ëª… ì¼œì§
                            spirit.status = `${spirit.name}ì´(ê°€) ê°‘ìê¸° ì£¼ë³€ì´ í™˜í•´ì ¸ ê¹œì§ ë†€ëë‹ˆë‹¤.`;
                        } else {
                            // ì¡°ëª… êº¼ì§
                            spirit.status = `${spirit.name}ì´(ê°€) ê°‘ìê¸° ì£¼ë³€ì´ ì–´ë‘ì›Œì ¸ ê¹œì§ ë†€ëë‹ˆë‹¤.`;
                        }
                        
                        // ì¼ì§€ ì¶”ê°€
                        addLog(spirit, spirit.status);
                    }
                }
            });
            
            applyLightMode();
            recalculateTerrariumEnvironment();
            saveGame();
            updateAllSpiritCards();
            if (document.getElementById('terrariumSection').classList.contains('active')) {
                renderTerrariumManagement();
            }
            
            if (isSpamming) {
                showNotification(lightMode ? 'â˜€ï¸ ì¡°ëª…ì„ ì¼°ìŠµë‹ˆë‹¤ (ì •ë ¹ì´ í™”ë¥¼ ëƒ…ë‹ˆë‹¤!)' : 'ğŸŒ™ ì¡°ëª…ì„ ê»ìŠµë‹ˆë‹¤ (ì •ë ¹ì´ í™”ë¥¼ ëƒ…ë‹ˆë‹¤!)');
            } else {
                showNotification(lightMode ? 'â˜€ï¸ ì¡°ëª…ì„ ì¼°ìŠµë‹ˆë‹¤' : 'ğŸŒ™ ì¡°ëª…ì„ ê»ìŠµë‹ˆë‹¤');
            }
        }

        function applyLightMode() {
            const icon = document.getElementById('lightIcon');
            
            // ë‹¤í¬ ëª¨ë“œ ê³ ì •ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ì¡°ëª… ìƒíƒœ ë¬´ì‹œ
            if (darkModeLocked) {
                document.body.classList.add('dark-mode');
                if (icon) icon.textContent = 'ğŸŒ™';
                return;
            }
            
            if (lightMode) {
                document.body.classList.remove('dark-mode');
                if (icon) icon.textContent = 'â˜€ï¸';
            } else {
                document.body.classList.add('dark-mode');
                if (icon) icon.textContent = 'ğŸŒ™';
            }
        }
        
        // ì¼ì‹œì •ì§€ í† ê¸€
        function togglePause() {
            isPaused = !isPaused;
            const pauseBtn = document.getElementById('pauseBtn');
            
            if (isPaused) {
                pausedAt = Date.now(); // ì¼ì‹œì •ì§€ ì‹œì‘ ì‹œê°„ ê¸°ë¡
                pauseBtn.textContent = 'â–¶ï¸';
                pauseBtn.classList.add('paused');
                pauseBtn.title = 'ì¬ê°œ';
                showNotification('â¸ï¸ ê²Œì„ì´ ì¼ì‹œì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤');
            } else {
                if (pausedAt) {
                    // ì¼ì‹œì •ì§€í–ˆë˜ ì‹œê°„ì„ ëˆ„ì 
                    totalPausedTime += (Date.now() - pausedAt);
                    pausedAt = null;
                }
                pauseBtn.textContent = 'â¸ï¸';
                pauseBtn.classList.remove('paused');
                pauseBtn.title = 'ì¼ì‹œì •ì§€';
                showNotification('â–¶ï¸ ê²Œì„ì´ ì¬ê°œë˜ì—ˆìŠµë‹ˆë‹¤');
            }
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateGatherButton();
            updateAllSpiritCards();
            
            saveGame();
        }
        
        // ê²Œì„ ë¦¬ì…‹
        async function resetGame() {
            const confirm1 = await showConfirm(
                'ê²Œì„ ì´ˆê¸°í™”',
                'ì •ë§ë¡œ ê²Œì„ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nëª¨ë“  ì •ë ¹, ì¥ì‹ë¬¼, ë¨¹ì´, ìŒì•…, ì½”ì¸, ë„ê°ì´ ì‚­ì œë©ë‹ˆë‹¤.\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!'
            );
            
            if (!confirm1) {
                return;
            }
            
            const confirm2 = await showConfirm(
                'ìµœì¢… í™•ì¸',
                'ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸í•©ë‹ˆë‹¤.\nì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'
            );
            
            if (!confirm2) {
                return;
            }
            
            // ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
            spirits = [];
            collection = [];
            encyclopedia = {};
            inventory = {
                music: [],
                decorations: [],
                food: ['fire', 'fire', 'fire', 'water', 'water', 'water', 'wind', 'wind', 'wind', 'earth', 'earth', 'earth']
            };
            terrarium = {
                fire: 0,
                water: 0,
                wind: 0,
                earth: 0,
                light: 0,
                dark: 0
            };
            installedDecorations = [];
            lightMode = true;
            coins = 0;
            currentTitle = 'none';
            lastGatherTime = null;
            isPaused = false;
            pausedAt = null;
            totalPausedTime = 0;
            
            // localStorage ì‚­ì œ
            localStorage.removeItem('spiritGardenV2');
            
            // UI ì—…ë°ì´íŠ¸
            renderSpirits();
            renderInventory();
            updateCoinDisplay();
            applyLightMode();
            renderEncyclopedia();
            renderAlbum();
            
            const titleSelect = document.getElementById('titleSelect');
            if (titleSelect) {
                titleSelect.value = 'none';
            }
            
            const pauseBtn = document.getElementById('pauseBtn');
            if (pauseBtn) {
                pauseBtn.textContent = 'â¸ï¸';
                pauseBtn.classList.remove('paused');
            }
            
            showNotification('ğŸ”„ ê²Œì„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function renderTerrariumManagement() {
            // í™˜ê²½ ë°” ì—…ë°ì´íŠ¸ (ìµœëŒ€ 50)
            Object.entries(terrarium).forEach(([attr, value]) => {
                const bar = document.getElementById(`terr${attr.charAt(0).toUpperCase() + attr.slice(1)}Bar`);
                const valueSpan = document.getElementById(`terr${attr.charAt(0).toUpperCase() + attr.slice(1)}Value`);
                if (bar) bar.style.width = `${(value / 50) * 100}%`;
                if (valueSpan) valueSpan.textContent = value;
            });
            
            // ì „ì²´ í’ˆì§ˆ ì—…ë°ì´íŠ¸
            const qualityEl = document.getElementById('terrariumQuality');
            if (qualityEl) {
                const avgQuality = calculateTerrariumQuality();
                qualityEl.textContent = avgQuality.toFixed(1);
                
                // í’ˆì§ˆì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                if (avgQuality > 4) {
                    qualityEl.style.color = '#4caf50'; // ì´ˆë¡ (ë†’ìŒ)
                } else if (avgQuality > 3) {
                    qualityEl.style.color = '#ff9800'; // ì£¼í™© (ë³´í†µ)
                } else {
                    qualityEl.style.color = '#f44336'; // ë¹¨ê°• (ë‚®ìŒ)
                }
            }

            // ì„¤ì¹˜ëœ ì¥ì‹ë¬¼ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            const installedCountEl = document.getElementById('installedCount');
            if (installedCountEl) {
                installedCountEl.textContent = `${installedDecorations.length} / 20`;
            }

            // ì„¤ì¹˜ëœ ì¥ì‹ë¬¼ ëª©ë¡
            const installedContainer = document.getElementById('installedDecorList');
            if (installedDecorations.length === 0) {
                installedContainer.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">ì„¤ì¹˜ëœ ì¥ì‹ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤</p>';
            } else {
                const installedCounts = {};
                installedDecorations.forEach(d => {
                    // ë¬¸ìì—´ ë˜ëŠ” ê°ì²´ ëª¨ë‘ ì§€ì›
                    const decoType = typeof d === 'string' ? d : d.type;
                    installedCounts[decoType] = (installedCounts[decoType] || 0) + 1;
                });

                // ì†ì„±ë³„, ì´ë¦„ë³„ë¡œ ì •ë ¬ (ìˆœì„œ ê³ ì •)
                const sortedEntries = Object.entries(installedCounts).sort((a, b) => {
                    const dataA = DECORATION_TYPES[a[0]];
                    const dataB = DECORATION_TYPES[b[0]];
                    if (!dataA || !dataB) return 0;
                    
                    // 1. ì†ì„±ë³„ ì •ë ¬
                    const attrOrder = { fire: 0, water: 1, wind: 2, earth: 3, light: 4, dark: 5 };
                    const attrDiff = (attrOrder[dataA.attr] || 0) - (attrOrder[dataB.attr] || 0);
                    if (attrDiff !== 0) return attrDiff;
                    
                    // 2. í’ˆì§ˆë³„ ì •ë ¬ (ë†’ì€ ìˆœ)
                    const qualityOrder = { epic: 0, rare: 1, common: 2 };
                    const qualityDiff = (qualityOrder[dataA.quality] || 2) - (qualityOrder[dataB.quality] || 2);
                    if (qualityDiff !== 0) return qualityDiff;
                    
                    // 3. ì´ë¦„ë³„ ì •ë ¬
                    return dataA.name.localeCompare(dataB.name);
                });
                
                installedContainer.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        ${sortedEntries.map(([key, count]) => {
                            const decoData = DECORATION_TYPES[key];
                            if (!decoData) return '';
                            
                            const qualityLabel = decoData.quality === 'epic' ? 'â­' : decoData.quality === 'rare' ? 'ğŸ’' : '';
                            return `
                                <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 4px;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style="font-size: 1.3rem;">${qualityLabel}${decoData.icon}</span>
                                        <div>
                                            <div style="font-weight: 700; font-size: 0.9rem;">${decoData.name} Ã—${count}</div>
                                            <div style="font-size: 0.75rem; color: #888;">${decoData.attr} +${decoData.power}</div>
                                        </div>
                                    </div>
                                    <button onclick="removeDecorationFromTerrarium('${key}')" style="padding: 6px 10px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                        íšŒìˆ˜
                                    </button>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }

            // ì¸ë²¤í† ë¦¬ ì¥ì‹ë¬¼ ëª©ë¡
            const listContainer = document.getElementById('terrariumDecorList');
            if (!inventory.decorations) inventory.decorations = [];
            
            if (inventory.decorations.length === 0) {
                listContainer.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">ë³´ìœ í•œ ì¥ì‹ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }

            const decorCounts = {};
            inventory.decorations.forEach(d => {
                decorCounts[d] = (decorCounts[d] || 0) + 1;
            });

            const canInstall = installedDecorations.length < 20;

            // ì†ì„±ë³„, í’ˆì§ˆë³„, ì´ë¦„ë³„ë¡œ ì •ë ¬ (ìˆœì„œ ê³ ì •)
            const sortedDecorEntries = Object.entries(decorCounts).sort((a, b) => {
                const dataA = DECORATION_TYPES[a[0]];
                const dataB = DECORATION_TYPES[b[0]];
                if (!dataA || !dataB) return 0;
                
                // 1. ì†ì„±ë³„ ì •ë ¬
                const attrOrder = { fire: 0, water: 1, wind: 2, earth: 3, light: 4, dark: 5 };
                const attrDiff = (attrOrder[dataA.attr] || 0) - (attrOrder[dataB.attr] || 0);
                if (attrDiff !== 0) return attrDiff;
                
                // 2. í’ˆì§ˆë³„ ì •ë ¬ (ë†’ì€ ìˆœ)
                const qualityOrder = { epic: 0, rare: 1, common: 2 };
                const qualityDiff = (qualityOrder[dataA.quality] || 2) - (qualityOrder[dataB.quality] || 2);
                if (qualityDiff !== 0) return qualityDiff;
                
                // 3. ì´ë¦„ë³„ ì •ë ¬
                return dataA.name.localeCompare(dataB.name);
            });

            listContainer.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    ${sortedDecorEntries.map(([key, count]) => {
                        const decoData = DECORATION_TYPES[key];
                        if (!decoData) return '';
                        
                        const qualityLabel = decoData.quality === 'epic' ? 'â­' : decoData.quality === 'rare' ? 'ğŸ’' : '';
                        return `
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 4px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 1.3rem;">${qualityLabel}${decoData.icon}</span>
                                    <div>
                                        <div style="font-weight: 700; font-size: 0.9rem;">${decoData.name} Ã—${count}</div>
                                        <div style="font-size: 0.75rem; color: #888;">${decoData.attr} +${decoData.power}</div>
                                    </div>
                                </div>
                                <button onclick="placeDecorationInTerrarium('${key}')" style="padding: 6px 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;" ${!canInstall ? 'disabled' : ''}>
                                    ${canInstall ? 'ì„¤ì¹˜' : 'ê°€ë“'}
                                </button>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function placeDecorationInTerrarium(decorationType) {
            if (!inventory.decorations) inventory.decorations = [];
            
            // ìµœëŒ€ 20ê°œ ì²´í¬
            if (installedDecorations.length >= 20) {
                showNotification('í…Œë¼ë¦¬ì›€ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤ (ìµœëŒ€ 20ê°œ)');
                return;
            }

            const invIndex = inventory.decorations.indexOf(decorationType);
            if (invIndex === -1) return;

            const decoData = DECORATION_TYPES[decorationType];

            // ê°™ì€ íƒ€ì…ì˜ ì¥ì‹ë¬¼ì´ ìˆëŠ”ì§€ í™•ì¸ (ìœ„ì¹˜ ê³ ì •ì„ ìœ„í•´)
            const existingIndices = installedDecorations
                .map((d, i) => ({ type: typeof d === 'string' ? d : d.type, index: i }))
                .filter(d => d.type === decorationType)
                .map(d => d.index);
            
            let targetIndex = installedDecorations.length; // ê¸°ë³¸ê°’: ë§¨ ë’¤
            
            if (existingIndices.length > 0) {
                // ê°™ì€ íƒ€ì…ì´ ìˆìœ¼ë©´ ê·¸ ë‹¤ìŒ ìœ„ì¹˜ì— ë°°ì¹˜
                targetIndex = Math.max(...existingIndices) + 1;
            }

            // ì¸ë²¤í† ë¦¬ì—ì„œ ì œê±°
            inventory.decorations.splice(invIndex, 1);
            
            // ì„¤ì¹˜ ëª©ë¡ì— ì¶”ê°€ (ìœ„ì¹˜ ì •ë³´ í¬í•¨)
            installedDecorations.splice(targetIndex, 0, { type: decorationType, index: targetIndex });
            
            // ì¸ë±ìŠ¤ ì¬ì •ë ¬
            installedDecorations.forEach((d, i) => {
                if (typeof d === 'object') {
                    d.index = i;
                }
            });

            // í™˜ê²½ ì¬ê³„ì‚°
            recalculateTerrariumEnvironment();

            // ë§Œì¡±ë„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            spirits.forEach(spirit => {
                if (!spirit.isDead && !spirit.isCompleted) {
                    spirit.satisfaction = calculateSatisfaction(spirit);
                }
            });
            
            saveGame();
            renderTerrariumManagement();
            renderInventory();
            renderSpirits();  // ë§Œì¡±ë„ ë³€ê²½ ë°˜ì˜
            showNotification(`${decoData.icon} ${decoData.name} ì„¤ì¹˜ ì™„ë£Œ`);
        }

        function removeDecorationFromTerrarium(decorationType) {
            // ë¬¸ìì—´ ë˜ëŠ” ê°ì²´ ëª¨ë‘ ì§€ì›
            const index = installedDecorations.findIndex(d => 
                (typeof d === 'string' ? d : d.type) === decorationType
            );
            if (index === -1) return;

            const decoData = DECORATION_TYPES[decorationType];

            // ì„¤ì¹˜ ëª©ë¡ì—ì„œ ì œê±°í•˜ê³  ì¸ë²¤í† ë¦¬ì— ì¶”ê°€
            installedDecorations.splice(index, 1);
            
            // ì¸ë±ìŠ¤ ì¬ì •ë ¬
            installedDecorations.forEach((d, i) => {
                if (typeof d === 'object') {
                    d.index = i;
                }
            });
            
            if (!inventory.decorations) inventory.decorations = [];
            inventory.decorations.push(decorationType);

            // í™˜ê²½ ì¬ê³„ì‚°
            recalculateTerrariumEnvironment();
            
            // ì •ë ¹ë“¤ì´ ì‚¬ë¼ì§„ ì¥ì‹ì„ ì°¾ëŠ” ë©”ì‹œì§€ (3ë¶„ ì´ë‚´ ëœë¤)
            spirits.forEach(spirit => {
                if (!spirit.isDead && !spirit.isCompleted) {
                    const searchMessages = [
                        `${spirit.name}ì´(ê°€) ${decoData.name}ì´(ê°€) ì–´ë””ê°”ëŠ”ì§€ ì°¾ìŠµë‹ˆë‹¤.`,
                        `${spirit.name}ì´(ê°€) ${decoData.name}ì„(ë¥¼) ë‘ë¦¬ë²ˆê±°ë¦¬ë©° ì°¾ìŠµë‹ˆë‹¤.`,
                        `${spirit.name}ì´(ê°€) ì‚¬ë¼ì§„ ${decoData.name}ì„(ë¥¼) ì°¾ì•„ í—¤ë§µë‹ˆë‹¤.`,
                        `${spirit.name}ì´(ê°€) ${decoData.name}ì´(ê°€) ì—†ì–´ì ¸ì„œ ìŠ¬í¼í•©ë‹ˆë‹¤.`,
                        `${spirit.name}ì´(ê°€) ${decoData.name}ì´(ê°€) ê·¸ë¦¬ì›Œ ë³´ì…ë‹ˆë‹¤.`
                    ];
                    const randomMessage = searchMessages[Math.floor(Math.random() * searchMessages.length)];
                    
                    // 0~180ì´ˆ(3ë¶„) ì‚¬ì´ ëœë¤ íƒ€ì´ë°
                    const randomDelay = Math.random() * 180000; // 0 ~ 180000ms (0 ~ 3ë¶„)
                    
                    console.log(`${spirit.name}: ${randomDelay/1000}ì´ˆ í›„ì— "${randomMessage}" í‘œì‹œ ì˜ˆì •`);
                    
                    setTimeout(() => {
                        // íƒ€ì„ì•„ì›ƒ ì‹¤í–‰ ì‹œì ì—ë„ ì •ë ¹ì´ ì‚´ì•„ìˆê³  ì™„ì„±ë˜ì§€ ì•Šì•˜ëŠ”ì§€ ì¬í™•ì¸
                        const currentSpirit = spirits.find(s => s.id === spirit.id);
                        if (currentSpirit && !currentSpirit.isDead && !currentSpirit.isCompleted) {
                            console.log(`${currentSpirit.name}: ì¥ì‹ë¬¼ ë°˜ì‘ í‘œì‹œ - "${randomMessage}"`);
                            currentSpirit.status = randomMessage;
                            
                            // ì¼ì§€ ì¶”ê°€
                            addLog(currentSpirit, randomMessage);
                            
                            updateSpiritCard(currentSpirit);
                        }
                    }, randomDelay);
                }
            });

            // ë§Œì¡±ë„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            spirits.forEach(spirit => {
                if (!spirit.isDead && !spirit.isCompleted) {
                    spirit.satisfaction = calculateSatisfaction(spirit);
                }
            });
            
            saveGame();
            renderTerrariumManagement();
            renderInventory();
            renderSpirits();  // ë§Œì¡±ë„ ë³€ê²½ ë°˜ì˜
            showNotification(`${decoData.icon} ${decoData.name} íšŒìˆ˜ ì™„ë£Œ`);
        }

        // ëœë¤ ë©”ì‹œì§€ ìƒì„±
        function getRandomMessage(spirit) {
            if (spirit.isDead || spirit.isCompleted) return spirit.status;
            
            const affection = spirit.parameters.affection || 0;
            const now = Date.now();
            const timeSinceLastFed = spirit.lastFed ? (now - spirit.lastFed) / 1000 : Infinity;
            const timeSinceLastMusic = spirit.lastMusic ? (now - spirit.lastMusic) / 1000 : Infinity;
            
            let availableMessages = [];
            
            // ë°°ê³ í”” (5ë¶„=300ì´ˆ ì´ìƒ ì•ˆ ë¨¹ì„) - 70% í™•ë¥ ë¡œ ë°°ê³ í”” ë©”ì‹œì§€
            if (timeSinceLastFed > 300 && Math.random() < 0.7) {
                availableMessages = [...RANDOM_MESSAGES.hungry];
            }
            // ë°°ê³ í””ì´ ì•„ë‹ˆê±°ë‚˜, ë°°ê³ í””ì´ì§€ë§Œ 30% í™•ë¥ ë¡œ ë‹¤ë¥¸ ë©”ì‹œì§€
            else {
                // ìµœê·¼ì— ìŒì•… ë“¤ìŒ (5ë¶„=300ì´ˆ ì´ë‚´, 30% í™•ë¥ )
                if (timeSinceLastMusic < 300 && spirit.lastMusicType && Math.random() < 0.3) {
                    const musicName = MUSIC_TYPES[spirit.lastMusicType].name;
                    availableMessages = RANDOM_MESSAGES.music.map(msg => 
                        msg.replace('{music}', musicName)
                    );
                }
                // ì¥ì‹ë¬¼ ì„¤ì¹˜ë¨ (30% í™•ë¥ )
                else if (installedDecorations.length > 0 && Math.random() < 0.3) {
                    const randomDeco = installedDecorations[Math.floor(Math.random() * installedDecorations.length)];
                    const decoType = typeof randomDeco === 'string' ? randomDeco : randomDeco.type;
                    if (RANDOM_MESSAGES.decorations[decoType]) {
                        availableMessages = [...RANDOM_MESSAGES.decorations[decoType]];
                    }
                }
                // í…Œë¼ë¦¬ì›€ì´ í…… ë¹„ì–´ìˆìŒ (30% í™•ë¥ )
                else if (installedDecorations.length === 0 && Math.random() < 0.3) {
                    availableMessages = [
                        `${spirit.name}ì´(ê°€) í…… ë¹ˆ í…Œë¼ë¦¬ì›€ ì•ˆì„ ë¹™ê¸€ë¹™ê¸€ ëŒì•„ë‹¤ë‹™ë‹ˆë‹¤.`,
                        `${spirit.name}ì´(ê°€) ì‹¬ì‹¬í•´ ë³´ì…ë‹ˆë‹¤.`,
                        `${spirit.name}ì´(ê°€) ì•„ë¬´ê²ƒë„ ì—†ëŠ” ê³µê°„ì„ ë‘ë¦¬ë²ˆê±°ë¦½ë‹ˆë‹¤.`,
                        `${spirit.name}ì´(ê°€) ë¬´ë£Œí•´ ë³´ì…ë‹ˆë‹¤.`
                    ];
                }
                // ì  (ì¡°ëª…ì— ë”°ë¼, 15% í™•ë¥ )
                else if (Math.random() < 0.15) {
                    if (lightMode) {
                        availableMessages = [...RANDOM_MESSAGES.napLight];
                    } else {
                        availableMessages = [...RANDOM_MESSAGES.sleepDark];
                    }
                }
            }
            
            // ìœ„ ì¡°ê±´ì— í•´ë‹¹ ì•ˆ ë˜ë©´ ì• ì •ë„ë³„ ë©”ì‹œì§€
            if (availableMessages.length === 0) {
                if (affection >= 100) {
                    availableMessages = [...RANDOM_MESSAGES.affectionVeryHigh, ...RANDOM_MESSAGES.basic];
                } else if (affection >= 50) {
                    availableMessages = [...RANDOM_MESSAGES.affectionHigh, ...RANDOM_MESSAGES.basic];
                } else if (affection >= 30) {
                    availableMessages = [...RANDOM_MESSAGES.affectionMedium, ...RANDOM_MESSAGES.basic];
                } else if (affection >= 10) {
                    availableMessages = [...RANDOM_MESSAGES.affectionLow, ...RANDOM_MESSAGES.basic];
                } else {
                    availableMessages = [...RANDOM_MESSAGES.affectionVeryLow, ...RANDOM_MESSAGES.basic];
                }
            }
            
            // ëœë¤ ì„ íƒ
            const randomMessage = availableMessages[Math.floor(Math.random() * availableMessages.length)];
            return randomMessage.replace('{name}', spirit.name);
        }
        
        // 30ì´ˆë§ˆë‹¤ ëœë¤ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        // 30ì´ˆë§ˆë‹¤ ëœë¤ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        // ì •ë ¹ ê°„ ìƒí˜¸ì‘ìš©
        function triggerSpiritInteraction() {
            console.log('[ìƒí˜¸ì‘ìš©] ì²´í¬ ì‹œì‘');
            
            if (isPaused) {
                console.log('[ìƒí˜¸ì‘ìš©] ì¼ì‹œì •ì§€ ì¤‘');
                return false;
            }
            
            // ì‚´ì•„ìˆê³  ì™„ì„±ë˜ì§€ ì•Šì€ ì •ë ¹ë§Œ
            const activeSpirits = spirits.filter(s => !s.isDead && !s.isCompleted);
            console.log('[ìƒí˜¸ì‘ìš©] í™œì„± ì •ë ¹ ìˆ˜:', activeSpirits.length, activeSpirits.map(s => s.name));
            
            // 2ë§ˆë¦¬ ì´ìƒì¼ ë•Œë§Œ ìƒí˜¸ì‘ìš©
            if (activeSpirits.length < 2) {
                console.log('[ìƒí˜¸ì‘ìš©] ì •ë ¹ ë¶€ì¡± (2ë§ˆë¦¬ ì´ìƒ í•„ìš”)');
                return false;
            }
            
            // 50% í™•ë¥ ë¡œ ìƒí˜¸ì‘ìš© ë°œìƒ (í…ŒìŠ¤íŠ¸ìš© ë†’ì€ í™•ë¥ !)
            const randomValue = Math.random();
            console.log('[ìƒí˜¸ì‘ìš©] í™•ë¥  ì²´í¬:', randomValue, '/ 0.5');
            if (randomValue > 0.5) {
                console.log('[ìƒí˜¸ì‘ìš©] í™•ë¥  ì‹¤íŒ¨');
                return false;
            }
            
            console.log('[ìƒí˜¸ì‘ìš©] í™•ë¥  ì„±ê³µ! ìƒí˜¸ì‘ìš© ì§„í–‰');
            
            // ëœë¤í•˜ê²Œ 2ë§ˆë¦¬ ì„ íƒ
            const spirit1 = activeSpirits[Math.floor(Math.random() * activeSpirits.length)];
            let spirit2;
            do {
                spirit2 = activeSpirits[Math.floor(Math.random() * activeSpirits.length)];
            } while (spirit2.id === spirit1.id);
            
            // ìƒí˜¸ì‘ìš© ì¢…ë¥˜ ê²°ì •
            const interactionTypes = ['decoration', 'sharing', 'fight', 'rest', 'song', 'play', 'talk'];
            const weights = [20, 10, 5, 15, 10, 25, 15]; // ê°€ì¤‘ì¹˜ (%)
            
            let random = Math.random() * 100;
            let selectedType = 'play'; // ê¸°ë³¸ê°’
            let cumulative = 0;
            
            for (let i = 0; i < interactionTypes.length; i++) {
                cumulative += weights[i];
                if (random < cumulative) {
                    selectedType = interactionTypes[i];
                    break;
                }
            }
            
            console.log('[ìƒí˜¸ì‘ìš©] ì„ íƒëœ íƒ€ì…:', selectedType, '(ëœë¤ ê°’:', random, ')');
            
            // ë©”ì‹œì§€ ì„ íƒ ë° ì ìš©
            const messages = RANDOM_MESSAGES.interaction[selectedType];
            console.log('[ìƒí˜¸ì‘ìš©] ë©”ì‹œì§€ í›„ë³´ ìˆ˜:', messages.length);
            
            let message = messages[Math.floor(Math.random() * messages.length)];
            console.log('[ìƒí˜¸ì‘ìš©] ì„ íƒëœ ë©”ì‹œì§€ í…œí”Œë¦¿:', message);
            
            message = message
                .replace('{name1}', spirit1.name)
                .replace('{name2}', spirit2.name);
            
            console.log('[ìƒí˜¸ì‘ìš©] ìµœì¢… ë©”ì‹œì§€:', message);
            
            // ì¥ì‹ë¬¼ ìƒí˜¸ì‘ìš©ì¼ ê²½ìš° ì¥ì‹ë¬¼ ì´ë¦„ ì¶”ê°€
            if (selectedType === 'decoration') {
                console.log('[ìƒí˜¸ì‘ìš©] ì¥ì‹ë¬¼ ê°œìˆ˜:', installedDecorations.length);
                if (installedDecorations.length > 0) {
                    const randomDeco = installedDecorations[Math.floor(Math.random() * installedDecorations.length)];
                    const decoType = typeof randomDeco === 'string' ? randomDeco : randomDeco.type;
                    console.log('[ìƒí˜¸ì‘ìš©] ì„ íƒëœ ì¥ì‹ë¬¼:', decoType);
                    const decoData = DECORATION_TYPES[decoType];
                    if (decoData) {
                        message = message.replace('{deco}', decoData.name);
                        console.log('[ìƒí˜¸ì‘ç”¨] ì¥ì‹ë¬¼ ì´ë¦„ ì ìš©:', decoData.name);
                    } else {
                        console.log('[ìƒí˜¸ì‘ìš©] ì¥ì‹ë¬¼ ë°ì´í„° ì—†ìŒ, ì·¨ì†Œ');
                        return false; // ì¥ì‹ë¬¼ ë°ì´í„° ì—†ìœ¼ë©´ ì·¨ì†Œ
                    }
                } else {
                    console.log('[ìƒí˜¸ì‘ìš©] ì¥ì‹ë¬¼ ì—†ìŒ, ì·¨ì†Œ');
                    return false; // ì¥ì‹ë¬¼ ì—†ìœ¼ë©´ ì·¨ì†Œ
                }
            }
            
            // íš¨ê³¼ ì ìš©
            switch (selectedType) {
                case 'sharing': // ë¨¹ì´ ë‚˜ëˆ” - ë‘˜ ë‹¤ ì„±ì¥ +1
                    spirit1.growth = Math.min(100, spirit1.growth + 1);
                    spirit2.growth = Math.min(100, spirit2.growth + 1);
                    break;
                    
                case 'song': // ë…¸ë˜ - ëœë¤ ìŠ¤íƒ¯ +1
                    const statTypes = ['intelligence', 'strength', 'charm'];
                    const randomStat = statTypes[Math.floor(Math.random() * statTypes.length)];
                    spirit2.parameters[randomStat] = Math.min(100, spirit2.parameters[randomStat] + 1);
                    break;
                    
                case 'fight': // ì‹¸ì›€ - ì•½ê°„ì˜ ìŠ¤íŠ¸ë ˆìŠ¤, ì• ì •ë„ -1
                    spirit1.parameters.affection = Math.max(0, spirit1.parameters.affection - 1);
                    spirit2.parameters.affection = Math.max(0, spirit2.parameters.affection - 1);
                    break;
                    
                case 'rest': // íœ´ì‹ - ë§Œì¡±ë„ íšŒë³µ
                    // íŠ¹ë³„í•œ íš¨ê³¼ ì—†ìŒ, ë©”ì‹œì§€ë§Œ
                    break;
            }
            
            // ë‘ ì •ë ¹ ëª¨ë‘ ê°™ì€ ë©”ì‹œì§€ í‘œì‹œ
            spirit1.status = message;
            spirit2.status = message;
            console.log('[ìƒí˜¸ì‘ìš©] ë©”ì‹œì§€ ì ìš© ì™„ë£Œ:', spirit1.name, '/', spirit2.name);
            
            // ìƒí˜¸ì‘ìš© ì‹œê°„ ê¸°ë¡ (ë©”ì‹œì§€ ìœ ì§€ìš©)
            const now = Date.now();
            spirit1.lastSpiritInteraction = now;
            spirit2.lastSpiritInteraction = now;
            
            // ì¼ì§€ì— ê¸°ë¡
            addLog(spirit1, message);
            console.log('[ìƒí˜¸ì‘ìš©] ì¼ì§€ ê¸°ë¡ ì™„ë£Œ');
            
            // ì„±ì¥ë„ ì²´í¬ (100 ì´ìƒì´ë©´ ì§„í™”)
            if (spirit1.growth >= 100 && !spirit1.isCompleted) {
                completeSpirit(spirit1);
            }
            if (spirit2.growth >= 100 && !spirit2.isCompleted) {
                completeSpirit(spirit2);
            }
            
            saveGame();
            updateAllSpiritCards();
            
            console.log('[ìƒí˜¸ì‘ìš©] âœ… ìƒí˜¸ì‘ìš© ì„±ê³µ!');
            return true; // ìƒí˜¸ì‘ìš© ë°œìƒ!
        }

        function updateRandomMessages() {
            if (isPaused) return; // ì¼ì‹œì •ì§€ ì¤‘ì´ë©´ ì‹¤í–‰ ì•ˆ í•¨
            
            // ì •ë ¹ ê°„ ìƒí˜¸ì‘ìš© ë¨¼ì € ì‹œë„ (ë©”ì‹œì§€ ë®ì–´ì“°ê¸° ë°©ì§€)
            const interactionOccurred = triggerSpiritInteraction();
            
            const now = Date.now();
            spirits.forEach(spirit => {
                if (!spirit.isDead && !spirit.isCompleted) {
                    // ì •ë ¹ ê°„ ìƒí˜¸ì‘ìš©ì´ ë°œìƒí–ˆìœ¼ë©´ í•´ë‹¹ ì •ë ¹ ë©”ì‹œì§€ ìœ ì§€
                    if (interactionOccurred && spirit.lastSpiritInteraction && now - spirit.lastSpiritInteraction < 15000) {
                        return;
                    }
                    
                    // ìµœê·¼ 10ì´ˆ ì´ë‚´ì— í”Œë ˆì´ì–´ ìƒí˜¸ì‘ìš©í–ˆìœ¼ë©´ ë©”ì‹œì§€ ìœ ì§€
                    const recentInteraction = (
                        (spirit.lastFeed && now - spirit.lastFeed < 10000) ||
                        (spirit.lastPat && now - spirit.lastPat < 10000) ||
                        (spirit.lastMusic && now - spirit.lastMusic < 10000)
                    );
                    
                    if (recentInteraction) {
                        return; // ë©”ì‹œì§€ ìœ ì§€
                    }
                    
                    // ëª¨ë“  ì •ë ¹ì˜ ë©”ì‹œì§€ë¥¼ 15ì´ˆë§ˆë‹¤ ëœë¤ ì—…ë°ì´íŠ¸
                    const oldStatus = spirit.status;
                    const newStatus = getRandomMessage(spirit);
                    
                    // ë©”ì‹œì§€ê°€ ë³€ê²½ë˜ì—ˆê³ , íŠ¹ì • ì‹œìŠ¤í…œ ë©”ì‹œì§€ê°€ ì•„ë‹ˆë©´ ì¼ì§€ì— ê¸°ë¡
                    if (newStatus !== oldStatus && !newStatus.includes('ë“£ê³  ìˆìŠµë‹ˆë‹¤')) {
                        addLog(spirit, newStatus);
                    }
                    
                    spirit.status = newStatus;
                }
            });
            
            updateAllSpiritCards();
        }
        
        // 5ë¶„ ë°©ì¹˜ ì²´í¬ (ì• ì •ë„ ê°ì†Œ)
        function checkNeglect() {
            if (isPaused) return; // ì¼ì‹œì •ì§€ ì¤‘ì´ë©´ ì‹¤í–‰ ì•ˆ í•¨
            
            const now = Date.now();
            spirits.forEach(spirit => {
                if (spirit.isDead || spirit.isCompleted) return;
                
                // ì•Œ, ì• ë²Œë ˆ, ë²ˆë°ê¸° ìƒíƒœì—ì„œëŠ” ë°©ì¹˜ ì²´í¬ ì•ˆ í•¨
                if (!spirit.stage || spirit.stage === 'egg' || spirit.stage === 'larva' || spirit.stage === 'pupa') {
                    return;
                }
                
                // lastInteractionì´ ì—†ìœ¼ë©´ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì´ˆê¸°í™” (êµ¬ë²„ì „ í˜¸í™˜)
                if (!spirit.lastInteraction) {
                    spirit.lastInteraction = now;
                    return;
                }
                
                // ì¼ì‹œì •ì§€ ì‹œê°„ ì œì™¸í•œ ì‹¤ì œ ê²½ê³¼ ì‹œê°„ ê³„ì‚°
                const currentPausedTime = isPaused ? (now - pausedAt) : 0;
                const effectivePausedTime = totalPausedTime + currentPausedTime;
                
                const timeSinceLastInteraction = (now - spirit.lastInteraction - effectivePausedTime) / 1000; // ì´ˆ
                const minutesSinceInteraction = timeSinceLastInteraction / 60;
                
                // 5ë¶„ë§ˆë‹¤ ì• ì •ë„ -1 ê°ì†Œ
                // lastAffectionDropì´ ì—†ê±°ë‚˜ 5ë¶„ ì´ìƒ ì§€ë‚¬ìœ¼ë©´ ê°ì†Œ
                if (!spirit.lastAffectionDrop) {
                    spirit.lastAffectionDrop = now;
                }
                
                const timeSinceAffectionDrop = (now - spirit.lastAffectionDrop - effectivePausedTime) / 1000; // ì´ˆ
                if (timeSinceAffectionDrop >= 300) { // 5ë¶„ = 300ì´ˆ
                    if (spirit.parameters.affection > 0) {
                        spirit.parameters.affection -= 1;
                        spirit.lastAffectionDrop = now;
                        addLog(spirit, 'ë°©ì¹˜ë˜ì–´ ì• ì •ë„ê°€ ê°ì†Œí–ˆìŠµë‹ˆë‹¤ (-1)');
                        saveGame();
                    }
                }
                
                // ì•„í”ˆ ìƒíƒœì—ì„œ 30ë¶„ ë°©ì¹˜ ì‹œ ë„ë§ê°
                if (spirit.isSick && !spirit.sickWarned && minutesSinceInteraction >= 30) {
                    spirit.sickWarned = true;
                    spirit.status = `${spirit.name}ì´(ê°€) ì•„íŒŒì„œ ê´´ë¡œì›Œí•©ë‹ˆë‹¤... ğŸ¤’ğŸ’”`;
                    addLog(spirit, 'ì•„í”ˆ ìƒíƒœë¡œ ì˜¤ë˜ ë°©ì¹˜ë˜ê³  ìˆìŠµë‹ˆë‹¤!');
                    showNotification(`${spirit.name}ì´(ê°€) ë§¤ìš° ê´´ë¡œì›Œí•©ë‹ˆë‹¤! ê³§ ë– ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤!`);
                    saveGame();
                }
                
                // ì•„í”ˆ ìƒíƒœì—ì„œ 1ì‹œê°„ ë°©ì¹˜ ì‹œ ë„ë§ê°
                if (spirit.isSick && minutesSinceInteraction >= 60) {
                    spirit.status = `${spirit.name}ì´(ê°€) í…Œë¼ë¦¬ì›€ì„ ë– ë‚¬ìŠµë‹ˆë‹¤... ğŸ˜¢`;
                    addLog(spirit, 'ì•„í”ˆ ìƒíƒœë¡œ ë°©ì¹˜ë˜ì–´ ë– ë‚¬ìŠµë‹ˆë‹¤');
                    showNotification(`ğŸ˜¢ ${spirit.name}ì´(ê°€) í…Œë¼ë¦¬ì›€ì„ ë– ë‚¬ìŠµë‹ˆë‹¤...`);
                    deleteSpirit(spirit.id);
                    return;
                }
                
                // ê±´ê°•í•œ ìƒíƒœì—ì„œ 1ì‹œê°„(3600ì´ˆ) ë°©ì¹˜ ì‹œ ë„ë§ê°
                if (!spirit.isSick && timeSinceLastInteraction >= 3600) {
                    spirit.status = `${spirit.name}ì´(ê°€) ì™¸ë¡œì›Œì„œ í…Œë¼ë¦¬ì›€ì„ ë– ë‚¬ìŠµë‹ˆë‹¤... ğŸ˜¢`;
                    addLog(spirit, 'ì˜¤ë˜ ë°©ì¹˜ë˜ì–´ ë– ë‚¬ìŠµë‹ˆë‹¤');
                    showNotification(`ğŸ˜¢ ${spirit.name}ì´(ê°€) ì™¸ë¡œì›Œì„œ ë– ë‚¬ìŠµë‹ˆë‹¤...`);
                    deleteSpirit(spirit.id);
                    return;
                }
            });
            updateAllSpiritCards();
        }


        // ë°ì´í„° ë°±ì—… ì‹œìŠ¤í…œ
        function createBackup() {
            const backupData = {
                version: GAME_VERSION,
                collection: collection,
                encyclopedia: encyclopedia,
                timestamp: Date.now()
            };
            
            const backupJson = JSON.stringify(backupData, null, 2);
            const blob = new Blob([backupJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `spirit-garden-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('ë°±ì—… íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        function importBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const backupData = JSON.parse(event.target.result);
                        
                        // ë°±ì—… ë°ì´í„° ë³‘í•© (ê¸°ì¡´ ë°ì´í„° ìœ ì§€)
                        if (backupData.collection && Array.isArray(backupData.collection)) {
                            backupData.collection.forEach(item => {
                                // ì¤‘ë³µ ì²´í¬ (ê°™ì€ ì •ë ¹ì´ ì´ë¯¸ ìˆëŠ”ì§€)
                                const exists = collection.some(c => 
                                    c.name === item.name && 
                                    c.originalName === item.originalName &&
                                    c.completedAt === item.completedAt
                                );
                                if (!exists) {
                                    collection.push(item);
                                }
                            });
                        }
                        
                        if (backupData.encyclopedia && typeof backupData.encyclopedia === 'object') {
                            // ë„ê° ë°ì´í„° ë³‘í•© (ì¹´ìš´íŠ¸ ëˆ„ì )
                            for (let key in backupData.encyclopedia) {
                                if (!encyclopedia[key]) {
                                    encyclopedia[key] = 0;
                                }
                                encyclopedia[key] += backupData.encyclopedia[key];
                            }
                        }
                        
                        saveGame();
                        renderCollection();
                        renderEncyclopedia();
                        showNotification(`ë°±ì—… ë³µì› ì™„ë£Œ! (ì•¨ë²” ${backupData.collection?.length || 0}ê°œ ë³µì›)`);
                    } catch (err) {
                        showNotification('ë°±ì—… íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + err.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }


        function removeAllDecorations() {
            if (installedDecorations.length === 0) {
                showNotification('ì„¤ì¹˜ëœ ì¥ì‹ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            showConfirm(
                'ì¥ì‹ë¬¼ ì „ì²´ í•´ì œ',
                `ì„¤ì¹˜ëœ ì¥ì‹ë¬¼ ${installedDecorations.length}ê°œë¥¼ ëª¨ë‘ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`,
                () => {
                    // ëª¨ë“  ì¥ì‹ë¬¼ì„ ì¸ë²¤í† ë¦¬ë¡œ ë°˜í™˜
                installedDecorations.forEach(deco => {
                    // ë¬¸ìì—´ ë˜ëŠ” ê°ì²´ ëª¨ë‘ ì§€ì›
                    const decoType = typeof deco === 'string' ? deco : deco.type;
                    inventory.decorations.push(decoType);
                    
                    // í…Œë¼ë¦¬ì›€ ì†ì„± ê°ì†Œ
                    const decoData = DECORATION_TYPES[decoType];
                    if (decoData && terrarium[decoData.attr] !== undefined) {
                        terrarium[decoData.attr] = Math.max(0, terrarium[decoData.attr] - decoData.power);
                    }
                });
                
                installedDecorations = [];
                
                // ë§Œì¡±ë„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                spirits.forEach(spirit => {
                    if (!spirit.isDead && !spirit.isCompleted) {
                        spirit.satisfaction = calculateSatisfaction(spirit);
                    }
                });
                
                saveGame();
                    renderTerrariumManagement();
                    renderInventory();
                    renderSpirits();  // ë§Œì¡±ë„ ë³€ê²½ ë°˜ì˜
                    showNotification('ëª¨ë“  ì¥ì‹ë¬¼ì„ í•´ì œí–ˆìŠµë‹ˆë‹¤');
                }
            );
        }
        // ==================== ë¯¸ë‹ˆê²Œì„: ì •ë ¹ ì§€í‚¤ê¸° ====================
        let minigameActive = false;
        let minigameScore = 0;
        let minigameLives = 3;
        let minigameWords = [];
        let minigameInterval = null;
        let minigameSpawnInterval = null;
        let minigameDifficulty = 'normal';
        let minigameDefeated = 0;
        let minigamePaused = false;
        
        // ë–¨ì–´ì§€ëŠ” ë‹¨ì–´ ëª©ë¡ (í•´ì¶©, ë…ì´ˆ, ì¡ì´ˆ ë“±)
        const MINIGAME_ENEMIES = {
            easy: [
                // í•´ì¶©
                { word: 'ì• ë²Œë ˆ', icon: 'ğŸ›' },
                { word: 'í•´ì¶©', icon: 'ğŸª²' },
                { word: 'ë°”í€´', icon: 'ğŸª³' },
                { word: 'ì§„ë”§ë¬¼', icon: 'ğŸœ' },
                { word: 'ë‹¬íŒ½ì´', icon: 'ğŸŒ' },
                { word: 'ì§€ë ì´', icon: 'ğŸª±' },
                { word: 'ë”±ì •ë²Œë ˆ', icon: 'ğŸª²' },
                { word: 'ë©”ëšœê¸°', icon: 'ğŸ¦—' },
                { word: 'ê·€ëšœë¼ë¯¸', icon: 'ğŸ¦—' },
                { word: 'í•˜ë£¨ì‚´ì´', icon: 'ğŸª°' },
                { word: 'ë‚˜ë¹„ìœ ì¶©', icon: 'ğŸ›' },
                // ë…ì´ˆ/ì¡ì´ˆ
                { word: 'ë…í’€', icon: 'ğŸŒ¿' },
                { word: 'ì—‰ê²…í€´', icon: 'ğŸŒ¾' },
                { word: 'ìê¸°í’€', icon: 'ğŸŒ¿' },
                { word: 'ë©êµ´', icon: 'ğŸŒ±' },
                { word: 'ê°€ì‹œë¤ë¶ˆ', icon: 'ğŸŒµ' },
                { word: 'ë…ë²„ì„¯', icon: 'ğŸ„' },
                { word: 'ê³°íŒ¡ì´', icon: 'ğŸ¦ ' },
                { word: 'ì´ë¼ë¥˜', icon: 'ğŸª¨' },
                // ê¸°íƒ€
                { word: 'ê±°ë¯¸ì¤„', icon: 'ğŸ•¸ï¸' },
                { word: 'ë¨¼ì§€', icon: 'ğŸ’¨' }
            ],
            hard: [
                // í•´ì¶©
                { word: 'ë°”í€´ë²Œë ˆ', icon: 'ğŸª³' },
                { word: 'ì§‘ê²Œë²Œë ˆ', icon: 'ğŸª²' },
                { word: 'í•˜ëŠ˜ì†Œ', icon: 'ğŸª²' },
                { word: 'ë…¸ë¦°ì¬', icon: 'ğŸª²' },
                { word: 'ì´ì±„ë²Œë ˆ', icon: 'ğŸ¦Ÿ' },
                { word: 'ì‘ì• ', icon: 'ğŸ•·ï¸' },
                { word: 'ì§„ë“œê¸°', icon: 'ğŸ•·ï¸' },
                { word: 'ë…ê±°ë¯¸', icon: 'ğŸ•·ï¸' },
                { word: 'ì§€ë„¤', icon: 'ğŸ›' },
                { word: 'ê·¸ë¦¬ë§ˆ', icon: 'ğŸ›' },
                { word: 'ë§ë²Œ', icon: 'ğŸ' },
                { word: 'ë•…ë²Œ', icon: 'ğŸ' },
                { word: 'ìŒ€ë°”êµ¬ë¯¸', icon: 'ğŸª²' },
                { word: 'í°ê°œë¯¸', icon: 'ğŸœ' },
                { word: 'ê¸°ìƒì¶©', icon: 'ğŸª±' },
                // ë…ì´ˆ/ì¡ì´ˆ
                { word: 'ë…ë¯¸ë‚˜ë¦¬', icon: 'ğŸŒ¿' },
                { word: 'íˆ¬êµ¬ê½ƒ', icon: 'ğŸŒ¸' },
                { word: 'ë¯¸ì¹˜ê´‘ì´í’€', icon: 'ğŸŒ¿' },
                { word: 'í˜‘ì£½ë„', icon: 'ğŸŒº' },
                { word: 'ì²œë‚¨ì„±', icon: 'ğŸŒ±' },
                { word: 'ì‚¿ê°“ë‚˜ë¬¼', icon: 'ğŸ€' },
                { word: 'ì• ê¸°ë˜¥í’€', icon: 'ğŸŒ¼' },
                { word: 'ê´‘ëŒ€ì‹¸ë¦¬', icon: 'ğŸŒ¿' },
                { word: 'ë…ë§í’€', icon: 'ğŸŒ¸' },
                { word: 'ê³°íŒ¡ì´ê· ', icon: 'ğŸ¦ ' },
                // ê¸°íƒ€
                { word: 'í•´ì¶©ë–¼', icon: 'ğŸª²' },
                { word: 'ë…ê±°ë¯¸ì¤„', icon: 'ğŸ•¸ï¸' }
            ]
        };
        
        // ë‚œì´ë„ë³„ ì„¤ì •
        const MINIGAME_SETTINGS = {
            easy: { spawnRate: 1700, fallSpeed: 2.2, maxWords: 5, coinMultiplier: 1 },
            hard: { spawnRate: 1200, fallSpeed: 2.8, maxWords: 8, coinMultiplier: 2 }
        };
        
        // ëª¨ë°”ì¼ ê°ì§€
        function isMobile() {
            return window.innerWidth <= 768;
        }
        
        // ëª¨ë°”ì¼ìš© ì†ë„ ì¡°ì • (í™”ë©´ì´ ì‘ìœ¼ë‹ˆ ë” ëŠë¦¬ê²Œ)
        function getMobileAdjustedSpeed(speed) {
            if (isMobile()) {
                return speed * 0.5; // ëª¨ë°”ì¼ì—ì„œ 50% ì†ë„
            }
            return speed;
        }
        
        function startMinigame() {
            minigameDifficulty = document.getElementById('minigameDifficulty').value;
            minigameActive = true;
            minigameScore = 0;
            minigameLives = 3;
            minigameWords = [];
            minigameDefeated = 0;
            minigamePaused = false;
            
            // ëª¨ë°”ì¼ ëŒ€ì‘: bodyì— í´ë˜ìŠ¤ ì¶”ê°€
            document.body.classList.add('minigame-active');
            
            // í™”ë©´ ì „í™˜
            document.getElementById('minigameIntro').style.display = 'none';
            document.getElementById('minigamePlay').style.display = 'block';
            document.getElementById('minigameResult').style.display = 'none';
            
            // UI ì´ˆê¸°í™”
            updateMinigameUI();
            
            // ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤
            const input = document.getElementById('minigameInput');
            input.value = '';
            
            // ëª¨ë°”ì¼: ì•½ê°„ ë”œë ˆì´ í›„ í¬ì»¤ìŠ¤ (í‚¤ë³´ë“œ ì˜¬ë¼ì˜¤ê²Œ)
            setTimeout(() => {
                input.focus();
            }, 100);
            
            // ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (í•œê¸€ ì¡°í•© ì™„ë£Œ í›„ ì²˜ë¦¬)
            let isComposing = false;
            
            input.addEventListener('compositionstart', () => {
                isComposing = true;
            });
            
            input.addEventListener('compositionend', (e) => {
                isComposing = false;
                handleMinigameInput();
            });
            
            input.addEventListener('input', () => {
                if (!isComposing) {
                    handleMinigameInput();
                }
            });
            
            // ê²Œì„ ì‹œì‘
            const settings = MINIGAME_SETTINGS[minigameDifficulty];
            
            // ëª¨ë°”ì¼ì—ì„œëŠ” ìµœëŒ€ ë‹¨ì–´ ìˆ˜ ì¤„ì´ê¸°
            const maxWords = isMobile() ? Math.min(settings.maxWords, 3) : settings.maxWords;
            
            // ë‹¨ì–´ ìƒì„± ì¸í„°ë²Œ (ëª¨ë°”ì¼ì—ì„œëŠ” ë” ëŠë¦¬ê²Œ)
            const spawnRate = isMobile() ? settings.spawnRate * 1.3 : settings.spawnRate;
            
            minigameSpawnInterval = setInterval(() => {
                if (!minigamePaused && minigameWords.length < maxWords) {
                    spawnMinigameWord();
                }
            }, spawnRate);
            
            // ê²Œì„ ë£¨í”„ (ë‹¨ì–´ ì´ë™)
            minigameInterval = setInterval(() => {
                if (!minigamePaused) {
                    updateMinigameWords();
                }
            }, 50);
            
            // ì²« ë‹¨ì–´ ë°”ë¡œ ìƒì„±
            spawnMinigameWord();
        }
        
        function spawnMinigameWord() {
            const area = document.getElementById('minigameArea');
            const areaWidth = area.offsetWidth;
            const enemies = MINIGAME_ENEMIES[minigameDifficulty];
            const enemy = enemies[Math.floor(Math.random() * enemies.length)];
            
            // ë‹¨ì–´ ê¸¸ì´ì— ë”°ë¥¸ ì˜ˆìƒ ë„ˆë¹„ ê³„ì‚° (ê¸€ìë‹¹ ì•½ 18px + íŒ¨ë”© + ì•„ì´ì½˜)
            const estimatedWidth = (enemy.word.length * 18) + 60;
            // ìµœì†Œ 20px ì—¬ë°±, ìµœëŒ€ (í™”ë©´ë„ˆë¹„ - ì˜ˆìƒë„ˆë¹„ - 20px)
            const maxX = Math.max(20, areaWidth - estimatedWidth - 20);
            
            // ëª¨ë°”ì¼ì—ì„œëŠ” ì†ë„ ê°ì†Œ
            const baseSpeed = MINIGAME_SETTINGS[minigameDifficulty].fallSpeed + (Math.random() * 0.5);
            const adjustedSpeed = getMobileAdjustedSpeed(baseSpeed);
            
            const wordObj = {
                id: Date.now() + Math.random(),
                word: enemy.word,
                icon: enemy.icon,
                x: Math.random() * maxX + 10,
                y: -50,
                speed: adjustedSpeed
            };
            
            // DOM ìš”ì†Œ ìƒì„±
            const wordEl = document.createElement('div');
            wordEl.id = 'word-' + wordObj.id;
            wordEl.className = 'minigame-word';
            wordEl.style.cssText = `
                position: absolute;
                left: ${wordObj.x}px;
                top: ${wordObj.y}px;
                background: linear-gradient(135deg, #2c3e50, #34495e);
                color: white;
                padding: 8px 14px;
                border-radius: 20px;
                font-size: 1rem;
                font-weight: 600;
                white-space: nowrap;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                display: flex;
                align-items: center;
                gap: 6px;
                z-index: 10;
                transition: transform 0.1s;
            `;
            wordEl.innerHTML = `${enemy.word}`;
            
            area.appendChild(wordEl);
            minigameWords.push(wordObj);
        }
        
        function updateMinigameWords() {
            const area = document.getElementById('minigameArea');
            const areaHeight = area.offsetHeight;
            const settings = MINIGAME_SETTINGS[minigameDifficulty];
            
            minigameWords.forEach((wordObj, index) => {
                wordObj.y += wordObj.speed;
                
                const wordEl = document.getElementById('word-' + wordObj.id);
                if (wordEl) {
                    wordEl.style.top = wordObj.y + 'px';
                }
                
                // ë°”ë‹¥ì— ë„ë‹¬
                if (wordObj.y > areaHeight - 100) {
                    removeMinigameWord(wordObj.id, false);
                    minigameLives--;
                    
                    // ì •ë ¹ í”¼ê²© íš¨ê³¼
                    const spirit = document.getElementById('minigameSpirit');
                    spirit.style.transform = 'translateX(-50%) scale(0.8)';
                    spirit.style.filter = 'drop-shadow(0 4px 8px rgba(0,0,0,0.3)) brightness(0.5)';
                    setTimeout(() => {
                        spirit.style.transform = 'translateX(-50%) scale(1)';
                        spirit.style.filter = 'drop-shadow(0 4px 8px rgba(0,0,0,0.3))';
                    }, 300);
                    
                    updateMinigameUI();
                    
                    if (minigameLives <= 0) {
                        endMinigame();
                    }
                }
            });
        }
        
        function handleMinigameInput() {
            const input = document.getElementById('minigameInput');
            const typed = input.value.trim();
            
            if (!typed) return;
            
            // ì¼ì¹˜í•˜ëŠ” ë‹¨ì–´ ì°¾ê¸°
            const matchIndex = minigameWords.findIndex(w => w.word === typed);
            
            if (matchIndex !== -1) {
                const matched = minigameWords[matchIndex];
                
                // ì ìˆ˜ ê³„ì‚° (ë‹¨ì–´ ê¸¸ì´ + ë¹ ë¥¸ ì²˜ì¹˜ ë³´ë„ˆìŠ¤)
                const lengthBonus = matched.word.length * 10;
                const speedBonus = Math.max(0, Math.floor((400 - matched.y) / 10));
                minigameScore += lengthBonus + speedBonus;
                minigameDefeated++;
                
                // ì œê±° íš¨ê³¼
                removeMinigameWord(matched.id, true);
                
                // ë³´í˜¸ë§‰ íš¨ê³¼
                const shield = document.getElementById('shieldEffect');
                shield.style.opacity = '1';
                setTimeout(() => {
                    shield.style.opacity = '0';
                }, 200);
                
                // ì…ë ¥ ì´ˆê¸°í™” (setTimeoutìœ¼ë¡œ ì¡°í•© ì™„ë£Œ í›„ í´ë¦¬ì–´)
                setTimeout(() => {
                    input.value = '';
                }, 0);
                
                updateMinigameUI();
            }
        }
        
        function removeMinigameWord(id, success) {
            const wordEl = document.getElementById('word-' + id);
            if (wordEl) {
                if (success) {
                    // ì„±ê³µ íš¨ê³¼
                    wordEl.style.transform = 'scale(1.3)';
                    wordEl.style.opacity = '0';
                    wordEl.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                    setTimeout(() => wordEl.remove(), 200);
                } else {
                    // ì‹¤íŒ¨ íš¨ê³¼ (ë¹¨ê°„ìƒ‰)
                    wordEl.style.background = 'linear-gradient(135deg, #c0392b, #e74c3c)';
                    wordEl.style.transform = 'scale(0.5)';
                    wordEl.style.opacity = '0';
                    setTimeout(() => wordEl.remove(), 300);
                }
            }
            minigameWords = minigameWords.filter(w => w.id !== id);
        }
        
        function updateMinigameUI() {
            document.getElementById('minigameScore').textContent = minigameScore;
            
            let hearts = '';
            for (let i = 0; i < 3; i++) {
                hearts += i < minigameLives ? 'â¤ï¸' : 'ğŸ–¤';
            }
            document.getElementById('minigameLives').textContent = hearts;
        }
        
        function pauseMinigame() {
            minigamePaused = true;
        }
        
        function resumeMinigame() {
            minigamePaused = false;
            document.getElementById('minigameInput').focus();
        }
        
        function endMinigame() {
            minigameActive = false;
            
            // ëª¨ë°”ì¼ ëŒ€ì‘: body í´ë˜ìŠ¤ ì œê±°
            document.body.classList.remove('minigame-active');
            
            // ì¸í„°ë²Œ ì •ë¦¬
            if (minigameInterval) {
                clearInterval(minigameInterval);
                minigameInterval = null;
            }
            if (minigameSpawnInterval) {
                clearInterval(minigameSpawnInterval);
                minigameSpawnInterval = null;
            }
            
            // ë‚¨ì€ ë‹¨ì–´ ì œê±°
            minigameWords.forEach(w => {
                const el = document.getElementById('word-' + w.id);
                if (el) el.remove();
            });
            minigameWords = [];
            
            // ê²°ê³¼ í™”ë©´ í‘œì‹œ
            document.getElementById('minigamePlay').style.display = 'none';
            document.getElementById('minigameResult').style.display = 'block';
            
            // ê²°ê³¼ ì—…ë°ì´íŠ¸
            document.getElementById('finalScore').textContent = minigameScore;
            document.getElementById('defeatedCount').textContent = minigameDefeated;
            
            // ê²°ê³¼ ì•„ì´ì½˜ & ë©”ì‹œì§€
            let icon, title;
            if (minigameScore >= 500) {
                icon = 'ğŸ†';
                title = 'ëŒ€ë‹¨í•´ìš”!';
            } else if (minigameScore >= 200) {
                icon = 'ğŸ‰';
                title = 'ì˜í–ˆì–´ìš”!';
            } else if (minigameScore >= 100) {
                icon = 'ğŸ‘';
                title = 'ì¢‹ì•„ìš”!';
            } else {
                icon = 'ğŸ’ª';
                title = 'ë‹¤ìŒì—” ë” ì˜í•  ìˆ˜ ìˆì–´ìš”!';
            }
            document.getElementById('resultIcon').textContent = icon;
            document.getElementById('resultTitle').textContent = title;
            
            // ë³´ìƒ ê³„ì‚° (ì½”ì¸ì€ ì ìˆ˜ì˜ 1/10 * ë‚œì´ë„ ë°°ìˆ˜)
            const settings = MINIGAME_SETTINGS[minigameDifficulty];
            const coinReward = Math.floor(minigameScore / 10 * settings.coinMultiplier);
            document.getElementById('coinRewardAmount').textContent = '+' + coinReward;
        }
        
        function claimReward(type) {
            const settings = MINIGAME_SETTINGS[minigameDifficulty];
            
            if (type === 'coin') {
                const reward = Math.floor(minigameScore / 10 * settings.coinMultiplier);
                coins += reward;
                updateCoinDisplay();
                saveGame();
                showNotification(`ğŸ’° ${reward} ì½”ì¸ì„ íšë“í–ˆìŠµë‹ˆë‹¤!`);
            } else if (type === 'item') {
                // ë‚œì´ë„ì™€ ì ìˆ˜ì— ë”°ë¼ ì•„ì´í…œ ë“±ê¸‰ ê²°ì •
                let itemPool = [];
                
                if (minigameDifficulty === 'hard' && minigameScore >= 400) {
                    // ì–´ë ¤ì›€ + ê³ ë“ì : ì „ì„¤ê¸‰ ì•„ì´í…œ (ë¯¸ë‹ˆê²Œì„ ì „ìš©)
                    itemPool = [
                        { type: 'decoration', item: 'fire_legendary', name: 'íƒœì´ˆì˜ ë¶ˆê½ƒ' },
                        { type: 'decoration', item: 'water_legendary', name: 'ì‹¬í•´ì˜ ì‹¬ì¥' },
                        { type: 'decoration', item: 'wind_legendary', name: 'í­í’ì˜ ëˆˆ' },
                        { type: 'decoration', item: 'earth_legendary', name: 'ëŒ€ì§€ì˜ ì •ìˆ˜' },
                        { type: 'decoration', item: 'light_legendary', name: 'ì²œìƒì˜ ê´‘íœ˜' },
                        { type: 'decoration', item: 'dark_legendary', name: 'ì˜ì›í•œ ì–´ë‘ ' }
                    ];
                    showNotification('ğŸŒŸ ì „ì„¤ê¸‰ ì•„ì´í…œ íšë“ ê¸°íšŒ!');
                } else if (minigameDifficulty === 'hard' && minigameScore >= 250) {
                    // ì–´ë ¤ì›€ + ì¤‘ê°„ ì ìˆ˜: ì—í”½ ì•„ì´í…œ
                    itemPool = [
                        { type: 'decoration', item: 'fire_epic', name: 'ë¶ˆì‚¬ì¡° ê¹ƒí„¸' },
                        { type: 'decoration', item: 'water_epic', name: 'ì¸ì–´ì˜ ëˆˆë¬¼' },
                        { type: 'decoration', item: 'wind_epic', name: 'í•˜ëŠ˜ì˜ ê¹ƒí„¸' },
                        { type: 'decoration', item: 'earth_epic', name: 'ì„¸ê³„ìˆ˜ ê°€ì§€' },
                        { type: 'decoration', item: 'light_epic', name: 'ë³„ì˜ íŒŒí¸' },
                        { type: 'decoration', item: 'dark_epic', name: 'ë°¤ì˜ ì •ìˆ˜' },
                        { type: 'food', item: 'light', name: 'ë¹›ë‚˜ëŠ” ë„¥íƒ€' },
                        { type: 'food', item: 'dark', name: 'ê²€ì€ ê½ƒê°€ë£¨' }
                    ];
                } else if (minigameScore >= 200) {
                    // ì‰¬ì›€ ê³ ë“ì  ë˜ëŠ” ì–´ë ¤ì›€ ì €ë“ì : ë ˆì–´ ì•„ì´í…œ
                    itemPool = [
                        { type: 'decoration', item: 'fire_rare1', name: 'ë¶ˆê½ƒ ì¡°ê°ìƒ' },
                        { type: 'decoration', item: 'water_rare1', name: 'ì‚°í˜¸ ì¥ì‹' },
                        { type: 'decoration', item: 'wind_rare1', name: 'í’ê²½' },
                        { type: 'decoration', item: 'earth_rare1', name: 'ë‚˜ë¬´ ì¡°ê°' },
                        { type: 'decoration', item: 'light_rare1', name: 'ë¹›ë‚˜ëŠ” ë³´ì„' },
                        { type: 'decoration', item: 'dark_rare1', name: 'ë‹¬ë¹›ì„' },
                        { type: 'food', item: 'light', name: 'ë¹›ë‚˜ëŠ” ë„¥íƒ€' },
                        { type: 'food', item: 'dark', name: 'ê²€ì€ ê½ƒê°€ë£¨' }
                    ];
                } else if (minigameScore >= 100) {
                    // ì¤‘ê°„ ì ìˆ˜: ì¼ë°˜ ì•„ì´í…œ
                    itemPool = [
                        { type: 'food', item: 'fire', name: 'ë¶ˆê½ƒì—´ë§¤' },
                        { type: 'food', item: 'water', name: 'ë§‘ì€ì´ìŠ¬' },
                        { type: 'food', item: 'wind', name: 'ë°”ëŒê¿€' },
                        { type: 'food', item: 'earth', name: 'ëŒ€ì§€ë²„ì„¯' },
                        { type: 'decoration', item: 'fire_common1', name: 'ìš©ì•”ì„' },
                        { type: 'decoration', item: 'water_common1', name: 'ë¶„ìˆ˜' },
                        { type: 'decoration', item: 'wind_common1', name: 'ë°”ëŒê°œë¹„' },
                        { type: 'decoration', item: 'earth_common1', name: 'í™”ë¶„' }
                    ];
                } else {
                    // ë‚®ì€ ì ìˆ˜: ê¸°ë³¸ ë¨¹ì´ë§Œ
                    itemPool = [
                        { type: 'food', item: 'fire', name: 'ë¶ˆê½ƒì—´ë§¤' },
                        { type: 'food', item: 'water', name: 'ë§‘ì€ì´ìŠ¬' },
                        { type: 'food', item: 'wind', name: 'ë°”ëŒê¿€' },
                        { type: 'food', item: 'earth', name: 'ëŒ€ì§€ë²„ì„¯' }
                    ];
                }
                
                const reward = itemPool[Math.floor(Math.random() * itemPool.length)];
                
                // ì¸ë²¤í† ë¦¬ì— ì¶”ê°€
                if (reward.type === 'food') {
                    inventory.food.push(reward.item);
                } else if (reward.type === 'decoration') {
                    inventory.decorations.push(reward.item);
                } else if (reward.type === 'music') {
                    inventory.music.push(reward.item);
                }
                
                // ì „ì„¤ê¸‰ ì•„ì´í…œì´ë©´ íŠ¹ë³„ ì•Œë¦¼
                const decoData = DECORATION_TYPES[reward.item];
                if (decoData && decoData.quality === 'legendary') {
                    showNotification(`ğŸŒŸ ì „ì„¤ê¸‰! ${decoData.icon} ${reward.name}ì„(ë¥¼) íšë“í–ˆìŠµë‹ˆë‹¤!`);
                } else {
                    showNotification(`ğŸ ${reward.name}ì„(ë¥¼) íšë“í–ˆìŠµë‹ˆë‹¤!`);
                }
                
                saveGame();
                renderInventory();
            }
            
            // ë³´ìƒ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.getElementById('rewardSection').innerHTML = `
                <div style="color: var(--wind); font-size: 1.2rem; font-weight: 700;">âœ“ ë³´ìƒì„ ë°›ì•˜ìŠµë‹ˆë‹¤!</div>
            `;
        }
        
        function backToMinigameIntro() {
            document.getElementById('minigameIntro').style.display = 'block';
            document.getElementById('minigamePlay').style.display = 'none';
            document.getElementById('minigameResult').style.display = 'none';
            
            // ë³´ìƒ ì„¹ì…˜ ë³µêµ¬
            document.getElementById('rewardSection').innerHTML = `
                <h4 style="font-size: 1.2rem; margin-bottom: 20px; color: var(--text);">ë³´ìƒì„ ì„ íƒí•˜ì„¸ìš”</h4>
                <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                    <button onclick="claimReward('coin')" class="reward-btn" style="padding: 20px 30px; background: linear-gradient(135deg, #FFD700, #FFA500); color: #333; border: none; border-radius: 12px; cursor: pointer; min-width: 150px;">
                        <div style="font-size: 2rem; margin-bottom: 8px;">ğŸ’°</div>
                        <div style="font-weight: 700;">ì½”ì¸ ë°›ê¸°</div>
                        <div id="coinRewardAmount" style="font-size: 0.9rem; margin-top: 4px;">+0</div>
                    </button>
                    <button onclick="claimReward('item')" class="reward-btn" style="padding: 20px 30px; background: linear-gradient(135deg, #9B59B6, #8E44AD); color: white; border: none; border-radius: 12px; cursor: pointer; min-width: 150px;">
                        <div style="font-size: 2rem; margin-bottom: 8px;">ğŸ</div>
                        <div style="font-weight: 700;">ì•„ì´í…œ ë°›ê¸°</div>
                        <div style="font-size: 0.9rem; margin-top: 4px;">ëœë¤ ë³´ìƒ</div>
                    </button>
                </div>
            `;
        }
        // ==================== ë¯¸ë‹ˆê²Œì„ ë ====================

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showNotification(message) {
            // ê¸°ì¡´ ì•Œë¦¼ë“¤ì˜ ê°œìˆ˜ë¥¼ ì„¸ì„œ ìœ„ì¹˜ ì¡°ì •
            const existingNotifs = document.querySelectorAll('.notification');
            const offset = existingNotifs.length * 70; // ê° ì•Œë¦¼ë§ˆë‹¤ 70px ê°„ê²©
            
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = message;
            notif.style.top = `${80 + offset}px`;
            document.body.appendChild(notif);
            
            setTimeout(() => {
                notif.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }

        function updateTimeDisplay() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ko-KR', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('timeDisplay').textContent = timeStr;
        }

        // ê²Œì„ ë£¨í”„
        setInterval(() => {
            saveGame();
        }, 5000);

        // 1ì´ˆë§ˆë‹¤ ë²„íŠ¼ ìƒíƒœ ë° ì •ë ¹ ìƒíƒœ ì²´í¬
        setInterval(() => {
            checkSpiritStatus();
            // garden íƒ­ì´ í™œì„±í™”ëœ ê²½ìš°ì—ë§Œ ì¹´ë“œ ì—…ë°ì´íŠ¸
            if (currentTab === 'garden') {
                updateCooldownDisplay();  // ì¿¨íƒ€ì„ í…ìŠ¤íŠ¸ë§Œ ì—…ë°ì´íŠ¸ (ì„±ëŠ¥ ìµœì í™”)
                spirits.forEach(spirit => {
                    updateSpiritCard(spirit);
                });
            }
            updateGatherButton();
        }, 1000);

        // 1ë¶„ë§ˆë‹¤ ì„±ì¥ë„ ì¦ê°€
        setInterval(() => {
            applyGrowth();
        }, 60000);  // 60000ms = 1ë¶„

        // 5ë¶„ë§ˆë‹¤ í…Œë¼ë¦¬ì›€ í™˜ê²½ íš¨ê³¼ ì ìš©
        setInterval(() => {
            applyTerrariumGrowth();
        }, 300000);  // 300000ms = 5ë¶„

        // ë§Œì¡±ë„ ì—…ë°ì´íŠ¸ (1ë¶„ë§ˆë‹¤)
        setInterval(() => {
            if (isPaused) return; // ì¼ì‹œì •ì§€ ì¤‘ì´ë©´ ì‹¤í–‰ ì•ˆ í•¨
            
            spirits.forEach(spirit => {
                if (spirit.isDead || spirit.isCompleted) return;
                
                // ì„±ì¥ë„ ì²´í¬ (100 ì´ìƒì´ë©´ ìë™ ì§„í™”)
                if (spirit.growth >= STAGE_REQUIREMENTS.adult && !spirit.isCompleted) {
                    completeSpirit(spirit);
                    return;
                }
                
                const oldSatisfaction = spirit.satisfaction || 'mid';
                const newSatisfaction = calculateSatisfaction(spirit);
                spirit.satisfaction = newSatisfaction;
                
                // ë§Œì¡±ë„ì— ë”°ë¥¸ ì• ì •ë„ ë³€í™”
                if (newSatisfaction === 'high') {
                    spirit.parameters.affection += 1;
                } else if (newSatisfaction === 'low') {
                    spirit.parameters.affection = Math.max(0, spirit.parameters.affection - 1);
                }
                
                // ë§Œì¡±ë„ê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œ ë¡œê·¸
                if (oldSatisfaction !== newSatisfaction) {
                    const satisfactionTexts = {
                        high: 'ë§¤ìš° ë§Œì¡±ìŠ¤ëŸ¬ì›Œ ë³´ì…ë‹ˆë‹¤!',
                        mid: 'í‰ì˜¨í•´ ë³´ì…ë‹ˆë‹¤.',
                        low: 'ë¶ˆë§Œì¡±ìŠ¤ëŸ¬ì›Œ ë³´ì…ë‹ˆë‹¤...'
                    };
                    addLog(spirit, satisfactionTexts[newSatisfaction]);
                }
            });
            saveGame();
            updateAllSpiritCards();
        }, 60000); // 60ì´ˆë§ˆë‹¤

        setInterval(updateTimeDisplay, 1000);
        setInterval(updateRandomMessages, 15000); // 15ì´ˆë§ˆë‹¤ ëœë¤ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        setInterval(checkNeglect, 60000); // 1ë¶„ë§ˆë‹¤ ë°©ì¹˜ ì²´í¬

        // ëª¨ë°”ì¼ ë””ë²„ê¹… ì •ë³´
        console.log('=== ëª¨ë°”ì¼ ë””ë²„ê¹… ì •ë³´ ===');
        console.log('User Agent:', navigator.userAgent);
        console.log('í™”ë©´ í¬ê¸°:', window.innerWidth, 'x', window.innerHeight);
        console.log('í„°ì¹˜ ì§€ì›:', 'ontouchstart' in window);
        console.log('í˜„ì¬ ì‹œê°„:', new Date().toISOString());
        
        // ì´ˆê¸°í™”
        try {
            console.log('ê²Œì„ ì´ˆê¸°í™” ì‹œì‘...');
            loadGame();
            console.log('âœ… loadGame ì™„ë£Œ');
            renderSpirits();
            console.log('âœ… renderSpirits ì™„ë£Œ');
            renderInventory();
            console.log('âœ… renderInventory ì™„ë£Œ');
            updateTimeDisplay();
            console.log('âœ… updateTimeDisplay ì™„ë£Œ');
            applyLightMode();
            console.log('âœ… applyLightMode ì™„ë£Œ');
            updateCoinDisplay();
            console.log('âœ… updateCoinDisplay ì™„ë£Œ');
            console.log('ğŸ‰ ê²Œì„ ì´ˆê¸°í™” ì™„ë£Œ!');
        } catch (error) {
            console.error('âŒ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
            alert('ê²Œì„ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }

        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
